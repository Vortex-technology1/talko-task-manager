<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TALKO System - –¢–∞—Å–∫ –ú–µ–Ω–µ–¥–∂–µ—Ä Pro</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #667eea;
            --primary-dark: #764ba2;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --info: #3498db;
            --dark: #2c3e50;
            --gray: #7f8c8d;
            --light: #f5f7fa;
            --white: #ffffff;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 40px rgba(0,0,0,0.15);
            --radius: 12px;
            --radius-sm: 8px;
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: var(--light); 
            color: var(--dark);
            min-height: 100vh;
        }
        
        .header { 
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); 
            color: white; 
            padding: 0.75rem 1rem; 
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content { 
            max-width: 1400px; 
            margin: 0 auto; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .logo { font-size: 1.1rem; font-weight: 700; display: flex; align-items: center; gap: 0.5rem; }
        .header-actions { display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap; }
        
        .header-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .header-btn:hover { background: rgba(255,255,255,0.3); }
        
        .header-ai-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 0.4rem 0.6rem;
            border-radius: 15px;
            font-size: 0.75rem;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            transition: all 0.2s;
        }
        
        .header-ai-btn:hover { background: rgba(255,255,255,0.35); transform: translateY(-1px); }
        .header-ai-btn.tech { background: rgba(46, 204, 113, 0.3); }
        .header-ai-btn.tech:hover { background: rgba(46, 204, 113, 0.5); }
        
        .lang-switcher {
            display: flex;
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
            overflow: hidden;
        }
        
        .lang-btn {
            background: transparent;
            border: none;
            color: rgba(255,255,255,0.7);
            padding: 0.3rem 0.5rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .lang-btn.active {
            background: rgba(255,255,255,0.3);
            color: white;
            font-weight: 600;
        }
        
        .lang-btn:hover { color: white; }
        
        .user-info {
            display: none;
            background: rgba(255,255,255,0.2);
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
        }
        
        .container { max-width: 1400px; margin: 0 auto; padding: 1rem; }
        
        .tab-navigation { 
            display: flex; 
            background: var(--white); 
            border-radius: var(--radius) var(--radius) 0 0; 
            box-shadow: var(--shadow);
            overflow-x: auto;
            scrollbar-width: none;
        }
        
        .tab-navigation::-webkit-scrollbar { display: none; }
        
        .tab-btn { 
            background: transparent; 
            border: none; 
            padding: 0.9rem 1rem; 
            cursor: pointer; 
            font-size: 0.8rem; 
            font-weight: 500; 
            color: var(--gray); 
            border-bottom: 3px solid transparent; 
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .tab-btn:hover { color: var(--dark); background: rgba(52, 73, 94, 0.05); }
        .tab-btn.active { color: var(--info); border-bottom-color: var(--info); font-weight: 600; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .controls { 
            background: var(--white); 
            padding: 1rem; 
            border-radius: 0 0 var(--radius) var(--radius); 
            box-shadow: var(--shadow); 
            margin-bottom: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .controls-row { display: flex; flex-wrap: wrap; gap: 0.5rem; }
        
        .btn { 
            background: var(--info); 
            color: white; 
            border: none; 
            padding: 0.7rem 1rem; 
            border-radius: var(--radius-sm); 
            cursor: pointer; 
            font-size: 0.85rem; 
            font-weight: 500;
            min-height: 44px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
            transition: all 0.2s;
        }
        
        .btn:hover { transform: translateY(-1px); box-shadow: var(--shadow); }
        .btn:active { transform: translateY(0); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .btn-success { background: var(--success); }
        .btn-danger { background: var(--danger); }
        .btn-warning { background: var(--warning); }
        .btn-clear { background: var(--gray); }
        .btn-small { padding: 0.4rem 0.6rem; font-size: 0.8rem; min-height: 36px; }
        
        .btn-google {
            background: white;
            color: #444;
            border: 2px solid #ddd;
            font-weight: 600;
        }
        
        .btn-google:hover {
            background: #f8f9fa;
            border-color: #ccc;
        }
        
        .btn-google img {
            width: 20px;
            height: 20px;
        }
        
        .filters { display: flex; flex-wrap: wrap; gap: 0.5rem; width: 100%; }
        
        .filter-select { 
            padding: 0.6rem; 
            border: 2px solid #ecf0f1; 
            border-radius: var(--radius-sm); 
            background: var(--white); 
            font-size: 0.85rem;
            min-height: 44px;
            flex: 1;
            min-width: 100px;
        }
        
        .filter-select:focus { outline: none; border-color: var(--info); }
        
        .tasks-container, .cards-grid {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        
        .cards-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
            padding: 1rem;
        }
        
        .task-card, .function-card, .user-card {
            padding: 1rem;
            border-bottom: 1px solid #ecf0f1;
            transition: all 0.2s;
        }
        
        .function-card, .user-card {
            background: #f8f9fa;
            border: 2px solid #ecf0f1;
            border-radius: var(--radius);
        }
        
        .task-card:last-child { border-bottom: none; }
        .task-card:hover, .function-card:hover, .user-card:hover { background: #f8f9fa; border-color: var(--info); }
        
        .task-card.pinned {
            background: linear-gradient(90deg, rgba(52, 152, 219, 0.08) 0%, var(--white) 100%);
            border-left: 4px solid var(--info);
        }
        
        .task-card-header, .function-header, .user-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .task-title, .function-title, .user-name { font-weight: 600; font-size: 0.95rem; flex: 1; }
        
        .pin-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            color: #bdc3c7;
            padding: 0.2rem;
        }
        
        .pin-btn:hover, .pin-btn.pinned { color: var(--warning); }
        
        .task-meta, .function-description, .user-details {
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }
        
        .task-meta { display: flex; flex-wrap: wrap; gap: 0.5rem; }
        .task-meta-item { display: flex; align-items: center; gap: 0.2rem; }
        
        .task-badges, .function-assignees { display: flex; flex-wrap: wrap; gap: 0.4rem; margin-bottom: 0.5rem; }
        
        .badge, .assignee-badge, .role-badge {
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 500;
        }
        
        .badge-new { background: #e3f2fd; color: #1976d2; }
        .badge-progress { background: #fff3e0; color: #f57c00; }
        .badge-review { background: #fce4ec; color: #c2185b; }
        .badge-done { background: #e8f5e8; color: #388e3c; }
        .badge-high { background: #ffebee; color: #d32f2f; }
        .badge-medium { background: #fff3e0; color: #f57c00; }
        .badge-low { background: #e8f5e8; color: #388e3c; }
        
        .assignee-badge { background: var(--success); color: white; }
        .assignee-badge.head { background: var(--warning); }
        
        .role-badge { color: white; }
        .role-badge.owner { background: var(--danger); }
        .role-badge.manager { background: var(--warning); }
        .role-badge.employee { background: var(--info); }
        
        .task-actions, .function-stats, .user-stats { 
            display: flex; 
            gap: 0.4rem; 
            justify-content: flex-end;
            padding-top: 0.5rem;
        }
        
        .task-deadline-row {
            display: flex;
            gap: 0.75rem;
            align-items: center;
            font-size: 0.85rem;
            padding: 0.5rem 0;
            flex-wrap: wrap;
        }
        
        .task-deadline-row.overdue-text { color: #e74c3c; font-weight: 600; }
        .task-deadline-row.today-text { color: #2980b9; font-weight: 600; }
        
        .time-badge {
            background: #e8f4fd;
            color: #2980b9;
            padding: 0.15rem 0.5rem;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .task-detail {
            font-size: 0.8rem;
            color: #555;
            padding: 0.4rem 0.6rem;
            background: #f8f9fa;
            border-radius: 6px;
            margin-top: 0.4rem;
            line-height: 1.4;
        }
        
        .task-detail strong { color: #333; }
        
        .task-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 0.5rem;
            margin-top: 0.5rem;
            border-top: 1px solid #ecf0f1;
        }
        
        .task-created {
            font-size: 0.7rem;
            color: #95a5a6;
        }
        
        .regular-schedule {
            font-size: 0.85rem;
            color: #2980b9;
            font-weight: 500;
            margin-bottom: 0.5rem;
            padding: 0.3rem 0.6rem;
            background: #e8f4fd;
            border-radius: 6px;
            display: inline-block;
        }
        
        .instruction-preview {
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .instruction-preview:hover {
            background: #e8f4fd;
        }
        
        .task-card.overdue {
            border-left: 4px solid #e74c3c;
            background: linear-gradient(90deg, rgba(231, 76, 60, 0.05) 0%, var(--white) 100%);
        }
        
        .task-card.today {
            border-left: 4px solid #3498db;
            background: linear-gradient(90deg, rgba(52, 152, 219, 0.05) 0%, var(--white) 100%);
        }
        
        .total-time-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .total-time-container {
            padding: 0.5rem 1rem;
            text-align: right;
        }
        
        .filters-row {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            align-items: center;
        }
        
        .btn-clear {
            background: #95a5a6;
        }
        
        /* Table styles */
        .table-container {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow-x: auto;
        }
        
        .tasks-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        .tasks-table th {
            background: #34495e;
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: 500;
            font-size: 0.85rem;
        }
        
        .tasks-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #ecf0f1;
            font-size: 0.85rem;
        }
        
        .tasks-table tr:hover {
            background: #f8f9fa;
        }
        
        .tasks-table .task-title-cell {
            max-width: 250px;
        }
        
        .tasks-table .task-title-text {
            font-weight: 500;
            color: var(--dark);
        }
        
        .tasks-table .task-title-text.pinned::before {
            content: 'üìå ';
        }
        
        .status-badge {
            padding: 0.25rem 0.6rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            display: inline-block;
        }
        
        .status-new { background: #e3f2fd; color: #1976d2; }
        .status-progress { background: #fff3e0; color: #f57c00; }
        .status-review { background: #fce4ec; color: #c2185b; }
        .status-done { background: #e8f5e8; color: #388e3c; }
        
        .deadline-text.overdue { color: #e74c3c; font-weight: 600; }
        .deadline-text.today { color: #3498db; font-weight: 600; }
        
        .action-btns {
            display: flex;
            gap: 0.25rem;
        }
        
        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            padding: 0.25rem;
            border-radius: 4px;
            transition: background 0.2s;
        }
        
        .action-btn:hover {
            background: #ecf0f1;
        }
        
        /* Dashboard subtitle */
        .dashboard-subtitle {
            font-size: 0.7rem;
            opacity: 0.85;
            margin-top: 0.25rem;
        }
        
        /* Analytics */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        
        .analytics-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 1.25rem;
            text-align: center;
        }
        
        .analytics-card h3 {
            font-size: 0.85rem;
            color: var(--gray);
            margin-bottom: 0.5rem;
        }
        
        .analytics-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
        }
        
        .analytics-number.green { color: #27ae60; }
        .analytics-number.blue { color: #3498db; }
        .analytics-number.orange { color: #f39c12; }
        
        @media (min-width: 768px) {
            .analytics-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        .controls-row {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            align-items: center;
        }
        
        .empty-table {
            text-align: center;
            padding: 3rem;
            color: var(--gray);
        }
        
        .empty-table h3 {
            margin-bottom: 0.5rem;
            color: var(--dark);
        }
        
        .function-stats, .user-stats {
            justify-content: space-between;
            border-top: 1px solid #ecf0f1;
            font-size: 0.8rem;
        }
        
        .empty-state { text-align: center; padding: 2.5rem 1.5rem; color: var(--gray); }
        .empty-state h3 { margin-bottom: 0.5rem; color: var(--dark); font-size: 1.1rem; }
        
        .modal { 
            display: none; 
            position: fixed; 
            z-index: 1000; 
            left: 0; top: 0; 
            width: 100%; height: 100%; 
            background: rgba(0,0,0,0.5); 
            backdrop-filter: blur(3px);
            overflow-y: auto;
            padding: 0.5rem;
        }
        
        .modal-content { 
            background: var(--white); 
            margin: 0 auto;
            border-radius: var(--radius); 
            width: 100%;
            max-width: 550px;
            max-height: calc(100vh - 1rem);
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }
        
        .modal-header { 
            background: var(--dark); 
            color: white; 
            padding: 1rem; 
            border-radius: var(--radius) var(--radius) 0 0;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .modal-header h2 { font-size: 1.1rem; padding-right: 2rem; }
        .modal-body { padding: 1rem; }
        
        .close { 
            color: rgba(255,255,255,0.7);
            position: absolute;
            right: 1rem; top: 0.8rem;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .close:hover { color: white; }
        
        .form-grid { display: grid; grid-template-columns: 1fr; gap: 0.9rem; }
        .form-group { display: flex; flex-direction: column; }
        .form-group.full-width { grid-column: span 1; }
        .form-label { margin-bottom: 0.4rem; font-weight: 600; color: var(--dark); font-size: 0.85rem; }
        
        .form-input, .form-select, .form-textarea { 
            padding: 0.7rem; 
            border: 2px solid #ecf0f1; 
            border-radius: var(--radius-sm); 
            font-size: 1rem;
            min-height: 44px;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus { outline: none; border-color: var(--info); }
        .form-textarea { resize: vertical; min-height: 70px; }
        .form-actions { display: flex; gap: 0.5rem; justify-content: flex-end; margin-top: 1rem; flex-wrap: wrap; }
        
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.6rem;
            margin-bottom: 1rem;
        }
        
        .dashboard-card {
            border-radius: var(--radius);
            padding: 0.8rem;
            text-align: center;
            color: white;
        }
        
        .dashboard-card.urgent { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%); }
        .dashboard-card.warning { background: linear-gradient(135deg, #feca57 0%, #f39c12 100%); }
        .dashboard-card.active { background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); }
        .dashboard-card.completed { background: linear-gradient(135deg, #55efc4 0%, #00b894 100%); }
        
        .dashboard-card h3 { font-size: 0.75rem; margin-bottom: 0.2rem; opacity: 0.9; }
        .dashboard-number { font-size: 1.75rem; font-weight: 700; }
        
        /* AUTH */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: calc(100vh - 80px);
            padding: 1rem;
        }
        
        .auth-card {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 420px;
            overflow: hidden;
        }
        
        .auth-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 1.5rem;
            text-align: center;
        }
        
        .auth-header h2 { font-size: 1.4rem; margin-bottom: 0.3rem; }
        .auth-header p { opacity: 0.9; font-size: 0.85rem; }
        .auth-body { padding: 1.25rem; }
        
        .auth-message {
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 0.85rem;
        }
        .auth-message.success { background: #e8f5e8; color: #388e3c; }
        .auth-message.error { background: #ffebee; color: #d32f2f; }
        .auth-message.info { background: #e3f2fd; color: #1976d2; }
        
        .auth-divider {
            display: flex;
            align-items: center;
            margin: 1.25rem 0;
            color: var(--gray);
            font-size: 0.85rem;
        }
        
        .auth-divider::before,
        .auth-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: #ecf0f1;
        }
        
        .auth-divider span {
            padding: 0 1rem;
        }
        
        .main-interface { display: none; }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 3rem;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #ecf0f1;
            border-top-color: var(--info);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .footer {
            text-align: center;
            padding: 1.25rem;
            background: #f8f9fa;
            border-top: 1px solid #ecf0f1;
            margin-top: 1.5rem;
        }
        
        .footer p { color: var(--gray); font-size: 0.8rem; margin-bottom: 0.5rem; }
        .footer-links { display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap; }
        .footer-links a { color: var(--info); text-decoration: none; font-size: 0.8rem; }
        
        .support-btn {
            position: fixed;
            bottom: 16px;
            right: 16px;
            z-index: 999;
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 12px 20px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: #ffffff !important;
            border-radius: 50px;
            font-weight: 600;
            font-size: 14px;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
            cursor: pointer;
            text-decoration: none;
            border: none;
            transition: all 0.3s;
        }
        
        .support-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(16, 185, 129, 0.5); }
        
        /* Mobile buttons */
        
        @media (min-width: 768px) {
            .header { padding: 1rem 2rem; }
            .logo { font-size: 1.4rem; }
            .user-info { display: flex; }
            .container { padding: 1.5rem; }
            .controls { flex-direction: row; align-items: center; justify-content: space-between; }
            .filters { width: auto; flex-wrap: nowrap; }
            .filter-select { flex: none; min-width: auto; }
            .form-grid { grid-template-columns: 1fr 1fr; }
            .form-group.full-width { grid-column: span 2; }
            .cards-grid { grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); }
            .dashboard-cards { grid-template-columns: repeat(4, 1fr); }
        }
        
        /* Mobile optimizations */
        @media (max-width: 767px) {
            .filters {
                display: flex;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                padding-bottom: 0.5rem;
                gap: 0.5rem;
            }
            
            .filter-select {
                flex: 0 0 auto;
                min-width: 130px;
                font-size: 0.8rem;
                padding: 0.5rem;
            }
            
            .task-card {
                padding: 0.75rem;
            }
            
            .task-title {
                font-size: 0.9rem;
            }
            
            .task-deadline-row {
                font-size: 0.8rem;
                gap: 0.5rem;
            }
            
            .task-meta {
                gap: 0.3rem;
            }
            
            .task-meta-item {
                font-size: 0.75rem;
            }
            
            .task-detail {
                font-size: 0.75rem;
                padding: 0.3rem 0.5rem;
            }
            
            .btn {
                padding: 0.6rem 0.8rem;
                font-size: 0.8rem;
            }
            
            .btn-small {
                padding: 0.35rem 0.5rem;
                font-size: 0.75rem;
                min-height: 32px;
            }
            
            .total-time-badge {
                font-size: 0.75rem;
                padding: 0.4rem 0.8rem;
            }
            
            .controls-row {
                justify-content: space-between;
                width: 100%;
            }
            
            .modal-content {
                margin-top: 0;
                border-radius: var(--radius) var(--radius) 0 0;
                max-height: 95vh;
            }
            
            .form-input, .form-select, .form-textarea {
                font-size: 16px; /* Prevents zoom on iOS */
            }
        }
        
        @media (max-width: 400px) {
            .header-ai-btn span { display: none; }
            .header-ai-btn { padding: 0.4rem; font-size: 0.9rem; }
            .support-btn span { display: none; }
            .support-btn { padding: 14px; border-radius: 50%; font-size: 18px; }
        }
        
        .assignee-checkbox {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            background: #f0f0f0;
            padding: 0.3rem 0.5rem;
            border-radius: 15px;
            font-size: 0.8rem;
            cursor: pointer;
        }
        
        .assignee-checkbox:hover { background: #e0e0e0; }
        .assignee-checkbox input { width: 14px; height: 14px; cursor: pointer; }
        
        .company-badge {
            background: rgba(255,255,255,0.3);
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            font-size: 0.7rem;
            margin-left: 0.5rem;
        }
        
        .password-toggle {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            color: var(--gray);
        }
        
        .input-wrapper {
            position: relative;
        }
        
        .no-access-card {
            text-align: center;
            padding: 2rem;
        }
        
        .no-access-card h3 {
            color: var(--danger);
            margin-bottom: 1rem;
        }
        
        .no-access-card p {
            color: var(--gray);
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                üöÄ TALKO System
                <span class="company-badge" id="companyBadge" style="display:none;"></span>
            </div>
            <div class="header-actions">
                <a href="https://chatgpt.com/g/g-684bb075301481918669f787231e1af7-radar-ai-alex-talko" target="_blank" class="header-ai-btn" title="–ü–∏—Ç–∞–Ω–Ω—è –¥–æ –∫–µ—Ä—ñ–≤–Ω–∏–∫–∞">
                    üéØ <span data-i18n="radarAI">–ö–µ—Ä—ñ–≤–Ω–∏–∫</span>
                </a>
                <a href="https://chatgpt.com/g/g-685640bc592881918743da9332b83f31-ai-alex-talko-technical-lead" target="_blank" class="header-ai-btn tech" title="–ü–æ–º—ñ—á–Ω–∏–∫">
                    üîß <span data-i18n="techAI">–ü–æ–º—ñ—á–Ω–∏–∫</span>
                </a>
                <div class="lang-switcher">
                    <button class="lang-btn active" onclick="setLanguage('ua')" id="langUA">UA</button>
                    <button class="lang-btn" onclick="setLanguage('ru')" id="langRU">RU</button>
                </div>
                <div class="user-info" id="currentUserInfo">
                    <span>üë§ <span id="currentUserName">...</span></span>
                    <span id="currentUserRole" style="opacity:0.8;font-size:0.8rem;"></span>
                </div>
                <button class="header-btn" onclick="logout()" id="logoutBtn" style="display:none;" data-i18n="logout">üö™ –í–∏–π—Ç–∏</button>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- LOADING -->
        <div id="loadingPage" class="loading">
            <div class="spinner"></div>
        </div>

        <!-- AUTH PAGE -->
        <div id="authPage" class="auth-container" style="display:none;">
            <div class="auth-card">
                <div class="auth-header">
                    <h2>üöÄ TALKO System</h2>
                    <p data-i18n="authSubtitle">–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è–º–∏ –¥–ª—è –±—ñ–∑–Ω–µ—Å—É</p>
                </div>
                <div class="auth-body">
                    <div id="authMessage" class="auth-message" style="display:none;"></div>
                    
                    <!-- NO ACCESS -->
                    <div id="noAccessCard" class="no-access-card" style="display:none;">
                        <h3 data-i18n="noAccessTitle">üö´ –î–æ—Å—Ç—É–ø –≤—ñ–¥—Å—É—Ç–Ω—ñ–π</h3>
                        <p data-i18n="noAccessText">–í–∞—à email –Ω–µ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ –≤ —Å–∏—Å—Ç–µ–º—ñ.<br>–ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É.</p>
                        <a href="https://alextalko.com" target="_blank" class="btn btn-success" data-i18n="contactSupport">üìû –ó–≤'—è–∑–∞—Ç–∏—Å—è –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é</a>
                        <button onclick="logout()" class="btn" style="margin-top:0.5rem;" data-i18n="tryAnotherEmail">üîÑ –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ —ñ–Ω—à–∏–π email</button>
                    </div>
                    
                    <!-- LOGIN FORM -->
                    <div id="loginForm">
                        <button onclick="signInWithGoogle()" class="btn btn-google" style="width:100%;">
                            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
                            <span data-i18n="signInGoogle">–£–≤—ñ–π—Ç–∏ —á–µ—Ä–µ–∑ Google</span>
                        </button>
                        
                        <div class="auth-divider"><span data-i18n="or">–∞–±–æ</span></div>
                        
                        <div class="form-group">
                            <label class="form-label">Email:</label>
                            <input type="email" id="loginEmail" class="form-input" placeholder="your@email.com">
                        </div>
                        <div class="form-group" style="margin-top:0.75rem;">
                            <label class="form-label" data-i18n="password">–ü–∞—Ä–æ–ª—å:</label>
                            <div class="input-wrapper">
                                <input type="password" id="loginPassword" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                                <button type="button" class="password-toggle" onclick="togglePassword('loginPassword', this)">üëÅÔ∏è</button>
                            </div>
                        </div>
                        <button onclick="signInWithEmail()" class="btn btn-success" style="width:100%;margin-top:1rem;" data-i18n="signIn">
                            üîê –£–≤—ñ–π—Ç–∏
                        </button>
                        <p style="text-align:center;margin-top:0.75rem;font-size:0.85rem;">
                            <a href="#" onclick="resetPassword()" style="color:var(--info);" data-i18n="forgotPassword">–ó–∞–±—É–ª–∏ –ø–∞—Ä–æ–ª—å?</a>
                        </p>
                        <div class="auth-divider"><span data-i18n="haveInvite">–Ñ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—è?</span></div>
                        <button onclick="showRegisterForm()" class="btn" style="width:100%;background:#9b59b6;" data-i18n="registerBtn">
                            üìù –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è
                        </button>
                        <p style="text-align:center;margin-top:1rem;font-size:0.8rem;color:var(--gray);">
                            <span data-i18n="noAccess">–ù–µ–º–∞—î –¥–æ—Å—Ç—É–ø—É?</span> <a href="https://alextalko.com" target="_blank" style="color:var(--info);" data-i18n="contactUs">–ó–≤'—è–∂—ñ—Ç—å—Å—è –∑ –Ω–∞–º–∏</a>
                        </p>
                    </div>
                    
                    <!-- REGISTER FORM -->
                    <div id="registerForm" style="display:none;">
                        <h3 style="text-align:center;margin-bottom:1rem;color:var(--dark);" data-i18n="registerTitle">üìù –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∑–∞ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—è–º</h3>
                        <div class="form-group">
                            <label class="form-label">Email:</label>
                            <input type="email" id="registerEmail" class="form-input" placeholder="your@email.com">
                        </div>
                        <div class="form-group" style="margin-top:0.75rem;">
                            <label class="form-label" data-i18n="createPassword">–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å:</label>
                            <div class="input-wrapper">
                                <input type="password" id="registerPassword" class="form-input" placeholder="–º—ñ–Ω—ñ–º—É–º 6 —Å–∏–º–≤–æ–ª—ñ–≤">
                                <button type="button" class="password-toggle" onclick="togglePassword('registerPassword', this)">üëÅÔ∏è</button>
                            </div>
                        </div>
                        <div class="form-group" style="margin-top:0.75rem;">
                            <label class="form-label" data-i18n="confirmPassword">–ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å:</label>
                            <div class="input-wrapper">
                                <input type="password" id="registerPasswordConfirm" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                                <button type="button" class="password-toggle" onclick="togglePassword('registerPasswordConfirm', this)">üëÅÔ∏è</button>
                            </div>
                        </div>
                        <button onclick="registerWithInvite()" class="btn btn-success" style="width:100%;margin-top:1rem;" data-i18n="registerSubmit">
                            ‚úÖ –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è
                        </button>
                        <p style="text-align:center;margin-top:1rem;">
                            <a href="#" onclick="showLoginForm()" style="color:var(--info);" data-i18n="backToLogin">‚Üê –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –≤—Ö–æ–¥—É</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- MAIN INTERFACE -->
        <div id="mainInterface" class="main-interface">
            <div class="tab-navigation">
                <button class="tab-btn active" onclick="switchTab('tasks')" data-i18n="tabTasks">–ó–∞–≤–¥–∞–Ω–Ω—è</button>
                <button class="tab-btn" onclick="switchTab('control')" data-i18n="tabControl">–ö–æ–Ω—Ç—Ä–æ–ª—å</button>
                <button class="tab-btn" onclick="switchTab('regular')" data-i18n="tabRegular">–†–µ–≥—É–ª—è—Ä–Ω—ñ</button>
                <button class="tab-btn" onclick="switchTab('functions')" data-i18n="tabFunctions">–§—É–Ω–∫—Ü—ñ—ó</button>
                <button class="tab-btn" onclick="switchTab('users')" data-i18n="tabUsers">–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∏</button>
                <button class="tab-btn" onclick="switchTab('analytics')" data-i18n="tabAnalytics">–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞</button>
                <button class="tab-btn" onclick="switchTab('admin')" id="adminTabBtn" style="display:none;background:#fee2e2;color:#dc2626;" data-i18n="tabAdmin">üîß –ê–¥–º—ñ–Ω</button>
            </div>

            <!-- TASKS -->
            <div id="tasksTab" class="tab-content active">
                <div class="controls">
                    <div class="controls-row">
                        <button class="btn btn-success" onclick="openTaskModal()" data-i18n="addTask">+ –î–æ–¥–∞—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è</button>
                        <button class="btn" style="background:#2ecc71;" onclick="exportTasksCSV()">üìä –ï–∫—Å–ø–æ—Ä—Ç CSV</button>
                    </div>
                    <div class="filters-row">
                        <button class="btn btn-clear" onclick="clearTaskFilters()">üóëÔ∏è <span data-i18n="clear">–û—á–∏—Å—Ç–∏—Ç–∏</span></button>
                        <select class="filter-select" id="taskTypeFilter" onchange="renderTasks()">
                            <option value="" data-i18n="allTasks">–í—Å—ñ –∑–∞–≤–¥–∞–Ω–Ω—è</option>
                            <option value="my" data-i18n="myTasks">–ú–æ—ó –∑–∞–≤–¥–∞–Ω–Ω—è</option>
                            <option value="created" data-i18n="createdByMe">–°—Ç–≤–æ—Ä–µ–Ω—ñ –º–Ω–æ—é</option>
                        </select>
                        <select class="filter-select" id="dateFilter" onchange="handleDateFilter()">
                            <option value="" data-i18n="allDates">–í—Å—ñ –¥–∞—Ç–∏</option>
                            <option value="today" data-i18n="today">–°—å–æ–≥–æ–¥–Ω—ñ</option>
                            <option value="week" data-i18n="thisWeek">–¶–µ–π —Ç–∏–∂–¥–µ–Ω—å</option>
                            <option value="month" data-i18n="thisMonth">–¶–µ–π –º—ñ—Å—è—Ü—å</option>
                            <option value="overdue" data-i18n="overdue">–ü—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω—ñ</option>
                            <option value="custom" data-i18n="customPeriod">–û–±—Ä–∞—Ç–∏ –ø–µ—Ä—ñ–æ–¥</option>
                        </select>
                        <div id="customDateRange" style="display:none;gap:0.5rem;align-items:center;">
                            <input type="date" id="dateFrom" class="form-input" style="width:auto;padding:0.4rem;" onchange="renderTasks()">
                            <span>‚Äî</span>
                            <input type="date" id="dateTo" class="form-input" style="width:auto;padding:0.4rem;" onchange="renderTasks()">
                        </div>
                        <select class="filter-select" id="statusFilter" onchange="renderTasks()">
                            <option value="" data-i18n="statuses">–°—Ç–∞—Ç—É—Å–∏</option>
                            <option value="new" data-i18n="statusNew">–ù–æ–≤—ñ</option>
                            <option value="progress" data-i18n="statusProgress">–í —Ä–æ–±–æ—Ç—ñ</option>
                            <option value="review" data-i18n="statusReview">–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞</option>
                            <option value="done" data-i18n="statusDone">–ì–æ—Ç–æ–≤–æ</option>
                        </select>
                        <select class="filter-select" id="functionFilter" onchange="renderTasks()"><option value="" data-i18n="functions">–§—É–Ω–∫—Ü—ñ—ó</option></select>
                        <select class="filter-select" id="assigneeFilter" onchange="renderTasks()"><option value="" data-i18n="assignees">–í–∏–∫–æ–Ω–∞–≤—Ü—ñ</option></select>
                    </div>
                </div>
                <div id="totalTimeInfo" class="total-time-container"></div>
                <div class="table-container" id="tasksContainer">
                    <div class="loading"><div class="spinner"></div></div>
                </div>
            </div>

            <!-- CONTROL -->
            <div id="controlTab" class="tab-content">
                <div class="controls">
                    <h2 style="font-size:1.2rem;margin-bottom:0;" data-i18n="controlPanelTitle">–ü–∞–Ω–µ–ª—å –∫–æ–Ω—Ç—Ä–æ–ª—é –∑–∞–≤–¥–∞–Ω—å</h2>
                </div>
                <div class="filters-row" style="background:white;padding:1rem;border-radius:12px;margin-bottom:1rem;box-shadow:var(--shadow);">
                    <span style="display:flex;align-items:center;gap:0.3rem;">üë§ <span data-i18n="assigneeLabel">–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å:</span></span>
                    <select class="filter-select" id="controlAssigneeFilter" onchange="renderControl()"><option value="" data-i18n="allAssignees">–í—Å—ñ –≤–∏–∫–æ–Ω–∞–≤—Ü—ñ</option></select>
                    <span style="display:flex;align-items:center;gap:0.3rem;">üè∑Ô∏è <span data-i18n="functionLabel">–§—É–Ω–∫—Ü—ñ—è:</span></span>
                    <select class="filter-select" id="controlFunctionFilter" onchange="renderControl()"><option value="" data-i18n="allFunctions">–í—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó</option></select>
                    <span style="display:flex;align-items:center;gap:0.3rem;">üìÖ <span data-i18n="periodLabel">–ü–µ—Ä—ñ–æ–¥:</span></span>
                    <select class="filter-select" id="controlPeriodFilter" onchange="renderControl()">
                        <option value="" data-i18n="allTime">–í–µ—Å—å —á–∞—Å</option>
                        <option value="today" data-i18n="today">–°—å–æ–≥–æ–¥–Ω—ñ</option>
                        <option value="week" data-i18n="thisWeek">–¶–µ–π —Ç–∏–∂–¥–µ–Ω—å</option>
                        <option value="month" data-i18n="thisMonth">–¶–µ–π –º—ñ—Å—è—Ü—å</option>
                    </select>
                    <button class="btn btn-clear" onclick="clearControlFilters()">üóëÔ∏è <span data-i18n="clear">–û—á–∏—Å—Ç–∏—Ç–∏</span></button>
                </div>
                <div style="background:white;border-radius:12px;padding:1rem;box-shadow:var(--shadow);">
                    <div class="dashboard-cards">
                        <div class="dashboard-card urgent">
                            <h3 data-i18n="critical">–ö—Ä–∏—Ç–∏—á–Ω—ñ</h3>
                            <div class="dashboard-number" id="urgentCount">0</div>
                            <div class="dashboard-subtitle" data-i18n="overdueLabel">–ü—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω—ñ</div>
                        </div>
                        <div class="dashboard-card warning">
                            <h3 data-i18n="attention">–£–≤–∞–≥–∞</h3>
                            <div class="dashboard-number" id="warningCount">0</div>
                            <div class="dashboard-subtitle" data-i18n="todayTomorrow">–°—å–æ–≥–æ–¥–Ω—ñ-–∑–∞–≤—Ç—Ä–∞</div>
                        </div>
                        <div class="dashboard-card active">
                            <h3 data-i18n="active">–ê–∫—Ç–∏–≤–Ω—ñ</h3>
                            <div class="dashboard-number" id="activeCount">0</div>
                            <div class="dashboard-subtitle" data-i18n="inWork">–í —Ä–æ–±–æ—Ç—ñ</div>
                        </div>
                        <div class="dashboard-card completed">
                            <h3 data-i18n="completed">–ì–æ—Ç–æ–≤–æ</h3>
                            <div class="dashboard-number" id="completedCount">0</div>
                            <div class="dashboard-subtitle" data-i18n="completedLabel">–ó–∞–≤–µ—Ä—à–µ–Ω—ñ</div>
                        </div>
                    </div>
                    <div style="margin-top:1rem;padding:1rem;background:#f8f9fa;border-radius:8px;">
                        <div style="display:flex;align-items:center;gap:0.5rem;margin-bottom:0.5rem;">
                            <span data-i18n="viewLabel">–ü–µ—Ä–µ–≥–ª—è–¥:</span>
                            <select class="filter-select" id="controlViewType" onchange="renderControlContent()" style="min-width:150px;">
                                <option value="workload" data-i18n="workload">–ù–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</option>
                                <option value="functions" data-i18n="byFunctions">–ü–æ —Ñ—É–Ω–∫—Ü—ñ—è—Ö</option>
                            </select>
                        </div>
                    </div>
                    <div id="controlContent" style="margin-top:1rem;"></div>
                </div>
            </div>

            <!-- REGULAR -->
            <div id="regularTab" class="tab-content">
                <div class="filters-row" style="background:white;padding:1rem;border-radius:12px;margin-bottom:1rem;box-shadow:var(--shadow);">
                    <span style="display:flex;align-items:center;gap:0.3rem;">üë§ <span data-i18n="assigneeLabel">–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å:</span></span>
                    <select class="filter-select" id="regularAssigneeFilter" onchange="renderRegularTasks()"><option value="" data-i18n="allAssignees">–í—Å—ñ –≤–∏–∫–æ–Ω–∞–≤—Ü—ñ</option></select>
                    <span style="display:flex;align-items:center;gap:0.3rem;">üè∑Ô∏è <span data-i18n="functionLabel">–§—É–Ω–∫—Ü—ñ—è:</span></span>
                    <select class="filter-select" id="regularFunctionFilter" onchange="renderRegularTasks()"><option value="" data-i18n="allFunctions">–í—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó</option></select>
                    <button class="btn btn-clear" onclick="clearRegularFilters()">üóëÔ∏è <span data-i18n="clear">–û—á–∏—Å—Ç–∏—Ç–∏</span></button>
                </div>
                <div class="controls">
                    <button class="btn btn-success" onclick="openRegularTaskModal()" data-i18n="addRegularTask">+ –†–µ–≥—É–ª—è—Ä–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è</button>
                </div>
                <div id="regularTasksContainer" class="cards-grid">
                    <div class="loading"><div class="spinner"></div></div>
                </div>
            </div>

            <!-- FUNCTIONS -->
            <div id="functionsTab" class="tab-content">
                <div class="controls">
                    <button class="btn btn-success" onclick="openFunctionModal()" data-i18n="addFunction">+ –§—É–Ω–∫—Ü—ñ—è</button>
                </div>
                <div id="functionsContainer" class="cards-grid">
                    <div class="loading"><div class="spinner"></div></div>
                </div>
            </div>

            <!-- USERS -->
            <div id="usersTab" class="tab-content">
                <div class="controls">
                    <button class="btn btn-success" onclick="openUserModal()" id="addUserBtn" data-i18n="addEmployee">+ –î–æ–¥–∞—Ç–∏ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞</button>
                    <button class="btn btn-warning" onclick="openInviteModal()" id="inviteBtn" data-i18n="invite">üì§ –ó–∞–ø—Ä–æ—Å–∏—Ç–∏</button>
                </div>
                <div id="usersContainer" class="cards-grid">
                    <div class="loading"><div class="spinner"></div></div>
                </div>
            </div>

            <!-- ANALYTICS -->
            <div id="analyticsTab" class="tab-content">
                <div class="controls">
                    <h2 style="font-size:1.2rem;" data-i18n="analytics">üìà –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞</h2>
                </div>
                <div style="background:white;border-radius:12px;padding:1.5rem;box-shadow:var(--shadow);">
                    <div class="analytics-grid">
                        <div class="analytics-card">
                            <h3 data-i18n="totalTasks">–í—Å—å–æ–≥–æ –∑–∞–≤–¥–∞–Ω—å</h3>
                            <div class="analytics-number" id="analyticsTotalTasks">0</div>
                        </div>
                        <div class="analytics-card">
                            <h3 data-i18n="completedTasks">–í–∏–∫–æ–Ω–∞–Ω–æ</h3>
                            <div class="analytics-number green" id="analyticsCompletedTasks">0</div>
                        </div>
                        <div class="analytics-card">
                            <h3 data-i18n="completionRate">–í–∏–∫–æ–Ω–∞–Ω–Ω—è %</h3>
                            <div class="analytics-number blue" id="analyticsCompletionRate">0%</div>
                        </div>
                        <div class="analytics-card">
                            <h3 data-i18n="avgTime">–°–µ—Ä. —á–∞—Å</h3>
                            <div class="analytics-number orange" id="analyticsAvgTime">-</div>
                        </div>
                    </div>
                    <div id="analyticsContent" style="margin-top:1.5rem;"></div>
                </div>
            </div>

            <!-- ADMIN (only for superadmin) -->
            <div id="adminTab" class="tab-content">
                <div class="controls" style="background:linear-gradient(135deg,#fee2e2,#fecaca);">
                    <h2 style="font-size:1.1rem;color:#dc2626;" data-i18n="adminPanel">üîß –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å TALKO</h2>
                </div>
                <div style="background:white;border-radius:12px;padding:1rem;box-shadow:var(--shadow);margin-bottom:1rem;">
                    <h3 style="margin-bottom:1rem;" data-i18n="createCompany">‚ûï –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É –∫–æ–º–ø–∞–Ω—ñ—é</h3>
                    <form id="adminCreateForm" onsubmit="adminCreateCompany(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label" data-i18n="ownerEmail">Email –≤–ª–∞—Å–Ω–∏–∫–∞ *</label>
                                <input type="email" id="adminOwnerEmail" class="form-input" placeholder="client@email.com" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="passwordLabel">–ü–∞—Ä–æ–ª—å *</label>
                                <input type="text" id="adminOwnerPassword" class="form-input" placeholder="–º—ñ–Ω. 6 —Å–∏–º–≤–æ–ª—ñ–≤" required minlength="6">
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="ownerName">–Ü–º'—è –≤–ª–∞—Å–Ω–∏–∫–∞ *</label>
                                <input type="text" id="adminOwnerName" class="form-input" placeholder="–Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="companyName">–ù–∞–∑–≤–∞ –∫–æ–º–ø–∞–Ω—ñ—ó *</label>
                                <input type="text" id="adminCompanyName" class="form-input" placeholder="–¢–û–í –ö–æ–º–ø–∞–Ω—ñ—è" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success" style="margin-top:1rem;" id="adminCreateBtn" data-i18n="createCompanyBtn">üöÄ –°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–º–ø–∞–Ω—ñ—é —Ç–∞ Owner</button>
                    </form>
                </div>
                <div style="background:white;border-radius:12px;padding:1rem;box-shadow:var(--shadow);">
                    <h3 style="margin-bottom:1rem;" data-i18n="allCompanies">üìã –í—Å—ñ –∫–æ–º–ø–∞–Ω—ñ—ó</h3>
                    <div id="adminCompaniesContainer">
                        <div class="loading"><div class="spinner"></div></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><span class="close" onclick="closeModal('taskModal')">&times;</span><h2 id="taskModalTitle" data-i18n="newTask">–ù–æ–≤–µ –∑–∞–≤–¥–∞–Ω–Ω—è</h2></div>
            <div class="modal-body">
                <form id="taskForm" onsubmit="saveTask(event)">
                    <div class="form-grid">
                        <div class="form-group full-width"><label class="form-label" data-i18n="title">–ù–∞–∑–≤–∞ *</label><input type="text" id="taskTitle" class="form-input" required></div>
                        <div class="form-group"><label class="form-label" data-i18n="function">–§—É–Ω–∫—Ü—ñ—è</label><select id="taskFunction" class="form-select"><option value="" data-i18n="noFunction">–ë–µ–∑ —Ñ—É–Ω–∫—Ü—ñ—ó</option></select></div>
                        <div class="form-group"><label class="form-label" data-i18n="assignee">–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å *</label><select id="taskAssignee" class="form-select" required><option value="" data-i18n="select">–û–±–µ—Ä—ñ—Ç—å</option></select></div>
                        <div class="form-group"><label class="form-label" data-i18n="deadlineDate">–î–µ–¥–ª–∞–π–Ω (–¥–∞—Ç–∞) *</label><input type="date" id="taskDeadlineDate" class="form-input" required></div>
                        <div class="form-group"><label class="form-label" data-i18n="deadlineTime">–î–µ–¥–ª–∞–π–Ω (—á–∞—Å) *</label><input type="time" id="taskDeadlineTime" class="form-input" required></div>
                        <div class="form-group"><label class="form-label" data-i18n="estimatedTime">–û—Ä—ñ—î–Ω—Ç–æ–≤–Ω–∏–π —á–∞—Å</label><select id="taskEstimatedTime" class="form-select"><option value="" data-i18n="notSpecified">–ù–µ –≤–∫–∞–∑–∞–Ω–æ</option><option value="15">15 —Ö–≤</option><option value="30">30 —Ö–≤</option><option value="45">45 —Ö–≤</option><option value="60">1 –≥–æ–¥</option><option value="90">1.5 –≥–æ–¥</option><option value="120">2 –≥–æ–¥</option><option value="180">3 –≥–æ–¥</option><option value="240">4 –≥–æ–¥</option><option value="480">8 –≥–æ–¥</option></select></div>
                        <div class="form-group"><label class="form-label" data-i18n="priority">–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç</label><select id="taskPriority" class="form-select"><option value="low" data-i18n="priorityLow">–ù–∏–∑—å–∫–∏–π</option><option value="medium" selected data-i18n="priorityMedium">–°–µ—Ä–µ–¥–Ω—ñ–π</option><option value="high" data-i18n="priorityHigh">–í–∏—Å–æ–∫–∏–π</option></select></div>
                        <div class="form-group"><label class="form-label" data-i18n="status">–°—Ç–∞—Ç—É—Å</label><select id="taskStatus" class="form-select"><option value="new" data-i18n="statusNew">–ù–æ–≤–µ</option><option value="progress" data-i18n="statusProgress">–í —Ä–æ–±–æ—Ç—ñ</option><option value="review" data-i18n="statusReview">–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞</option><option value="done" data-i18n="statusDone">–ì–æ—Ç–æ–≤–æ</option></select></div>
                        <div class="form-group full-width"><label class="form-label" data-i18n="expectedResult">–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</label><textarea id="taskExpectedResult" class="form-textarea" placeholder="–©–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –º–∞—î –±—É—Ç–∏ –∑—Ä–æ–±–ª–µ–Ω–æ?"></textarea></div>
                        <div class="form-group full-width"><label class="form-label" data-i18n="reportFormat">–§–æ—Ä–º–∞—Ç –∑–≤—ñ—Ç—É</label><input type="text" id="taskReportFormat" class="form-input" placeholder="–°–∫—Ä—ñ–Ω / –ü–æ—Å–∏–ª–∞–Ω–Ω—è / –§–æ—Ç–æ / –î–æ–∫—É–º–µ–Ω—Ç"></div>
                        <div class="form-group full-width"><label class="form-label" data-i18n="description">–û–ø–∏—Å</label><textarea id="taskDescription" class="form-textarea"></textarea></div>
                    </div>
                    <div class="form-actions"><button type="button" class="btn" onclick="closeModal('taskModal')" data-i18n="cancel">–°–∫–∞—Å—É–≤–∞—Ç–∏</button><button type="submit" class="btn btn-success" data-i18n="save">–ó–±–µ—Ä–µ–≥—Ç–∏</button></div>
                </form>
            </div>
        </div>
    </div>

    <div id="functionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><span class="close" onclick="closeModal('functionModal')">&times;</span><h2 id="functionModalTitle" data-i18n="newFunction">–ù–æ–≤–∞ —Ñ—É–Ω–∫—Ü—ñ—è</h2></div>
            <div class="modal-body">
                <form id="functionForm" onsubmit="saveFunction(event)">
                    <div class="form-grid">
                        <div class="form-group"><label class="form-label" data-i18n="title">–ù–∞–∑–≤–∞ *</label><input type="text" id="functionName" class="form-input" required></div>
                        <div class="form-group"><label class="form-label" data-i18n="head">üëë –ì–æ–ª–æ–≤–Ω–∏–π *</label><select id="functionHead" class="form-select" required><option value="" data-i18n="select">–û–±–µ—Ä—ñ—Ç—å</option></select></div>
                        <div class="form-group full-width"><label class="form-label" data-i18n="description">–û–ø–∏—Å</label><textarea id="functionDescription" class="form-textarea"></textarea></div>
                        <div class="form-group full-width"><label class="form-label" data-i18n="members">üë• –£—á–∞—Å–Ω–∏–∫–∏</label><div id="functionAssignees" style="display:flex;flex-wrap:wrap;gap:0.4rem;margin-top:0.4rem;"></div></div>
                    </div>
                    <div class="form-actions"><button type="button" class="btn" onclick="closeModal('functionModal')" data-i18n="cancel">–°–∫–∞—Å—É–≤–∞—Ç–∏</button><button type="submit" class="btn btn-success" data-i18n="save">–ó–±–µ—Ä–µ–≥—Ç–∏</button></div>
                </form>
            </div>
        </div>
    </div>

    <div id="regularTaskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><span class="close" onclick="closeModal('regularTaskModal')">&times;</span><h2 data-i18n="regularTask">–†–µ–≥—É–ª—è—Ä–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è</h2></div>
            <div class="modal-body">
                <form id="regularTaskForm" onsubmit="saveRegularTask(event)">
                    <div class="form-grid">
                        <div class="form-group full-width"><label class="form-label" data-i18n="title">–ù–∞–∑–≤–∞ *</label><input type="text" id="regularTaskTitle" class="form-input" required></div>
                        <div class="form-group"><label class="form-label" data-i18n="function">–§—É–Ω–∫—Ü—ñ—è *</label><select id="regularTaskFunction" class="form-select" required onchange="updateRegularTaskAssignees()"><option value="" data-i18n="select">–û–±–µ—Ä—ñ—Ç—å</option></select></div>
                        <div class="form-group"><label class="form-label" data-i18n="periodicity">–ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ—Å—Ç—å *</label><select id="regularTaskPeriod" class="form-select" onchange="updatePeriodOptions()"><option value="weekly" data-i18n="weekly">–©–æ—Ç–∏–∂–Ω—è</option><option value="monthly" data-i18n="monthly">–©–æ–º—ñ—Å—è—Ü—è</option><option value="quarterly" data-i18n="quarterly">–©–æ–∫–≤–∞—Ä—Ç–∞–ª—É</option></select></div>
                        <div class="form-group" id="dayOfWeekGroup"><label class="form-label" data-i18n="dayOfWeek">–î–µ–Ω—å —Ç–∏–∂–Ω—è *</label><select id="regularTaskDayOfWeek" class="form-select"><option value="1" data-i18n="monday">–ü–æ–Ω–µ–¥—ñ–ª–æ–∫</option><option value="2" data-i18n="tuesday">–í—ñ–≤—Ç–æ—Ä–æ–∫</option><option value="3" data-i18n="wednesday">–°–µ—Ä–µ–¥–∞</option><option value="4" data-i18n="thursday">–ß–µ—Ç–≤–µ—Ä</option><option value="5" data-i18n="friday">–ü'—è—Ç–Ω–∏—Ü—è</option><option value="6" data-i18n="saturday">–°—É–±–æ—Ç–∞</option><option value="0" data-i18n="sunday">–ù–µ–¥—ñ–ª—è</option></select></div>
                        <div class="form-group" id="dayOfMonthGroup" style="display:none;"><label class="form-label" data-i18n="dayOfMonth">–î–µ–Ω—å –º—ñ—Å—è—Ü—è *</label><select id="regularTaskDayOfMonth" class="form-select"><option value="1">1</option><option value="5">5</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="last" data-i18n="lastDay">–û—Å—Ç–∞–Ω–Ω—ñ–π –¥–µ–Ω—å</option></select></div>
                        <div class="form-group"><label class="form-label" data-i18n="timeOfDay">–ß–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è *</label><input type="time" id="regularTaskTime" class="form-input" value="10:00" required></div>
                        <div class="form-group full-width"><label class="form-label" data-i18n="expectedResult">–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</label><textarea id="regularTaskExpectedResult" class="form-textarea" placeholder="–©–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –º–∞—î –±—É—Ç–∏ –∑—Ä–æ–±–ª–µ–Ω–æ?"></textarea></div>
                        <div class="form-group full-width"><label class="form-label" data-i18n="reportFormat">–§–æ—Ä–º–∞—Ç –∑–≤—ñ—Ç—É</label><input type="text" id="regularTaskReportFormat" class="form-input" placeholder="–°–∫—Ä—ñ–Ω / –ü–æ—Å–∏–ª–∞–Ω–Ω—è / –§–æ—Ç–æ / –î–æ–∫—É–º–µ–Ω—Ç"></div>
                        <div class="form-group full-width"><label class="form-label" data-i18n="instruction">üìã –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ)</label><textarea id="regularTaskInstruction" class="form-textarea" style="min-height:100px;" placeholder="–î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è —è–∫ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ —Ü–µ –∑–∞–≤–¥–∞–Ω–Ω—è..."></textarea></div>
                        <div class="form-group full-width"><label class="form-label" data-i18n="assignees">üë• –í–∏–∫–æ–Ω–∞–≤—Ü—ñ</label><div id="regularTaskAssignees" style="display:flex;flex-wrap:wrap;gap:0.4rem;margin-top:0.4rem;padding:0.8rem;background:#f8f9fa;border-radius:8px;"><p style="color:#7f8c8d;" data-i18n="selectFunctionFirst">–°–ø–æ—á–∞—Ç–∫—É –æ–±–µ—Ä—ñ—Ç—å —Ñ—É–Ω–∫—Ü—ñ—é</p></div></div>
                    </div>
                    <div class="form-actions"><button type="button" class="btn" onclick="closeModal('regularTaskModal')" data-i18n="cancel">–°–∫–∞—Å—É–≤–∞—Ç–∏</button><button type="submit" class="btn btn-success" data-i18n="save">–ó–±–µ—Ä–µ–≥—Ç–∏</button></div>
                </form>
            </div>
        </div>
    </div>

    <div id="inviteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><span class="close" onclick="closeModal('inviteModal')">&times;</span><h2 data-i18n="inviteTitle">üì§ –ó–∞–ø—Ä–æ—à–µ–Ω–Ω—è</h2></div>
            <div class="modal-body">
                <form id="inviteForm" onsubmit="sendInvite(event)">
                    <div class="form-group">
                        <label class="form-label" data-i18n="employeeEmail">Email —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞ *</label>
                        <input type="email" id="inviteEmail" class="form-input" required>
                    </div>
                    <div class="form-group" style="margin-top:0.75rem;">
                        <label class="form-label" data-i18n="role">–†–æ–ª—å</label>
                        <select id="inviteRole" class="form-select"><option value="employee" data-i18n="roleEmployee">–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫</option><option value="manager" data-i18n="roleManager">–ú–µ–Ω–µ–¥–∂–µ—Ä</option></select>
                    </div>
                    <div id="inviteLink" style="margin-top:1rem;padding:1rem;background:#e3f2fd;border-radius:8px;display:none;">
                        <p style="font-size:0.85rem;margin-bottom:0.5rem;"><strong data-i18n="inviteLinkLabel">–ü–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è –≤—Ö–æ–¥—É:</strong></p>
                        <input type="text" id="inviteLinkText" class="form-input" readonly style="font-size:0.8rem;">
                        <button type="button" onclick="copyInviteLink()" class="btn btn-small" style="margin-top:0.5rem;" data-i18n="copy">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
                    </div>
                    <div class="form-actions"><button type="button" class="btn" onclick="closeModal('inviteModal')" data-i18n="close">–ó–∞–∫—Ä–∏—Ç–∏</button><button type="submit" class="btn btn-success" data-i18n="createInvite">üì§ –°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—è</button></div>
                </form>
            </div>
        </div>
    </div>

    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><span class="close" onclick="closeModal('userModal')">&times;</span><h2 id="userModalTitle" data-i18n="editEmployee">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞</h2></div>
            <div class="modal-body">
                <form id="userForm" onsubmit="saveUser(event)">
                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label class="form-label" data-i18n="name">–Ü–º'—è *</label>
                            <input type="text" id="userName" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" id="userEmail" class="form-input" readonly style="background:#f0f0f0;">
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="role">–†–æ–ª—å</label>
                            <select id="userRole" class="form-select">
                                <option value="employee" data-i18n="roleEmployee">–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫</option>
                                <option value="manager" data-i18n="roleManager">–ú–µ–Ω–µ–¥–∂–µ—Ä</option>
                            </select>
                        </div>
                        <div class="form-group full-width">
                            <label class="form-label" data-i18n="position">–ü–æ—Å–∞–¥–∞</label>
                            <input type="text" id="userPosition" class="form-input" placeholder="–ú–µ–Ω–µ–¥–∂–µ—Ä –∑ –ø—Ä–æ–¥–∞–∂—É">
                        </div>
                        <div class="form-group full-width">
                            <label class="form-label" data-i18n="userFunctions">–§—É–Ω–∫—Ü—ñ—ó —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞</label>
                            <div id="userFunctions" style="display:flex;flex-wrap:wrap;gap:0.4rem;margin-top:0.4rem;padding:0.8rem;background:#f8f9fa;border-radius:8px;"></div>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn" onclick="closeModal('userModal')" data-i18n="cancel">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                        <button type="submit" class="btn btn-success" data-i18n="save">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <a href="https://chatgpt.com/g/g-69382bfa841881918aff7b50aa25a4f9-talko-task-manager-support" target="_blank" class="support-btn">
        ü§ñ <span data-i18n="aiSupport">AI –ü—ñ–¥—Ç—Ä–∏–º–∫–∞</span>
    </a>

    <footer class="footer">
        <p>Powered by <strong style="color:#3498db;">TALKO System</strong></p>
    </footer>

    <script>
        // =====================
        // TRANSLATIONS
        // =====================
        const translations = {
            ua: {
                // Auth
                authSubtitle: '–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è–º–∏ –¥–ª—è –±—ñ–∑–Ω–µ—Å—É',
                signInGoogle: '–£–≤—ñ–π—Ç–∏ —á–µ—Ä–µ–∑ Google',
                or: '–∞–±–æ',
                password: '–ü–∞—Ä–æ–ª—å:',
                signIn: 'üîê –£–≤—ñ–π—Ç–∏',
                forgotPassword: '–ó–∞–±—É–ª–∏ –ø–∞—Ä–æ–ª—å?',
                noAccess: '–ù–µ–º–∞—î –¥–æ—Å—Ç—É–ø—É?',
                contactUs: "–ó–≤'—è–∂—ñ—Ç—å—Å—è –∑ –Ω–∞–º–∏",
                noAccessTitle: 'üö´ –î–æ—Å—Ç—É–ø –≤—ñ–¥—Å—É—Ç–Ω—ñ–π',
                noAccessText: "–í–∞—à email –Ω–µ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ –≤ —Å–∏—Å—Ç–µ–º—ñ.<br>–ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É.",
                contactSupport: "üìû –ó–≤'—è–∑–∞—Ç–∏—Å—è –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é",
                tryAnotherEmail: 'üîÑ –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ —ñ–Ω—à–∏–π email',
                haveInvite: '–Ñ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—è?',
                registerBtn: 'üìù –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è',
                registerTitle: 'üìù –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∑–∞ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—è–º',
                createPassword: '–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å:',
                confirmPassword: '–ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å:',
                registerSubmit: '‚úÖ –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è',
                backToLogin: '‚Üê –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –≤—Ö–æ–¥—É',
                logout: 'üö™ –í–∏–π—Ç–∏',
                
                // Tabs
                tabTasks: 'üìã –ó–∞–≤–¥–∞–Ω–Ω—è',
                tabControl: 'üìä –ö–æ–Ω—Ç—Ä–æ–ª—å',
                tabRegular: 'üîÑ –†–µ–≥—É–ª—è—Ä–Ω—ñ',
                tabFunctions: '‚öôÔ∏è –§—É–Ω–∫—Ü—ñ—ó',
                tabTeam: 'üë• –ö–æ–º–∞–Ω–¥–∞',
                tabAdmin: 'üîß –ê–¥–º—ñ–Ω',
                
                // Tasks
                addTask: '+ –ó–∞–≤–¥–∞–Ω–Ω—è',
                allStatuses: '–í—Å—ñ —Å—Ç–∞—Ç—É—Å–∏',
                allFunctions: '–í—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó',
                allDates: '–í—Å—ñ –¥–∞—Ç–∏',
                today: '–°—å–æ–≥–æ–¥–Ω—ñ',
                thisWeek: '–¶–µ–π —Ç–∏–∂–¥–µ–Ω—å',
                thisMonth: '–¶–µ–π –º—ñ—Å—è—Ü—å',
                customPeriod: '–û–±—Ä–∞—Ç–∏ –ø–µ—Ä—ñ–æ–¥',
                overdue: '–ü—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω—ñ',
                all: '–í—Å—ñ',
                newTask: '–ù–æ–≤–µ –∑–∞–≤–¥–∞–Ω–Ω—è',
                editTask: '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏',
                title: '–ù–∞–∑–≤–∞ *',
                function: '–§—É–Ω–∫—Ü—ñ—è',
                noFunction: '–ë–µ–∑ —Ñ—É–Ω–∫—Ü—ñ—ó',
                assignee: '–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å *',
                select: '–û–±–µ—Ä—ñ—Ç—å',
                deadlineDate: '–î–µ–¥–ª–∞–π–Ω (–¥–∞—Ç–∞) *',
                deadlineTime: '–î–µ–¥–ª–∞–π–Ω (—á–∞—Å) *',
                estimatedTime: '–û—Ä—ñ—î–Ω—Ç–æ–≤–Ω–∏–π —á–∞—Å',
                notSpecified: '–ù–µ –≤–∫–∞–∑–∞–Ω–æ',
                expectedResult: '–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç',
                reportFormat: '–§–æ—Ä–º–∞—Ç –∑–≤—ñ—Ç—É',
                priority: '–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç',
                status: '–°—Ç–∞—Ç—É—Å',
                description: '–û–ø–∏—Å',
                cancel: '–°–∫–∞—Å—É–≤–∞—Ç–∏',
                save: '–ó–±–µ—Ä–µ–≥—Ç–∏',
                close: '–ó–∞–∫—Ä–∏—Ç–∏',
                
                // Statuses
                statusNew: '–ù–æ–≤–µ',
                statusProgress: '–í —Ä–æ–±–æ—Ç—ñ',
                statusReview: '–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞',
                statusDone: '–ì–æ—Ç–æ–≤–æ',
                
                // Priorities
                priorityLow: '–ù–∏–∑—å–∫–∏–π',
                priorityMedium: '–°–µ—Ä–µ–¥–Ω—ñ–π',
                priorityHigh: '–í–∏—Å–æ–∫–∏–π',
                
                // Control
                controlPanel: 'üìä –ü–∞–Ω–µ–ª—å –∫–æ–Ω—Ç—Ä–æ–ª—é',
                critical: 'üö® –ö—Ä–∏—Ç–∏—á–Ω—ñ',
                attention: '‚ö†Ô∏è –£–≤–∞–≥–∞',
                active: 'üîÑ –ê–∫—Ç–∏–≤–Ω—ñ',
                completed: '‚úÖ –ì–æ—Ç–æ–≤–æ',
                workload: 'üë• –ù–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è',
                noActiveTasks: '–ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å',
                
                // Regular
                addRegular: '+ –†–µ–≥—É–ª—è—Ä–Ω–µ',
                regularTask: '–†–µ–≥—É–ª—è—Ä–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è',
                periodicity: '–ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ—Å—Ç—å *',
                weekly: '–©–æ—Ç–∏–∂–Ω—è',
                monthly: '–©–æ–º—ñ—Å—è—Ü—è',
                quarterly: '–©–æ–∫–≤–∞—Ä—Ç–∞–ª—É',
                dayOfWeek: '–î–µ–Ω—å —Ç–∏–∂–Ω—è *',
                dayOfMonth: '–î–µ–Ω—å –º—ñ—Å—è—Ü—è *',
                timeOfDay: '–ß–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è *',
                lastDay: '–û—Å—Ç–∞–Ω–Ω—ñ–π –¥–µ–Ω—å',
                monday: '–ü–æ–Ω–µ–¥—ñ–ª–æ–∫',
                tuesday: '–í—ñ–≤—Ç–æ—Ä–æ–∫',
                wednesday: '–°–µ—Ä–µ–¥–∞',
                thursday: '–ß–µ—Ç–≤–µ—Ä',
                friday: "–ü'—è—Ç–Ω–∏—Ü—è",
                saturday: '–°—É–±–æ—Ç–∞',
                sunday: '–ù–µ–¥—ñ–ª—è',
                instruction: 'üìã –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è (–Ω–µ–æ–±–æ–≤\'—è–∑–∫–æ–≤–æ)',
                allPeriods: '–í—Å—ñ –ø–µ—Ä—ñ–æ–¥–∏',
                assignees: 'üë• –í–∏–∫–æ–Ω–∞–≤—Ü—ñ',
                selectFunctionFirst: '–°–ø–æ—á–∞—Ç–∫—É –æ–±–µ—Ä—ñ—Ç—å —Ñ—É–Ω–∫—Ü—ñ—é',
                noMembers: '–ù–µ–º–∞—î —É—á–∞—Å–Ω–∏–∫—ñ–≤',
                create: '‚ö° –°—Ç–≤–æ—Ä–∏—Ç–∏',
                radarAI: '–ö–µ—Ä—ñ–≤–Ω–∏–∫',
                techAI: '–ü–æ–º—ñ—á–Ω–∏–∫',
                
                // Functions
                addFunction: '+ –§—É–Ω–∫—Ü—ñ—è',
                newFunction: '–ù–æ–≤–∞ —Ñ—É–Ω–∫—Ü—ñ—è',
                head: 'üëë –ì–æ–ª–æ–≤–Ω–∏–π *',
                members: 'üë• –£—á–∞—Å–Ω–∏–∫–∏',
                tasks: '–∑–∞–≤–¥–∞–Ω—å',
                
                // Team
                invite: 'üì§ –ó–∞–ø—Ä–æ—Å–∏—Ç–∏',
                inviteTitle: 'üì§ –ó–∞–ø—Ä–æ—à–µ–Ω–Ω—è',
                employeeEmail: 'Email —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞ *',
                role: '–†–æ–ª—å',
                roleOwner: '–í–ª–∞—Å–Ω–∏–∫',
                roleManager: '–ú–µ–Ω–µ–¥–∂–µ—Ä',
                roleEmployee: '–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫',
                inviteLinkLabel: '–ü–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è –≤—Ö–æ–¥—É:',
                copy: 'üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏',
                createInvite: 'üì§ –°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—è',
                
                // Admin
                adminPanel: 'üîß –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å TALKO',
                createCompany: '‚ûï –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É –∫–æ–º–ø–∞–Ω—ñ—é',
                ownerEmail: 'Email –≤–ª–∞—Å–Ω–∏–∫–∞ *',
                passwordLabel: '–ü–∞—Ä–æ–ª—å *',
                ownerName: "–Ü–º'—è –≤–ª–∞—Å–Ω–∏–∫–∞ *",
                companyName: '–ù–∞–∑–≤–∞ –∫–æ–º–ø–∞–Ω—ñ—ó *',
                createCompanyBtn: 'üöÄ –°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–º–ø–∞–Ω—ñ—é —Ç–∞ Owner',
                allCompanies: 'üìã –í—Å—ñ –∫–æ–º–ø–∞–Ω—ñ—ó',
                users: '–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤',
                
                // Empty states
                noTasks: 'üìã –ó–∞–≤–¥–∞–Ω—å –Ω–µ–º–∞—î',
                createFirstTask: '–°—Ç–≤–æ—Ä—ñ—Ç—å –ø–µ—Ä—à–µ –∑–∞–≤–¥–∞–Ω–Ω—è',
                noFunctions: '‚öôÔ∏è –§—É–Ω–∫—Ü—ñ–π –Ω–µ–º–∞—î',
                createFirstFunction: '–°—Ç–≤–æ—Ä—ñ—Ç—å –ø–µ—Ä—à—É —Ñ—É–Ω–∫—Ü—ñ—é',
                noRegular: 'üîÑ –†–µ–≥—É–ª—è—Ä–Ω–∏—Ö –Ω–µ–º–∞—î',
                createRegular: '–°—Ç–≤–æ—Ä—ñ—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è',
                noUsers: 'üë• –ù–µ–º–∞—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤',
                noCompanies: '–ù–µ–º–∞—î –∫–æ–º–ø–∞–Ω—ñ–π',
                
                // Other
                support: '–ü—ñ–¥—Ç—Ä–∏–º–∫–∞',
                aiSupport: 'AI –ü—ñ–¥—Ç—Ä–∏–º–∫–∞',
                footerSupport: 'üõü –ü—ñ–¥—Ç—Ä–∏–º–∫–∞',
                notAssigned: '–ù–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–æ',
                deleteConfirm: '–í–∏–¥–∞–ª–∏—Ç–∏?',
                error: '–ü–æ–º–∏–ª–∫–∞',
                created: '—Å—Ç–≤–æ—Ä–µ–Ω–æ',
                copied: 'üìã –ü–æ—Å–∏–ª–∞–Ω–Ω—è —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!',
                
                // New filters & analytics
                clear: '–û—á–∏—Å—Ç–∏—Ç–∏',
                allTasks: '–í—Å—ñ –∑–∞–≤–¥–∞–Ω–Ω—è',
                myTasks: '–ú–æ—ó –∑–∞–≤–¥–∞–Ω–Ω—è',
                createdByMe: '–°—Ç–≤–æ—Ä–µ–Ω—ñ –º–Ω–æ—é',
                statuses: '–°—Ç–∞—Ç—É—Å–∏',
                functions: '–§—É–Ω–∫—Ü—ñ—ó',
                task: '–ó–∞–≤–¥–∞–Ω–Ω—è',
                createdBy: '–°—Ç–≤–æ—Ä–∏–≤',
                deadline: '–î–µ–¥–ª–∞–π–Ω',
                type: '–¢–∏–ø',
                actions: '–î—ñ—ó',
                noTasksFound: '–ó–∞–≤–¥–∞–Ω—å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ',
                changeFilters: '–ó–º—ñ–Ω—ñ—Ç—å —Ñ—ñ–ª—å—Ç—Ä–∏ –∞–±–æ –¥–æ–¥–∞–π—Ç–µ –Ω–æ–≤–µ –∑–∞–≤–¥–∞–Ω–Ω—è',
                edit: '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏',
                delete: '–í–∏–¥–∞–ª–∏—Ç–∏',
                
                // Control panel
                controlPanelTitle: '–ü–∞–Ω–µ–ª—å –∫–æ–Ω—Ç—Ä–æ–ª—é –∑–∞–≤–¥–∞–Ω—å',
                assigneeLabel: '–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å:',
                functionLabel: '–§—É–Ω–∫—Ü—ñ—è:',
                periodLabel: '–ü–µ—Ä—ñ–æ–¥:',
                allAssignees: '–í—Å—ñ –≤–∏–∫–æ–Ω–∞–≤—Ü—ñ',
                allTime: '–í–µ—Å—å —á–∞—Å',
                thisMonth: '–¶–µ–π –º—ñ—Å—è—Ü—å',
                overdueLabel: '–ü—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω—ñ',
                todayTomorrow: '–°—å–æ–≥–æ–¥–Ω—ñ-–∑–∞–≤—Ç—Ä–∞',
                inWork: '–í —Ä–æ–±–æ—Ç—ñ',
                completedLabel: '–ó–∞–≤–µ—Ä—à–µ–Ω—ñ',
                viewLabel: '–ü–µ—Ä–µ–≥–ª—è–¥:',
                employeeWorkload: '–ù–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤',
                byFunctions: '–ü–æ —Ñ—É–Ω–∫—Ü—ñ—è—Ö',
                
                // Analytics
                tabAnalytics: '–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞',
                analytics: 'üìà –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞',
                totalTasks: '–í—Å—å–æ–≥–æ –∑–∞–≤–¥–∞–Ω—å',
                completedTasks: '–í–∏–∫–æ–Ω–∞–Ω–æ',
                completionRate: '–í–∏–∫–æ–Ω–∞–Ω–Ω—è %',
                avgTime: '–°–µ—Ä. —á–∞—Å',
                byStatus: '–ü–æ —Å—Ç–∞—Ç—É—Å–∞—Ö',
                topPerformers: '–¢–æ–ø –≤–∏–∫–æ–Ω–∞–≤—Ü—ñ–≤',
                noCompletedTasks: '–ù–µ–º–∞—î –≤–∏–∫–æ–Ω–∞–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å',
                
                // Users
                tabUsers: '–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∏',
                addEmployee: '+ –î–æ–¥–∞—Ç–∏ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞',
                editEmployee: '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞',
                name: "–Ü–º'—è *",
                position: '–ü–æ—Å–∞–¥–∞',
                userFunctions: '–§—É–Ω–∫—Ü—ñ—ó —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞',
                inviteFirst: '–ó–∞–ø—Ä–æ—Å—ñ—Ç—å –ø–µ—Ä—à–æ–≥–æ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞',
                noEmployees: '–ù–µ–º–∞—î —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤',
                
                // Regular
                addRegularTask: '+ –†–µ–≥—É–ª—è—Ä–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è',
            },
            ru: {
                // Auth
                authSubtitle: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏ –¥–ª—è –±–∏–∑–Ω–µ—Å–∞',
                signInGoogle: '–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google',
                or: '–∏–ª–∏',
                password: '–ü–∞—Ä–æ–ª—å:',
                signIn: 'üîê –í–æ–π—Ç–∏',
                forgotPassword: '–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?',
                noAccess: '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞?',
                contactUs: '–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏',
                noAccessTitle: 'üö´ –î–æ—Å—Ç—É–ø –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç',
                noAccessText: '–í–∞—à email –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ —Å–∏—Å—Ç–µ–º–µ.<br>–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞.',
                contactSupport: 'üìû –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π',
                tryAnotherEmail: 'üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π email',
                haveInvite: '–ï—Å—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ?',
                registerBtn: 'üìù –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è',
                registerTitle: 'üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—é',
                createPassword: '–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å:',
                confirmPassword: '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:',
                registerSubmit: '‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è',
                backToLogin: '‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫–æ –≤—Ö–æ–¥—É',
                logout: 'üö™ –í—ã–π—Ç–∏',
                
                // Tabs
                tabTasks: 'üìã –ó–∞–¥–∞—á–∏',
                tabControl: 'üìä –ö–æ–Ω—Ç—Ä–æ–ª—å',
                tabRegular: 'üîÑ –†–µ–≥—É–ª—è—Ä–Ω—ã–µ',
                tabFunctions: '‚öôÔ∏è –§—É–Ω–∫—Ü–∏–∏',
                tabTeam: 'üë• –ö–æ–º–∞–Ω–¥–∞',
                tabAdmin: 'üîß –ê–¥–º–∏–Ω',
                
                // Tasks
                addTask: '+ –ó–∞–¥–∞—á–∞',
                allStatuses: '–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã',
                allFunctions: '–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏',
                allDates: '–í—Å–µ –¥–∞—Ç—ã',
                today: '–°–µ–≥–æ–¥–Ω—è',
                thisWeek: '–≠—Ç–∞ –Ω–µ–¥–µ–ª—è',
                thisMonth: '–≠—Ç–æ—Ç –º–µ—Å—è—Ü',
                customPeriod: '–í—ã–±—Ä–∞—Ç—å –ø–µ—Ä–∏–æ–¥',
                overdue: '–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ',
                all: '–í—Å–µ',
                newTask: '–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞',
                editTask: '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å',
                title: '–ù–∞–∑–≤–∞–Ω–∏–µ *',
                function: '–§—É–Ω–∫—Ü–∏—è',
                noFunction: '–ë–µ–∑ —Ñ—É–Ω–∫—Ü–∏–∏',
                assignee: '–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å *',
                select: '–í—ã–±–µ—Ä–∏—Ç–µ',
                deadlineDate: '–î–µ–¥–ª–∞–π–Ω (–¥–∞—Ç–∞) *',
                deadlineTime: '–î–µ–¥–ª–∞–π–Ω (–≤—Ä–µ–º—è) *',
                estimatedTime: '–û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–æ–µ –≤—Ä–µ–º—è',
                notSpecified: '–ù–µ —É–∫–∞–∑–∞–Ω–æ',
                expectedResult: '–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç',
                reportFormat: '–§–æ—Ä–º–∞—Ç –æ—Ç—á–µ—Ç–∞',
                priority: '–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç',
                status: '–°—Ç–∞—Ç—É—Å',
                description: '–û–ø–∏—Å–∞–Ω–∏–µ',
                cancel: '–û—Ç–º–µ–Ω–∞',
                save: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å',
                close: '–ó–∞–∫—Ä—ã—Ç—å',
                
                // Statuses
                statusNew: '–ù–æ–≤–æ–µ',
                statusProgress: '–í —Ä–∞–±–æ—Ç–µ',
                statusReview: '–ü—Ä–æ–≤–µ—Ä–∫–∞',
                statusDone: '–ì–æ—Ç–æ–≤–æ',
                
                // Priorities
                priorityLow: '–ù–∏–∑–∫–∏–π',
                priorityMedium: '–°—Ä–µ–¥–Ω–∏–π',
                priorityHigh: '–í—ã—Å–æ–∫–∏–π',
                
                // Control
                controlPanel: 'üìä –ü–∞–Ω–µ–ª—å –∫–æ–Ω—Ç—Ä–æ–ª—è',
                critical: 'üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ',
                attention: '‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ',
                active: 'üîÑ –ê–∫—Ç–∏–≤–Ω—ã–µ',
                completed: '‚úÖ –ì–æ—Ç–æ–≤–æ',
                workload: 'üë• –ù–∞–≥—Ä—É–∑–∫–∞',
                noActiveTasks: '–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á',
                
                // Regular
                addRegular: '+ –†–µ–≥—É–ª—è—Ä–Ω–æ–µ',
                regularTask: '–†–µ–≥—É–ª—è—Ä–Ω–∞—è –∑–∞–¥–∞—á–∞',
                periodicity: '–ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å *',
                weekly: '–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ',
                monthly: '–ï–∂–µ–º–µ—Å—è—á–Ω–æ',
                quarterly: '–ï–∂–µ–∫–≤–∞—Ä—Ç–∞–ª—å–Ω–æ',
                dayOfWeek: '–î–µ–Ω—å –Ω–µ–¥–µ–ª–∏ *',
                dayOfMonth: '–î–µ–Ω—å –º–µ—Å—è—Ü–∞ *',
                timeOfDay: '–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è *',
                lastDay: '–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å',
                monday: '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫',
                tuesday: '–í—Ç–æ—Ä–Ω–∏–∫',
                wednesday: '–°—Ä–µ–¥–∞',
                thursday: '–ß–µ—Ç–≤–µ—Ä–≥',
                friday: '–ü—è—Ç–Ω–∏—Ü–∞',
                saturday: '–°—É–±–±–æ—Ç–∞',
                sunday: '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ',
                instruction: 'üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)',
                allPeriods: '–í—Å–µ –ø–µ—Ä–∏–æ–¥—ã',
                assignees: 'üë• –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏',
                selectFunctionFirst: '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é',
                noMembers: '–ù–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤',
                create: '‚ö° –°–æ–∑–¥–∞—Ç—å',
                radarAI: '–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å',
                techAI: '–ü–æ–º–æ—â–Ω–∏–∫',
                
                // Functions
                addFunction: '+ –§—É–Ω–∫—Ü–∏—è',
                newFunction: '–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è',
                head: 'üëë –ì–ª–∞–≤–Ω—ã–π *',
                members: 'üë• –£—á–∞—Å—Ç–Ω–∏–∫–∏',
                tasks: '–∑–∞–¥–∞—á',
                
                // Team
                invite: 'üì§ –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å',
                inviteTitle: 'üì§ –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ',
                employeeEmail: 'Email —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ *',
                role: '–†–æ–ª—å',
                roleOwner: '–í–ª–∞–¥–µ–ª–µ—Ü',
                roleManager: '–ú–µ–Ω–µ–¥–∂–µ—Ä',
                roleEmployee: '–°–æ—Ç—Ä—É–¥–Ω–∏–∫',
                inviteLinkLabel: '–°—Å—ã–ª–∫–∞ –¥–ª—è –≤—Ö–æ–¥–∞:',
                copy: 'üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å',
                createInvite: 'üì§ –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ',
                
                // Admin
                adminPanel: 'üîß –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å TALKO',
                createCompany: '‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–æ–º–ø–∞–Ω–∏—é',
                ownerEmail: 'Email –≤–ª–∞–¥–µ–ª—å—Ü–∞ *',
                passwordLabel: '–ü–∞—Ä–æ–ª—å *',
                ownerName: '–ò–º—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ *',
                companyName: '–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ *',
                createCompanyBtn: 'üöÄ –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–∞–Ω–∏—é –∏ Owner',
                allCompanies: 'üìã –í—Å–µ –∫–æ–º–ø–∞–Ω–∏–∏',
                users: '–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π',
                
                // Empty states
                noTasks: 'üìã –ó–∞–¥–∞—á –Ω–µ—Ç',
                createFirstTask: '–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É',
                noFunctions: '‚öôÔ∏è –§—É–Ω–∫—Ü–∏–π –Ω–µ—Ç',
                createFirstFunction: '–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é',
                noRegular: 'üîÑ –†–µ–≥—É–ª—è—Ä–Ω—ã—Ö –Ω–µ—Ç',
                createRegular: '–°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–≥—É–ª—è—Ä–Ω—É—é –∑–∞–¥–∞—á—É',
                noUsers: 'üë• –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π',
                noCompanies: '–ù–µ—Ç –∫–æ–º–ø–∞–Ω–∏–π',
                
                // Other
                support: '–ü–æ–¥–¥–µ—Ä–∂–∫–∞',
                aiSupport: 'AI –ü–æ–¥–¥–µ—Ä–∂–∫–∞',
                footerSupport: 'üõü –ü–æ–¥–¥–µ—Ä–∂–∫–∞',
                notAssigned: '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ',
                deleteConfirm: '–£–¥–∞–ª–∏—Ç—å?',
                error: '–û—à–∏–±–∫–∞',
                created: '—Å–æ–∑–¥–∞–Ω–æ',
                copied: 'üìã –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!',
                
                // New filters & analytics
                clear: '–û—á–∏—Å—Ç–∏—Ç—å',
                allTasks: '–í—Å–µ –∑–∞–¥–∞—á–∏',
                myTasks: '–ú–æ–∏ –∑–∞–¥–∞—á–∏',
                createdByMe: '–°–æ–∑–¥–∞–Ω–Ω—ã–µ –º–Ω–æ–π',
                statuses: '–°—Ç–∞—Ç—É—Å—ã',
                functions: '–§—É–Ω–∫—Ü–∏–∏',
                task: '–ó–∞–¥–∞—á–∞',
                createdBy: '–°–æ–∑–¥–∞–ª',
                deadline: '–î–µ–¥–ª–∞–π–Ω',
                type: '–¢–∏–ø',
                actions: '–î–µ–π—Å—Ç–≤–∏—è',
                noTasksFound: '–ó–∞–¥–∞—á –Ω–µ –Ω–∞–π–¥–µ–Ω–æ',
                changeFilters: '–ò–∑–º–µ–Ω–∏—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É',
                edit: '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å',
                delete: '–£–¥–∞–ª–∏—Ç—å',
                
                // Control panel
                controlPanelTitle: '–ü–∞–Ω–µ–ª—å –∫–æ–Ω—Ç—Ä–æ–ª—è –∑–∞–¥–∞—á',
                assigneeLabel: '–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:',
                functionLabel: '–§—É–Ω–∫—Ü–∏—è:',
                periodLabel: '–ü–µ—Ä–∏–æ–¥:',
                allAssignees: '–í—Å–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏',
                allTime: '–í—Å–µ –≤—Ä–µ–º—è',
                thisMonth: '–≠—Ç–æ—Ç –º–µ—Å—è—Ü',
                overdueLabel: '–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ',
                todayTomorrow: '–°–µ–≥–æ–¥–Ω—è-–∑–∞–≤—Ç—Ä–∞',
                inWork: '–í —Ä–∞–±–æ—Ç–µ',
                completedLabel: '–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ',
                viewLabel: '–ü—Ä–æ—Å–º–æ—Ç—Ä:',
                employeeWorkload: '–ù–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤',
                byFunctions: '–ü–æ —Ñ—É–Ω–∫—Ü–∏—è–º',
                
                // Analytics
                tabAnalytics: '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞',
                analytics: 'üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞',
                totalTasks: '–í—Å–µ–≥–æ –∑–∞–¥–∞—á',
                completedTasks: '–í—ã–ø–æ–ª–Ω–µ–Ω–æ',
                completionRate: '–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ %',
                avgTime: '–°—Ä–µ–¥. –≤—Ä–µ–º—è',
                byStatus: '–ü–æ —Å—Ç–∞—Ç—É—Å–∞–º',
                topPerformers: '–¢–æ–ø –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π',
                noCompletedTasks: '–ù–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á',
                
                // Users
                tabUsers: '–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏',
                addEmployee: '+ –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞',
                editEmployee: '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞',
                name: '–ò–º—è *',
                position: '–î–æ–ª–∂–Ω–æ—Å—Ç—å',
                userFunctions: '–§—É–Ω–∫—Ü–∏–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞',
                inviteFirst: '–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –ø–µ—Ä–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞',
                noEmployees: '–ù–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤',
                
                // Regular
                addRegularTask: '+ –†–µ–≥—É–ª—è—Ä–Ω–∞—è –∑–∞–¥–∞—á–∞',
            }
        };

        let currentLang = localStorage.getItem('talko_lang') || 'ua';

        function t(key) {
            return translations[currentLang][key] || translations['ua'][key] || key;
        }

        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('talko_lang', lang);
            
            document.getElementById('langUA').classList.toggle('active', lang === 'ua');
            document.getElementById('langRU').classList.toggle('active', lang === 'ru');
            
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    if (el.tagName === 'INPUT' && el.type !== 'text' && el.type !== 'email') {
                        el.value = translations[lang][key];
                    } else {
                        el.innerHTML = translations[lang][key];
                    }
                }
            });
            
            // Re-render dynamic content
            if (currentCompany || isSuperAdmin) {
                const activeTab = document.querySelector('.tab-btn.active');
                if (activeTab) {
                    const tabName = activeTab.getAttribute('onclick').match(/switchTab\('(\w+)'\)/)[1];
                    switchTab(tabName);
                }
            }
        }

        // =====================
        // FIREBASE CONFIG
        // =====================
        const firebaseConfig = {
            apiKey: "AIzaSyD1oBJuuFiVVo4HHjjeb81IhGEt1oz4Ydc",
            authDomain: "task-manager-44e84.firebaseapp.com",
            projectId: "task-manager-44e84",
            storageBucket: "task-manager-44e84.firebasestorage.app",
            messagingSenderId: "181519398491",
            appId: "1:181519398491:web:baa17a9a88f637ee94717e"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const googleProvider = new firebase.auth.GoogleAuthProvider();

        // =====================
        // APP STATE
        // =====================
        const SUPERADMIN_EMAIL = 'management.talco@gmail.com';
        let currentUser = null;
        let currentCompany = null;
        let currentUserData = null;
        let isSuperAdmin = false;
        let tasks = [];
        let users = [];
        let functions = [];
        let regularTasks = [];
        let editingId = null;

        // =====================
        // AUTH FUNCTIONS
        // =====================
        function showAuthMessage(msg, type = 'info') {
            const el = document.getElementById('authMessage');
            el.textContent = msg;
            el.className = 'auth-message ' + type;
            el.style.display = 'block';
        }

        function hideAuthMessage() {
            document.getElementById('authMessage').style.display = 'none';
        }

        function togglePassword(inputId, btn) {
            const input = document.getElementById(inputId);
            if (input.type === 'password') {
                input.type = 'text';
                btn.textContent = 'üôà';
            } else {
                input.type = 'password';
                btn.textContent = 'üëÅÔ∏è';
            }
        }

        function showNoAccess() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('noAccessCard').style.display = 'block';
        }

        function showLoginForm() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('noAccessCard').style.display = 'none';
            hideAuthMessage();
        }
        
        function showRegisterForm() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
            document.getElementById('noAccessCard').style.display = 'none';
            hideAuthMessage();
        }
        
        // –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∑–∞ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—è–º
        async function registerWithInvite() {
            const email = document.getElementById('registerEmail').value.trim().toLowerCase();
            const password = document.getElementById('registerPassword').value;
            const passwordConfirm = document.getElementById('registerPasswordConfirm').value;
            
            // –í–∞–ª—ñ–¥–∞—Ü—ñ—è
            if (!email) {
                showAuthMessage(currentLang === 'ua' ? '–í–≤–µ–¥—ñ—Ç—å email' : '–í–≤–µ–¥–∏—Ç–µ email', 'error');
                return;
            }
            
            if (!password || password.length < 6) {
                showAuthMessage(currentLang === 'ua' ? '–ü–∞—Ä–æ–ª—å –º–∞—î –±—É—Ç–∏ –º—ñ–Ω—ñ–º—É–º 6 —Å–∏–º–≤–æ–ª—ñ–≤' : '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
                return;
            }
            
            if (password !== passwordConfirm) {
                showAuthMessage(currentLang === 'ua' ? '–ü–∞—Ä–æ–ª—ñ –Ω–µ —Å–ø—ñ–≤–ø–∞–¥–∞—é—Ç—å' : '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç', 'error');
                return;
            }
            
            try {
                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î invite
                const invitesQuery = await db.collection('invites')
                    .where('email', '==', email)
                    .where('accepted', '==', false)
                    .limit(1)
                    .get();
                
                if (invitesQuery.empty) {
                    showAuthMessage(currentLang === 'ua' ? '‚ùå –ó–∞–ø—Ä–æ—à–µ–Ω–Ω—è –¥–ª—è —Ü—å–æ–≥–æ email –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ' : '‚ùå –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥–ª—è —ç—Ç–æ–≥–æ email –Ω–µ –Ω–∞–π–¥–µ–Ω–æ', 'error');
                    return;
                }
                
                showAuthMessage(currentLang === 'ua' ? '‚è≥ –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è...' : '‚è≥ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è...', 'info');
                
                // –°—Ç–≤–æ—Ä—é—î–º–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ Firebase Auth
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Invite –±—É–¥–µ –æ–±—Ä–æ–±–ª–µ–Ω–æ –≤ onAuthStateChanged —á–µ—Ä–µ–∑ findUserCompany
                showAuthMessage(currentLang === 'ua' ? '‚úÖ –£—Å–ø—ñ—à–Ω–æ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ!' : '‚úÖ –£—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ!', 'success');
                
            } catch (e) {
                let msg = currentLang === 'ua' ? '–ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó' : '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏';
                if (e.code === 'auth/email-already-in-use') {
                    msg = currentLang === 'ua' ? '–¶–µ–π email –≤–∂–µ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ. –°–ø—Ä–æ–±—É–π—Ç–µ —É–≤—ñ–π—Ç–∏.' : '–≠—Ç–æ—Ç email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏.';
                }
                if (e.code === 'auth/invalid-email') {
                    msg = currentLang === 'ua' ? '–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç email' : '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email';
                }
                if (e.code === 'auth/weak-password') {
                    msg = currentLang === 'ua' ? '–ó–∞–Ω–∞–¥—Ç–æ –ø—Ä–æ—Å—Ç–∏–π –ø–∞—Ä–æ–ª—å' : '–°–ª–∏—à–∫–æ–º –ø—Ä–æ—Å—Ç–æ–π –ø–∞—Ä–æ–ª—å';
                }
                showAuthMessage(msg, 'error');
            }
        }

        // Google Sign-In
        async function signInWithGoogle() {
            try {
                // –ù–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ redirect –∑–∞–º—ñ—Å—Ç—å popup
                const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
                if (isMobile) {
                    await auth.signInWithRedirect(googleProvider);
                } else {
                    await auth.signInWithPopup(googleProvider);
                }
            } catch (e) {
                showAuthMessage(t('error') + ': ' + e.message, 'error');
            }
        }
        
        // –û–±—Ä–æ–±–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É redirect
        auth.getRedirectResult().then((result) => {
            if (result.user) {
                // –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —É–≤—ñ–π—à–æ–≤ —á–µ—Ä–µ–∑ redirect
                console.log('Redirect login success');
            }
        }).catch((e) => {
            if (e.code) {
                showAuthMessage(t('error') + ': ' + e.message, 'error');
            }
        });

        // Email + Password Sign In
        async function signInWithEmail() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showAuthMessage(currentLang === 'ua' ? '–í–≤–µ–¥—ñ—Ç—å email —ñ –ø–∞—Ä–æ–ª—å' : '–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å', 'error');
                return;
            }
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (e) {
                let msg = currentLang === 'ua' ? '–ü–æ–º–∏–ª–∫–∞ –≤—Ö–æ–¥—É' : '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞';
                if (e.code === 'auth/user-not-found') msg = currentLang === 'ua' ? '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ' : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω';
                if (e.code === 'auth/wrong-password') msg = currentLang === 'ua' ? '–ù–µ–≤—ñ—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å' : '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å';
                if (e.code === 'auth/invalid-email') msg = currentLang === 'ua' ? '–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç email' : '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email';
                if (e.code === 'auth/invalid-credential') msg = currentLang === 'ua' ? '–ù–µ–≤—ñ—Ä–Ω–∏–π email –∞–±–æ –ø–∞—Ä–æ–ª—å' : '–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
                showAuthMessage(msg, 'error');
            }
        }

        // Password Reset
        async function resetPassword() {
            const email = document.getElementById('loginEmail').value.trim();
            if (!email) {
                showAuthMessage(currentLang === 'ua' ? '–í–≤–µ–¥—ñ—Ç—å email –¥–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–∞—Ä–æ–ª—è' : '–í–≤–µ–¥–∏—Ç–µ email –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è', 'error');
                return;
            }
            
            try {
                await auth.sendPasswordResetEmail(email);
                showAuthMessage(currentLang === 'ua' ? 'üìß –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ –Ω–∞ ' + email : 'üìß –°—Å—ã–ª–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ ' + email, 'success');
            } catch (e) {
                showAuthMessage(t('error') + ': ' + e.message, 'error');
            }
        }

        async function findUserCompany(userId, email) {
            const userDoc = await db.collection('users').doc(userId).get();
            if (userDoc.exists) {
                return userDoc.data().companyId;
            }
            
            const invitesQuery = await db.collection('invites')
                .where('email', '==', email.toLowerCase())
                .where('accepted', '==', false)
                .limit(1)
                .get();
            
            if (!invitesQuery.empty) {
                const invite = invitesQuery.docs[0];
                const inviteData = invite.data();
                const companyId = inviteData.companyId;
                const isOwnerInvite = inviteData.role === 'owner';
                
                await db.collection('companies').doc(companyId).collection('users').doc(userId).set({
                    name: inviteData.ownerName || email.split('@')[0],
                    email: email.toLowerCase(),
                    role: inviteData.role || 'employee',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                await db.collection('users').doc(userId).set({
                    email: email.toLowerCase(),
                    companyId: companyId,
                    role: inviteData.role || 'employee'
                });
                
                if (isOwnerInvite) {
                    await db.collection('companies').doc(companyId).update({
                        ownerId: userId
                    });
                }
                
                await invite.ref.update({ accepted: true, acceptedAt: firebase.firestore.FieldValue.serverTimestamp() });
                
                return companyId;
            }
            
            return null;
        }

        function logout() {
            auth.signOut().then(() => {
                showLoginForm();
                hideAuthMessage();
            });
        }

        // =====================
        // AUTH STATE LISTENER
        // =====================
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                isSuperAdmin = user.email.toLowerCase() === SUPERADMIN_EMAIL.toLowerCase();
                
                if (isSuperAdmin) {
                    document.getElementById('adminTabBtn').style.display = 'block';
                }
                
                const companyId = await findUserCompany(user.uid, user.email);
                
                if (!companyId && !isSuperAdmin) {
                    document.getElementById('loadingPage').style.display = 'none';
                    document.getElementById('authPage').style.display = 'flex';
                    document.getElementById('mainInterface').style.display = 'none';
                    showNoAccess();
                    return;
                }
                
                if (!companyId && isSuperAdmin) {
                    currentCompany = null;
                    currentUserData = { id: user.uid, email: user.email, role: 'superadmin', name: 'Super Admin' };
                    document.getElementById('currentUserName').textContent = 'Super Admin';
                    document.getElementById('currentUserRole').textContent = currentLang === 'ua' ? '(–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä)' : '(–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)';
                    document.getElementById('companyBadge').textContent = 'TALKO System';
                    document.getElementById('companyBadge').style.display = 'inline';
                    showMainInterface();
                    return;
                }
                
                currentCompany = companyId;
                
                const userDoc = await db.collection('companies').doc(companyId).collection('users').doc(user.uid).get();
                currentUserData = userDoc.exists ? { id: user.uid, ...userDoc.data() } : { id: user.uid, email: user.email, role: 'employee' };
                
                const companyDoc = await db.collection('companies').doc(companyId).get();
                const companyData = companyDoc.data();
                
                document.getElementById('currentUserName').textContent = currentUserData.name || user.displayName || user.email;
                document.getElementById('currentUserRole').textContent = `(${getRoleText(currentUserData.role)})`;
                document.getElementById('companyBadge').textContent = companyData?.name || '';
                document.getElementById('companyBadge').style.display = 'inline';
                
                if (currentUserData.role === 'employee') {
                    document.getElementById('inviteBtn').style.display = 'none';
                }
                
                showMainInterface();
                loadAllData();
            } else {
                document.getElementById('loadingPage').style.display = 'none';
                document.getElementById('authPage').style.display = 'flex';
                document.getElementById('mainInterface').style.display = 'none';
                document.getElementById('logoutBtn').style.display = 'none';
                document.getElementById('adminTabBtn').style.display = 'none';
                showLoginForm();
            }
        });

        function showMainInterface() {
            document.getElementById('loadingPage').style.display = 'none';
            document.getElementById('authPage').style.display = 'none';
            document.getElementById('mainInterface').style.display = 'block';
            document.getElementById('logoutBtn').style.display = 'block';
            document.getElementById('currentUserInfo').style.display = 'flex';
        }

        function getRoleText(role) {
            if (currentLang === 'ua') {
                return { owner: '–í–ª–∞—Å–Ω–∏–∫', manager: '–ú–µ–Ω–µ–¥–∂–µ—Ä', employee: '–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫', superadmin: '–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä' }[role] || role;
            } else {
                return { owner: '–í–ª–∞–¥–µ–ª–µ—Ü', manager: '–ú–µ–Ω–µ–¥–∂–µ—Ä', employee: '–°–æ—Ç—Ä—É–¥–Ω–∏–∫', superadmin: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' }[role] || role;
            }
        }

        // =====================
        // DATA LOADING
        // =====================
        async function loadAllData() {
            if (!currentCompany) return;
            
            const usersSnap = await db.collection('companies').doc(currentCompany).collection('users').get();
            users = usersSnap.docs.map(d => ({ id: d.id, ...d.data() }));
            
            const funcsSnap = await db.collection('companies').doc(currentCompany).collection('functions').get();
            functions = funcsSnap.docs.map(d => ({ id: d.id, ...d.data() }));
            
            const tasksSnap = await db.collection('companies').doc(currentCompany).collection('tasks').orderBy('createdAt', 'desc').get();
            tasks = tasksSnap.docs.map(d => ({ id: d.id, ...d.data() }));
            
            const regSnap = await db.collection('companies').doc(currentCompany).collection('regularTasks').get();
            regularTasks = regSnap.docs.map(d => ({ id: d.id, ...d.data() }));
            
            updateSelects();
            renderTasks();
        }

        // =====================
        // TASKS
        // =====================
        function openTaskModal(id = null) {
            document.getElementById('taskModal').style.display = 'block';
            updateSelects();
            
            if (id) {
                editingId = id;
                const task = tasks.find(x => x.id === id);
                if (task) {
                    document.getElementById('taskModalTitle').textContent = t('editTask');
                    document.getElementById('taskTitle').value = task.title || '';
                    document.getElementById('taskFunction').value = task.function || '';
                    document.getElementById('taskAssignee').value = task.assigneeId || '';
                    // –†–æ–∑–±–∏–≤–∞—î–º–æ deadline –Ω–∞ –¥–∞—Ç—É —ñ —á–∞—Å
                    if (task.deadlineDate) {
                        document.getElementById('taskDeadlineDate').value = task.deadlineDate;
                        document.getElementById('taskDeadlineTime').value = task.deadlineTime || '18:00';
                    } else if (task.deadline) {
                        // –°—É–º—ñ—Å–Ω—ñ—Å—Ç—å –∑—ñ —Å—Ç–∞—Ä–∏–º–∏ –∑–∞–≤–¥–∞–Ω–Ω—è–º–∏
                        const dt = task.deadline.split('T');
                        document.getElementById('taskDeadlineDate').value = dt[0] || '';
                        document.getElementById('taskDeadlineTime').value = dt[1]?.slice(0,5) || '18:00';
                    } else {
                        document.getElementById('taskDeadlineDate').value = '';
                        document.getElementById('taskDeadlineTime').value = '';
                    }
                    document.getElementById('taskEstimatedTime').value = task.estimatedTime || '';
                    document.getElementById('taskPriority').value = task.priority || 'medium';
                    document.getElementById('taskStatus').value = task.status || 'new';
                    document.getElementById('taskExpectedResult').value = task.expectedResult || '';
                    document.getElementById('taskReportFormat').value = task.reportFormat || '';
                    document.getElementById('taskDescription').value = task.description || '';
                }
            } else {
                editingId = null;
                document.getElementById('taskModalTitle').textContent = t('newTask');
                document.getElementById('taskForm').reset();
                // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –¥–µ—Ñ–æ–ª—Ç–Ω–∏–π —á–∞—Å
                document.getElementById('taskDeadlineTime').value = '18:00';
            }
        }

        async function saveTask(e) {
            e.preventDefault();
            
            const assigneeId = document.getElementById('taskAssignee').value;
            const assignee = users.find(u => u.id === assigneeId);
            const deadlineDate = document.getElementById('taskDeadlineDate').value;
            const deadlineTime = document.getElementById('taskDeadlineTime').value;
            
            const data = {
                title: document.getElementById('taskTitle').value.trim(),
                function: document.getElementById('taskFunction').value,
                assigneeId: assigneeId,
                assigneeName: assignee?.name || assignee?.email || '',
                deadlineDate: deadlineDate,
                deadlineTime: deadlineTime,
                deadline: deadlineDate + 'T' + deadlineTime, // –¥–ª—è —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ
                estimatedTime: document.getElementById('taskEstimatedTime').value,
                priority: document.getElementById('taskPriority').value,
                status: document.getElementById('taskStatus').value,
                expectedResult: document.getElementById('taskExpectedResult').value.trim(),
                reportFormat: document.getElementById('taskReportFormat').value.trim(),
                description: document.getElementById('taskDescription').value.trim(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                if (editingId) {
                    await db.collection('companies').doc(currentCompany).collection('tasks').doc(editingId).update(data);
                } else {
                    data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    data.createdDate = new Date().toISOString().split('T')[0];
                    data.creatorId = currentUser.uid;
                    data.creatorName = currentUserData?.name || currentUser.email;
                    data.pinned = false;
                    await db.collection('companies').doc(currentCompany).collection('tasks').add(data);
                }
                
                closeModal('taskModal');
                loadAllData();
            } catch (e) {
                alert(t('error') + ': ' + e.message);
            }
        }

        async function deleteTask(id) {
            if (!confirm(t('deleteConfirm'))) return;
            await db.collection('companies').doc(currentCompany).collection('tasks').doc(id).delete();
            loadAllData();
        }

        async function togglePin(id) {
            const task = tasks.find(x => x.id === id);
            if (task) {
                await db.collection('companies').doc(currentCompany).collection('tasks').doc(id).update({ pinned: !task.pinned });
                loadAllData();
            }
        }

        function handleDateFilter() {
            const df = document.getElementById('dateFilter').value;
            const customRange = document.getElementById('customDateRange');
            
            if (df === 'custom') {
                customRange.style.display = 'flex';
                // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
                const today = new Date().toISOString().split('T')[0];
                const weekLater = new Date();
                weekLater.setDate(weekLater.getDate() + 7);
                document.getElementById('dateFrom').value = today;
                document.getElementById('dateTo').value = weekLater.toISOString().split('T')[0];
            } else {
                customRange.style.display = 'none';
            }
            renderTasks();
        }
        
        function renderTasks() {
            const c = document.getElementById('tasksContainer');
            const sf = document.getElementById('statusFilter')?.value;
            const ff = document.getElementById('functionFilter')?.value;
            const af = document.getElementById('assigneeFilter')?.value;
            const df = document.getElementById('dateFilter')?.value;
            const tf = document.getElementById('taskTypeFilter')?.value;
            
            const today = new Date().toISOString().split('T')[0];
            
            let f = tasks.filter(task => {
                if (sf && task.status !== sf) return false;
                if (ff && task.function !== ff) return false;
                if (af && task.assigneeId !== af) return false;
                if (tf === 'my' && task.assigneeId !== currentUser.uid) return false;
                if (tf === 'created' && task.creatorId !== currentUser.uid) return false;
                
                const taskDate = task.deadlineDate || (task.deadline ? task.deadline.split('T')[0] : '');
                
                if (df === 'today' && taskDate !== today) return false;
                if (df === 'overdue') {
                    if (taskDate >= today || task.status === 'done') return false;
                }
                if (df === 'week') {
                    const weekLater = new Date();
                    weekLater.setDate(weekLater.getDate() + 7);
                    if (taskDate > weekLater.toISOString().split('T')[0] || taskDate < today) return false;
                }
                if (df === 'month') {
                    const monthLater = new Date();
                    monthLater.setMonth(monthLater.getMonth() + 1);
                    if (taskDate > monthLater.toISOString().split('T')[0] || taskDate < today) return false;
                }
                if (df === 'custom') {
                    const dateFrom = document.getElementById('dateFrom')?.value;
                    const dateTo = document.getElementById('dateTo')?.value;
                    if (dateFrom && taskDate < dateFrom) return false;
                    if (dateTo && taskDate > dateTo) return false;
                }
                return true;
            });
            
            f.sort((a, b) => {
                if (a.pinned && !b.pinned) return -1;
                if (!a.pinned && b.pinned) return 1;
                const dateA = a.deadlineDate || (a.deadline ? a.deadline.split('T')[0] : '9999');
                const dateB = b.deadlineDate || (b.deadline ? b.deadline.split('T')[0] : '9999');
                return dateA.localeCompare(dateB);
            });
            
            // –†–∞—Ö—É—î–º–æ –∑–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å
            let totalMinutes = 0;
            f.filter(task => task.status !== 'done').forEach(task => {
                if (task.estimatedTime) totalMinutes += parseInt(task.estimatedTime);
            });
            const totalHours = Math.floor(totalMinutes / 60);
            const totalMins = totalMinutes % 60;
            const totalTimeStr = totalMinutes > 0 ? `‚è±Ô∏è ${totalHours > 0 ? totalHours + ' –≥–æ–¥ ' : ''}${totalMins > 0 ? totalMins + ' —Ö–≤' : ''}` : '';
            
            document.getElementById('totalTimeInfo').innerHTML = totalTimeStr ? `<span class="total-time-badge">${totalTimeStr} (${f.filter(x=>x.status!=='done').length} ${t('tasks')})</span>` : '';
            
            if (f.length === 0) {
                c.innerHTML = `<div class="empty-table"><h3>${t('noTasksFound')}</h3><p>${t('changeFilters')}</p></div>`;
                return;
            }
            
            const st = { new: t('statusNew'), progress: t('statusProgress'), review: t('statusReview'), done: t('statusDone') };
            
            let html = `
                <table class="tasks-table">
                    <thead>
                        <tr>
                            <th>${t('task')}</th>
                            <th>${t('assignee')}</th>
                            <th>${t('createdBy')}</th>
                            <th>${t('deadline')}</th>
                            <th>${t('status')}</th>
                            <th>${t('type')}</th>
                            <th>${t('actions')}</th>
                        </tr>
                    </thead>
                    <tbody>`;
            
            f.forEach(task => {
                const taskDeadline = task.deadlineDate || (task.deadline ? task.deadline.split('T')[0] : '');
                const taskTime = task.deadlineTime || (task.deadline ? task.deadline.split('T')[1]?.slice(0,5) : '');
                const od = taskDeadline && taskDeadline < today && task.status !== 'done';
                const isToday = taskDeadline === today;
                const deadlineClass = od ? 'overdue' : (isToday ? 'today' : '');
                
                html += `
                    <tr>
                        <td class="task-title-cell">
                            <span class="task-title-text ${task.pinned ? 'pinned' : ''}">${task.title}</span>
                        </td>
                        <td>${task.assigneeName || '-'}</td>
                        <td>${task.creatorName || '-'}</td>
                        <td class="deadline-text ${deadlineClass}">${taskDeadline ? formatDateShort(taskDeadline) : '-'} ${taskTime || ''}</td>
                        <td><span class="status-badge status-${task.status}">${st[task.status] || task.status}</span></td>
                        <td>${task.function || '-'}</td>
                        <td>
                            <div class="action-btns">
                                <button class="action-btn" onclick="togglePin('${task.id}')" title="Pin">üìå</button>
                                <button class="action-btn" onclick="openTaskModal('${task.id}')" title="Edit">‚úèÔ∏è</button>
                                <button class="action-btn" onclick="deleteTask('${task.id}')" title="Delete">üóëÔ∏è</button>
                            </div>
                        </td>
                    </tr>`;
            });
            
            html += `</tbody></table>`;
            c.innerHTML = html;
        }
        
        function clearTaskFilters() {
            document.getElementById('taskTypeFilter').value = '';
            document.getElementById('dateFilter').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('functionFilter').value = '';
            document.getElementById('assigneeFilter').value = '';
            document.getElementById('customDateRange').style.display = 'none';
            document.getElementById('dateFrom').value = '';
            document.getElementById('dateTo').value = '';
            renderTasks();
        }
        
        function exportTasksCSV() {
            let csv = '–ù–∞–∑–≤–∞,–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å,–°—Ç–≤–æ—Ä–∏–≤,–î–µ–¥–ª–∞–π–Ω,–°—Ç–∞—Ç—É—Å,–§—É–Ω–∫—Ü—ñ—è\n';
            tasks.forEach(task => {
                const deadline = task.deadlineDate || (task.deadline ? task.deadline.split('T')[0] : '');
                csv += `"${task.title}","${task.assigneeName || ''}","${task.creatorName || ''}","${deadline}","${task.status}","${task.function || ''}"\n`;
            });
            
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'tasks_' + new Date().toISOString().split('T')[0] + '.csv';
            link.click();
        }
        
        function formatDateShort(dateStr) {
            if (!dateStr) return '-';
            const d = new Date(dateStr);
            return d.toLocaleDateString(currentLang === 'ua' ? 'uk-UA' : 'ru-RU', { day: '2-digit', month: '2-digit' });
        }

        // =====================
        // FUNCTIONS
        // =====================
        function openFunctionModal(id = null) {
            document.getElementById('functionModal').style.display = 'block';
            updateFunctionAssignees();
            
            if (id) {
                editingId = id;
                const f = functions.find(x => x.id === id);
                if (f) {
                    document.getElementById('functionModalTitle').textContent = t('editTask');
                    document.getElementById('functionName').value = f.name || '';
                    document.getElementById('functionHead').value = f.headId || '';
                    document.getElementById('functionDescription').value = f.description || '';
                    setTimeout(() => {
                        document.querySelectorAll('#functionAssignees input').forEach(cb => {
                            cb.checked = f.assigneeIds?.includes(cb.value);
                        });
                    }, 50);
                }
            } else {
                editingId = null;
                document.getElementById('functionModalTitle').textContent = t('newFunction');
                document.getElementById('functionForm').reset();
            }
        }

        function updateFunctionAssignees() {
            const c = document.getElementById('functionAssignees');
            const h = document.getElementById('functionHead');
            c.innerHTML = users.map(u => `<label class="assignee-checkbox"><input type="checkbox" value="${u.id}">${u.name || u.email}</label>`).join('');
            h.innerHTML = `<option value="">${t('select')}</option>` + users.map(u => `<option value="${u.id}">${u.name || u.email}</option>`).join('');
        }

        async function saveFunction(e) {
            e.preventDefault();
            
            const headId = document.getElementById('functionHead').value;
            const head = users.find(u => u.id === headId);
            const assigneeIds = Array.from(document.querySelectorAll('#functionAssignees input:checked')).map(cb => cb.value);
            if (!assigneeIds.includes(headId)) assigneeIds.push(headId);
            
            const data = {
                name: document.getElementById('functionName').value.trim(),
                headId: headId,
                headName: head?.name || head?.email || '',
                description: document.getElementById('functionDescription').value.trim(),
                assigneeIds: assigneeIds,
                assigneeNames: assigneeIds.map(id => users.find(u => u.id === id)?.name || users.find(u => u.id === id)?.email || '').filter(Boolean)
            };
            
            try {
                if (editingId) {
                    await db.collection('companies').doc(currentCompany).collection('functions').doc(editingId).update(data);
                } else {
                    data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    await db.collection('companies').doc(currentCompany).collection('functions').add(data);
                }
                closeModal('functionModal');
                loadAllData();
            } catch (e) {
                alert(t('error') + ': ' + e.message);
            }
        }

        async function deleteFunction(id) {
            if (!confirm(t('deleteConfirm'))) return;
            await db.collection('companies').doc(currentCompany).collection('functions').doc(id).delete();
            loadAllData();
        }

        function renderFunctions() {
            const c = document.getElementById('functionsContainer');
            if (functions.length === 0) {
                c.innerHTML = `<div class="empty-state" style="grid-column:1/-1;"><h3>${t('noFunctions')}</h3><p>${t('createFirstFunction')}</p></div>`;
                return;
            }
            c.innerHTML = functions.map(f => `
                <div class="function-card">
                    <div class="function-header">
                        <div class="function-title">‚öôÔ∏è ${f.name}</div>
                    </div>
                    ${f.description ? `<div class="function-description">${f.description}</div>` : ''}
                    <div class="function-assignees">
                        ${f.headName ? `<span class="assignee-badge head">üëë ${f.headName}</span>` : ''}
                        ${f.assigneeNames?.filter(n => n !== f.headName).map(n => `<span class="assignee-badge">${n}</span>`).join('') || ''}
                    </div>
                    <div class="function-stats">
                        <span>üìã ${tasks.filter(task => task.function === f.name).length} ${t('tasks')}</span>
                        <div>
                            <button class="btn btn-small" onclick="openFunctionModal('${f.id}')">‚úèÔ∏è</button>
                            <button class="btn btn-small btn-danger" onclick="deleteFunction('${f.id}')">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // =====================
        // REGULAR TASKS
        // =====================
        function updatePeriodOptions() {
            const period = document.getElementById('regularTaskPeriod').value;
            const dayOfWeekGroup = document.getElementById('dayOfWeekGroup');
            const dayOfMonthGroup = document.getElementById('dayOfMonthGroup');
            
            if (period === 'weekly') {
                dayOfWeekGroup.style.display = 'block';
                dayOfMonthGroup.style.display = 'none';
            } else {
                dayOfWeekGroup.style.display = 'none';
                dayOfMonthGroup.style.display = 'block';
            }
        }
        
        function openRegularTaskModal(id = null) {
            document.getElementById('regularTaskModal').style.display = 'block';
            updateRegularTaskFunctions();
            updatePeriodOptions();
            editingId = id;
            
            if (id) {
                const rt = regularTasks.find(r => r.id === id);
                if (rt) {
                    document.getElementById('regularTaskTitle').value = rt.title;
                    document.getElementById('regularTaskFunction').value = rt.function;
                    document.getElementById('regularTaskPeriod').value = rt.period || 'weekly';
                    updatePeriodOptions();
                    document.getElementById('regularTaskDayOfWeek').value = rt.dayOfWeek || '1';
                    document.getElementById('regularTaskDayOfMonth').value = rt.dayOfMonth || '1';
                    document.getElementById('regularTaskTime').value = rt.time || '10:00';
                    document.getElementById('regularTaskExpectedResult').value = rt.expectedResult || '';
                    document.getElementById('regularTaskReportFormat').value = rt.reportFormat || '';
                    document.getElementById('regularTaskInstruction').value = rt.instruction || '';
                    updateRegularTaskAssignees();
                    setTimeout(() => {
                        document.querySelectorAll('#regularTaskAssignees input').forEach(cb => {
                            cb.checked = rt.assigneeIds?.includes(cb.value);
                        });
                    }, 50);
                }
            } else {
                document.getElementById('regularTaskForm').reset();
                document.getElementById('regularTaskTime').value = '10:00';
                document.getElementById('regularTaskPeriod').value = 'weekly';
                updatePeriodOptions();
                document.getElementById('regularTaskAssignees').innerHTML = `<p style="color:#7f8c8d;">${t('selectFunctionFirst')}</p>`;
            }
        }

        function updateRegularTaskFunctions() {
            const s = document.getElementById('regularTaskFunction');
            s.innerHTML = `<option value="">${t('select')}</option>` + functions.map(f => `<option value="${f.name}">${f.name}</option>`).join('');
            
            // –û–Ω–æ–≤–ª—é—î–º–æ —Ñ—ñ–ª—å—Ç—Ä–∏
            const ff = document.getElementById('regularFunctionFilter');
            const af = document.getElementById('regularAssigneeFilter');
            if (ff) ff.innerHTML = `<option value="">${t('allFunctions')}</option>` + functions.map(f => `<option value="${f.name}">${f.name}</option>`).join('');
            if (af) af.innerHTML = `<option value="">${t('all')}</option>` + users.map(u => `<option value="${u.id}">${u.name || u.email}</option>`).join('');
        }

        function updateRegularTaskAssignees() {
            const fn = document.getElementById('regularTaskFunction').value;
            const c = document.getElementById('regularTaskAssignees');
            const f = functions.find(x => x.name === fn);
            
            if (!f || !f.assigneeIds?.length) {
                c.innerHTML = `<p style="color:#7f8c8d;">${t('noMembers')}</p>`;
                return;
            }
            
            c.innerHTML = f.assigneeIds.map(id => {
                const u = users.find(x => x.id === id);
                return `<label class="assignee-checkbox"><input type="checkbox" value="${id}">${id === f.headId ? 'üëë ' : ''}${u?.name || u?.email || id}</label>`;
            }).join('');
        }

        async function saveRegularTask(e) {
            e.preventDefault();
            
            const assigneeIds = Array.from(document.querySelectorAll('#regularTaskAssignees input:checked')).map(cb => cb.value);
            if (!assigneeIds.length) { alert(currentLang === 'ua' ? '–û–±–µ—Ä—ñ—Ç—å –≤–∏–∫–æ–Ω–∞–≤—Ü—ñ–≤' : '–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π'); return; }
            
            const period = document.getElementById('regularTaskPeriod').value;
            
            const data = {
                title: document.getElementById('regularTaskTitle').value.trim(),
                function: document.getElementById('regularTaskFunction').value,
                period: period,
                dayOfWeek: period === 'weekly' ? document.getElementById('regularTaskDayOfWeek').value : null,
                dayOfMonth: period !== 'weekly' ? document.getElementById('regularTaskDayOfMonth').value : null,
                time: document.getElementById('regularTaskTime').value,
                expectedResult: document.getElementById('regularTaskExpectedResult').value.trim(),
                reportFormat: document.getElementById('regularTaskReportFormat').value.trim(),
                instruction: document.getElementById('regularTaskInstruction').value.trim(),
                assigneeIds: assigneeIds,
                assigneeNames: assigneeIds.map(id => users.find(u => u.id === id)?.name || users.find(u => u.id === id)?.email || '').filter(Boolean)
            };
            
            try {
                if (editingId) {
                    await db.collection('companies').doc(currentCompany).collection('regularTasks').doc(editingId).update(data);
                } else {
                    data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    await db.collection('companies').doc(currentCompany).collection('regularTasks').add(data);
                }
                closeModal('regularTaskModal');
                loadAllData();
            } catch (e) {
                alert(t('error') + ': ' + e.message);
            }
        }

        async function generateFromRegular(id) {
            const rt = regularTasks.find(r => r.id === id);
            if (!rt) return;
            
            const deadline = new Date();
            deadline.setDate(deadline.getDate() + 1);
            const deadlineDate = deadline.toISOString().split('T')[0];
            
            const batch = db.batch();
            rt.assigneeIds.forEach(assigneeId => {
                const ref = db.collection('companies').doc(currentCompany).collection('tasks').doc();
                batch.set(ref, {
                    title: rt.title,
                    function: rt.function,
                    assigneeId: assigneeId,
                    assigneeName: users.find(u => u.id === assigneeId)?.name || '',
                    deadlineDate: deadlineDate,
                    deadlineTime: rt.time || '18:00',
                    deadline: deadlineDate + 'T' + (rt.time || '18:00'),
                    expectedResult: rt.expectedResult || '',
                    reportFormat: rt.reportFormat || '',
                    description: rt.instruction || '',
                    status: 'new',
                    priority: 'medium',
                    pinned: false,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    createdDate: new Date().toISOString().split('T')[0],
                    creatorName: currentLang === 'ua' ? '–°–∏—Å—Ç–µ–º–∞' : '–°–∏—Å—Ç–µ–º–∞'
                });
            });
            
            await batch.commit();
            alert(`‚úÖ ${currentLang === 'ua' ? '–°—Ç–≤–æ—Ä–µ–Ω–æ' : '–°–æ–∑–¥–∞–Ω–æ'} ${rt.assigneeIds.length} ${currentLang === 'ua' ? '–∑–∞–≤–¥–∞–Ω—å' : '–∑–∞–¥–∞—á'}`);
            loadAllData();
        }

        async function deleteRegularTask(id) {
            if (!confirm(t('deleteConfirm'))) return;
            await db.collection('companies').doc(currentCompany).collection('regularTasks').doc(id).delete();
            loadAllData();
        }

        function renderRegularTasks() {
            const c = document.getElementById('regularTasksContainer');
            const ff = document.getElementById('regularFunctionFilter')?.value;
            const af = document.getElementById('regularAssigneeFilter')?.value;
            
            // –û–Ω–æ–≤–ª—é—î–º–æ —Å–µ–ª–µ–∫—Ç–∏
            const assigneeSelect = document.getElementById('regularAssigneeFilter');
            const functionSelect = document.getElementById('regularFunctionFilter');
            if (assigneeSelect && assigneeSelect.options.length <= 1) {
                assigneeSelect.innerHTML = `<option value="">${t('allAssignees')}</option>` + users.map(u => `<option value="${u.id}">${u.name || u.email}</option>`).join('');
            }
            if (functionSelect && functionSelect.options.length <= 1) {
                functionSelect.innerHTML = `<option value="">${t('allFunctions')}</option>` + functions.map(f => `<option value="${f.name}">${f.name}</option>`).join('');
            }
            
            let filtered = regularTasks.filter(rt => {
                if (ff && rt.function !== ff) return false;
                if (af && !rt.assigneeIds?.includes(af)) return false;
                return true;
            });
            
            const pt = { weekly: t('weekly'), monthly: t('monthly'), quarterly: t('quarterly') };
            const days = {
                '0': currentLang === 'ua' ? '–ù–¥' : '–í—Å',
                '1': currentLang === 'ua' ? '–ü–Ω' : '–ü–Ω',
                '2': currentLang === 'ua' ? '–í—Ç' : '–í—Ç',
                '3': currentLang === 'ua' ? '–°—Ä' : '–°—Ä',
                '4': currentLang === 'ua' ? '–ß—Ç' : '–ß—Ç',
                '5': currentLang === 'ua' ? '–ü—Ç' : '–ü—Ç',
                '6': currentLang === 'ua' ? '–°–±' : '–°–±'
            };
            
            if (filtered.length === 0) {
                c.innerHTML = `<div class="empty-state" style="grid-column:1/-1;"><h3>${t('noRegular')}</h3><p>${t('createRegular')}</p></div>`;
                return;
            }
            
            c.innerHTML = filtered.map(rt => {
                const scheduleText = rt.period === 'weekly' 
                    ? `${days[rt.dayOfWeek] || '–ü–Ω'} –æ ${rt.time || '10:00'}`
                    : `${rt.dayOfMonth || '1'}-–≥–æ –æ ${rt.time || '10:00'}`;
                
                return `
                <div class="function-card">
                    <div class="function-header">
                        <div class="function-title">${rt.title}</div>
                        <span class="badge" style="background:#f3e5f5;color:#7b1fa2;">${pt[rt.period] || rt.period}</span>
                    </div>
                    <div class="regular-schedule">üóìÔ∏è ${scheduleText}</div>
                    <div style="font-size:0.85rem;color:#7f8c8d;margin-bottom:0.5rem;">${t('function')}: ${rt.function}</div>
                    ${rt.expectedResult ? `<div class="task-detail"><strong>üéØ</strong> ${rt.expectedResult}</div>` : ''}
                    ${rt.reportFormat ? `<div class="task-detail"><strong>üìã</strong> ${rt.reportFormat}</div>` : ''}
                    ${rt.instruction ? `<div class="task-detail instruction-preview" onclick="showInstruction('${rt.id}')"><strong>üìñ</strong> ${rt.instruction.substring(0, 50)}${rt.instruction.length > 50 ? '...' : ''} <span style="color:var(--info);">(${currentLang === 'ua' ? '—á–∏—Ç–∞—Ç–∏' : '—á–∏—Ç–∞—Ç—å'})</span></div>` : ''}
                    <div class="function-assignees">
                        ${rt.assigneeNames?.map(n => `<span class="assignee-badge">${n}</span>`).join('') || ''}
                    </div>
                    <div class="function-stats">
                        <button class="btn btn-small btn-success" onclick="generateFromRegular('${rt.id}')">${t('create')}</button>
                        <div>
                            <button class="btn btn-small" onclick="openRegularTaskModal('${rt.id}')">‚úèÔ∏è</button>
                            <button class="btn btn-small btn-danger" onclick="deleteRegularTask('${rt.id}')">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>
            `}).join('');
        }
        
        function showInstruction(id) {
            const rt = regularTasks.find(r => r.id === id);
            if (rt && rt.instruction) {
                alert(`üìñ ${currentLang === 'ua' ? '–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è' : '–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è'}:\n\n${rt.instruction}`);
            }
        }

        // =====================
        // USERS & INVITES
        // =====================
        function openInviteModal() {
            document.getElementById('inviteModal').style.display = 'block';
            document.getElementById('inviteForm').reset();
            document.getElementById('inviteLink').style.display = 'none';
        }

        async function sendInvite(e) {
            e.preventDefault();
            const email = document.getElementById('inviteEmail').value.trim().toLowerCase();
            const role = document.getElementById('inviteRole').value;
            
            try {
                await db.collection('invites').add({
                    email: email,
                    companyId: currentCompany,
                    role: role,
                    invitedBy: currentUser.uid,
                    accepted: false,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                const link = window.location.origin + window.location.pathname;
                document.getElementById('inviteLinkText').value = link;
                document.getElementById('inviteLink').style.display = 'block';
                
                alert(currentLang === 'ua' 
                    ? `‚úÖ –ó–∞–ø—Ä–æ—à–µ–Ω–Ω—è —Å—Ç–≤–æ—Ä–µ–Ω–æ!\n\n–ù–∞–¥—ñ—à–ª—ñ—Ç—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫—É.\n–í—ñ–Ω –º–∞—î —É–≤—ñ–π—Ç–∏ –∑ email: ${email}`
                    : `‚úÖ –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ!\n\n–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É.\n–û–Ω –¥–æ–ª–∂–µ–Ω –≤–æ–π—Ç–∏ —Å email: ${email}`);
            } catch (e) {
                alert(t('error') + ': ' + e.message);
            }
        }

        function copyInviteLink() {
            const input = document.getElementById('inviteLinkText');
            input.select();
            document.execCommand('copy');
            alert(t('copied'));
        }

        async function deleteUser(id) {
            const u = users.find(x => x.id === id);
            if (u?.role === 'owner') { alert(currentLang === 'ua' ? '–ù–µ –º–æ–∂–Ω–∞ –≤–∏–¥–∞–ª–∏—Ç–∏ –≤–ª–∞—Å–Ω–∏–∫–∞' : '–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞'); return; }
            if (!confirm(t('deleteConfirm'))) return;
            await db.collection('companies').doc(currentCompany).collection('users').doc(id).delete();
            loadAllData();
        }

        function renderUsers() {
            const c = document.getElementById('usersContainer');
            if (users.length === 0) {
                c.innerHTML = `<div class="empty-state" style="grid-column:1/-1;"><h3>${t('noUsers')}</h3></div>`;
                return;
            }
            
            const canEdit = currentUserData?.role === 'owner' || currentUserData?.role === 'manager';
            
            c.innerHTML = users.map(u => {
                const userFunctions = functions.filter(f => f.assigneeIds?.includes(u.id));
                const isOwner = u.role === 'owner';
                
                return `
                <div class="user-card">
                    <div class="user-header">
                        <div class="user-name">${u.name || u.email}</div>
                        <span class="role-badge ${u.role}">${getRoleText(u.role)}</span>
                    </div>
                    <div class="user-details">
                        <div>üìß ${u.email}</div>
                        ${u.position ? `<div>üíº ${u.position}</div>` : ''}
                    </div>
                    ${userFunctions.length > 0 ? `
                        <div style="margin:0.5rem 0;display:flex;flex-wrap:wrap;gap:0.25rem;">
                            ${userFunctions.map(f => `<span class="badge" style="font-size:0.7rem;background:#e8f5e9;color:#2e7d32;">${f.name}</span>`).join('')}
                        </div>
                    ` : ''}
                    <div class="user-stats">
                        <span>üìã ${tasks.filter(task => task.assigneeId === u.id).length} ${t('tasks')}</span>
                        <div style="display:flex;gap:0.25rem;">
                            ${canEdit && !isOwner ? `<button class="btn btn-small" onclick="openUserModal('${u.id}')" title="${t('edit')}">‚úèÔ∏è</button>` : ''}
                            ${canEdit && !isOwner ? `<button class="btn btn-small btn-danger" onclick="deleteUser('${u.id}')" title="${t('delete')}">üóëÔ∏è</button>` : ''}
                        </div>
                    </div>
                </div>
            `}).join('');
        }
        
        let editingUserId = null;
        
        function openUserModal(userId = null) {
            editingUserId = userId;
            const modal = document.getElementById('userModal');
            
            // –ó–∞–ø–æ–≤–Ω—é—î–º–æ —Å–ø–∏—Å–æ–∫ —Ñ—É–Ω–∫—Ü—ñ–π
            const userFunctionsDiv = document.getElementById('userFunctions');
            userFunctionsDiv.innerHTML = functions.map(f => `
                <label class="assignee-checkbox">
                    <input type="checkbox" value="${f.id}" data-fname="${f.name}">
                    ${f.name}
                </label>
            `).join('') || `<p style="color:#7f8c8d;">${t('noFunctions')}</p>`;
            
            if (userId) {
                const user = users.find(u => u.id === userId);
                if (user) {
                    document.getElementById('userName').value = user.name || '';
                    document.getElementById('userEmail').value = user.email || '';
                    document.getElementById('userRole').value = user.role || 'employee';
                    document.getElementById('userPosition').value = user.position || '';
                    document.getElementById('userModalTitle').textContent = t('editEmployee');
                    
                    // –í—ñ–¥–º—ñ—á–∞—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                    const userFunctions = functions.filter(f => f.assigneeIds?.includes(userId));
                    userFunctions.forEach(f => {
                        const checkbox = userFunctionsDiv.querySelector(`input[value="${f.id}"]`);
                        if (checkbox) checkbox.checked = true;
                    });
                }
            } else {
                document.getElementById('userForm').reset();
                document.getElementById('userModalTitle').textContent = t('addEmployee');
            }
            
            modal.style.display = 'block';
        }
        
        async function saveUser(e) {
            e.preventDefault();
            
            if (!editingUserId) return;
            
            const name = document.getElementById('userName').value.trim();
            const role = document.getElementById('userRole').value;
            const position = document.getElementById('userPosition').value.trim();
            
            try {
                // –û–Ω–æ–≤–ª—é—î–º–æ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                await db.collection('companies').doc(currentCompany).collection('users').doc(editingUserId).update({
                    name: name,
                    role: role,
                    position: position
                });
                
                // –û–Ω–æ–≤–ª—é—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—ó
                const selectedFunctions = Array.from(document.querySelectorAll('#userFunctions input:checked')).map(cb => cb.value);
                
                // –î–ª—è –∫–æ–∂–Ω–æ—ó —Ñ—É–Ω–∫—Ü—ñ—ó –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏/–≤–∏–¥–∞–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                for (const func of functions) {
                    const funcRef = db.collection('companies').doc(currentCompany).collection('functions').doc(func.id);
                    const isSelected = selectedFunctions.includes(func.id);
                    const isCurrentlyAssigned = func.assigneeIds?.includes(editingUserId);
                    
                    if (isSelected && !isCurrentlyAssigned) {
                        await funcRef.update({
                            assigneeIds: firebase.firestore.FieldValue.arrayUnion(editingUserId)
                        });
                    } else if (!isSelected && isCurrentlyAssigned) {
                        await funcRef.update({
                            assigneeIds: firebase.firestore.FieldValue.arrayRemove(editingUserId)
                        });
                    }
                }
                
                closeModal('userModal');
                loadAllData();
            } catch (e) {
                alert(t('error') + ': ' + e.message);
            }
        }

        // =====================
        // CONTROL DASHBOARD
        // =====================
        function renderControl() {
            const af = document.getElementById('controlAssigneeFilter')?.value;
            const ff = document.getElementById('controlFunctionFilter')?.value;
            const pf = document.getElementById('controlPeriodFilter')?.value;
            
            // –û–Ω–æ–≤–ª—é—î–º–æ —Å–µ–ª–µ–∫—Ç–∏
            const assigneeSelect = document.getElementById('controlAssigneeFilter');
            const functionSelect = document.getElementById('controlFunctionFilter');
            if (assigneeSelect && assigneeSelect.options.length <= 1) {
                assigneeSelect.innerHTML = `<option value="">${t('allAssignees')}</option>` + users.map(u => `<option value="${u.id}">${u.name || u.email}</option>`).join('');
            }
            if (functionSelect && functionSelect.options.length <= 1) {
                functionSelect.innerHTML = `<option value="">${t('allFunctions')}</option>` + functions.map(f => `<option value="${f.name}">${f.name}</option>`).join('');
            }
            
            const now = new Date();
            const today = now.toISOString().split('T')[0];
            const tm = new Date(now); tm.setDate(tm.getDate() + 1);
            const tomorrow = tm.toISOString().split('T')[0];
            
            // –§—ñ–ª—å—Ç—Ä—É—î–º–æ –∑–∞–≤–¥–∞–Ω–Ω—è
            let filteredTasks = tasks.filter(task => {
                if (af && task.assigneeId !== af) return false;
                if (ff && task.function !== ff) return false;
                if (pf === 'today') {
                    const taskDate = task.deadlineDate || (task.deadline ? task.deadline.split('T')[0] : '');
                    if (taskDate !== today) return false;
                }
                if (pf === 'week') {
                    const taskDate = task.deadlineDate || (task.deadline ? task.deadline.split('T')[0] : '');
                    const weekLater = new Date();
                    weekLater.setDate(weekLater.getDate() + 7);
                    if (taskDate > weekLater.toISOString().split('T')[0] || taskDate < today) return false;
                }
                if (pf === 'month') {
                    const taskDate = task.deadlineDate || (task.deadline ? task.deadline.split('T')[0] : '');
                    const monthLater = new Date();
                    monthLater.setMonth(monthLater.getMonth() + 1);
                    if (taskDate > monthLater.toISOString().split('T')[0] || taskDate < today) return false;
                }
                return true;
            });
            
            const urgent = filteredTasks.filter(task => {
                const taskDate = task.deadlineDate || (task.deadline ? task.deadline.split('T')[0] : '');
                return taskDate && taskDate < today && task.status !== 'done';
            }).length;
            
            const warning = filteredTasks.filter(task => {
                const taskDate = task.deadlineDate || (task.deadline ? task.deadline.split('T')[0] : '');
                return (taskDate === today || taskDate === tomorrow) && task.status !== 'done';
            }).length;
            
            const active = filteredTasks.filter(task => task.status === 'progress').length;
            const completed = filteredTasks.filter(task => task.status === 'done').length;
            
            document.getElementById('urgentCount').textContent = urgent;
            document.getElementById('warningCount').textContent = warning;
            document.getElementById('activeCount').textContent = active;
            document.getElementById('completedCount').textContent = completed;
            
            renderControlContent();
        }
        
        function renderControlContent() {
            const viewType = document.getElementById('controlViewType')?.value || 'workload';
            const af = document.getElementById('controlAssigneeFilter')?.value;
            const ff = document.getElementById('controlFunctionFilter')?.value;
            
            let filteredTasks = tasks.filter(task => {
                if (af && task.assigneeId !== af) return false;
                if (ff && task.function !== ff) return false;
                return task.status !== 'done';
            });
            
            const content = document.getElementById('controlContent');
            
            if (viewType === 'workload') {
                const wl = {};
                filteredTasks.forEach(task => { 
                    wl[task.assigneeName || t('notAssigned')] = (wl[task.assigneeName || t('notAssigned')] || 0) + 1; 
                });
                
                content.innerHTML = `
                    <h3 style="margin-bottom:1rem;">${t('employeeWorkload')}</h3>
                    ${Object.entries(wl).sort((a,b) => b[1] - a[1]).map(([n, c]) => `
                        <div style="display:flex;justify-content:space-between;padding:0.6rem;background:#f8f9fa;border-radius:8px;margin-bottom:0.4rem;">
                            <span>üë§ ${n}</span>
                            <span style="font-weight:600;color:${c > 5 ? '#e74c3c' : '#27ae60'};">${c} ${t('tasks')}</span>
                        </div>
                    `).join('') || `<p style="color:#7f8c8d;">${t('noActiveTasks')}</p>`}
                `;
            } else {
                const byFunc = {};
                filteredTasks.forEach(task => { 
                    const fn = task.function || t('noFunction');
                    byFunc[fn] = (byFunc[fn] || 0) + 1; 
                });
                
                content.innerHTML = `
                    <h3 style="margin-bottom:1rem;">${t('byFunctions')}</h3>
                    ${Object.entries(byFunc).sort((a,b) => b[1] - a[1]).map(([n, c]) => `
                        <div style="display:flex;justify-content:space-between;padding:0.6rem;background:#f8f9fa;border-radius:8px;margin-bottom:0.4rem;">
                            <span>‚öôÔ∏è ${n}</span>
                            <span style="font-weight:600;color:#3498db;">${c} ${t('tasks')}</span>
                        </div>
                    `).join('') || `<p style="color:#7f8c8d;">${t('noActiveTasks')}</p>`}
                `;
            }
        }
        
        function clearControlFilters() {
            document.getElementById('controlAssigneeFilter').value = '';
            document.getElementById('controlFunctionFilter').value = '';
            document.getElementById('controlPeriodFilter').value = '';
            renderControl();
        }
        
        function clearRegularFilters() {
            document.getElementById('regularAssigneeFilter').value = '';
            document.getElementById('regularFunctionFilter').value = '';
            renderRegularTasks();
        }

        // =====================
        // ADMIN FUNCTIONS
        // =====================
        async function renderAdminPanel() {
            if (!isSuperAdmin) return;
            
            const container = document.getElementById('adminCompaniesContainer');
            container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            try {
                const companiesSnap = await db.collection('companies').get();
                const companies = [];
                
                for (const doc of companiesSnap.docs) {
                    const data = doc.data();
                    const usersSnap = await db.collection('companies').doc(doc.id).collection('users').get();
                    companies.push({
                        id: doc.id,
                        ...data,
                        usersCount: usersSnap.size
                    });
                }
                
                if (companies.length === 0) {
                    container.innerHTML = `<p style="color:#7f8c8d;text-align:center;padding:2rem;">${t('noCompanies')}</p>`;
                    return;
                }
                
                container.innerHTML = companies.map(c => `
                    <div style="display:flex;justify-content:space-between;align-items:center;padding:0.75rem;background:#f8f9fa;border-radius:8px;margin-bottom:0.5rem;border-left:4px solid var(--info);">
                        <div>
                            <strong>${c.name || (currentLang === 'ua' ? '–ë–µ–∑ –Ω–∞–∑–≤–∏' : '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</strong>
                            <div style="font-size:0.8rem;color:#7f8c8d;">
                                üìß ${c.ownerEmail || '-'} | üë• ${c.usersCount} ${t('users')}
                            </div>
                            <div style="font-size:0.75rem;color:#bdc3c7;">ID: ${c.id}</div>
                        </div>
                        <div style="display:flex;gap:0.25rem;">
                            <button class="btn btn-small" onclick="adminViewCompany('${c.id}')">üëÅÔ∏è</button>
                            <button class="btn btn-small btn-danger" onclick="adminDeleteCompany('${c.id}', '${c.name}')">üóëÔ∏è</button>
                        </div>
                    </div>
                `).join('');
            } catch (e) {
                container.innerHTML = `<p style="color:#e74c3c;">${t('error')}: ${e.message}</p>`;
            }
        }

        async function adminCreateCompany(e) {
            e.preventDefault();
            if (!isSuperAdmin) return;
            
            const email = document.getElementById('adminOwnerEmail').value.trim().toLowerCase();
            const password = document.getElementById('adminOwnerPassword').value;
            const name = document.getElementById('adminOwnerName').value.trim();
            const companyName = document.getElementById('adminCompanyName').value.trim();
            
            const btn = document.getElementById('adminCreateBtn');
            btn.disabled = true;
            btn.textContent = currentLang === 'ua' ? '–°—Ç–≤–æ—Ä—é—î–º–æ...' : '–°–æ–∑–¥–∞–µ–º...';
            
            try {
                const companyRef = db.collection('companies').doc();
                const companyId = companyRef.id;
                
                await companyRef.set({
                    name: companyName,
                    ownerEmail: email,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    createdBy: currentUser.uid
                });
                
                await db.collection('invites').add({
                    email: email,
                    companyId: companyId,
                    role: 'owner',
                    ownerName: name,
                    tempPassword: password,
                    invitedBy: currentUser.uid,
                    accepted: false,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                alert(currentLang === 'ua'
                    ? `‚úÖ –ö–æ–º–ø–∞–Ω—ñ—è "${companyName}" —Å—Ç–≤–æ—Ä–µ–Ω–∞!\n\nüìß Email: ${email}\nüîë –ü–∞—Ä–æ–ª—å: ${password}\n\n–ù–∞–¥—ñ—à–ª—ñ—Ç—å —Ü—ñ –¥–∞–Ω—ñ –∫–ª—ñ—î–Ω—Ç—É.`
                    : `‚úÖ –ö–æ–º–ø–∞–Ω–∏—è "${companyName}" —Å–æ–∑–¥–∞–Ω–∞!\n\nüìß Email: ${email}\nüîë –ü–∞—Ä–æ–ª—å: ${password}\n\n–û—Ç–ø—Ä–∞–≤—å—Ç–µ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—É.`);
                
                document.getElementById('adminCreateForm').reset();
                renderAdminPanel();
            } catch (e) {
                alert(t('error') + ': ' + e.message);
            }
            
            btn.disabled = false;
            btn.textContent = t('createCompanyBtn');
        }

        async function adminViewCompany(companyId) {
            currentCompany = companyId;
            await loadAllData();
            switchTab('users');
            alert(currentLang === 'ua' ? '–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞ –∫–æ–º–ø–∞–Ω—ñ—é. –î–∏–≤—ñ—Ç—å—Å—è –≤–∫–ª–∞–¥–∫—É "–ö–æ–º–∞–Ω–¥–∞".' : '–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞ –∫–æ–º–ø–∞–Ω–∏—é. –°–º–æ—Ç—Ä–∏—Ç–µ –≤–∫–ª–∞–¥–∫—É "–ö–æ–º–∞–Ω–¥–∞".');
        }

        async function adminDeleteCompany(companyId, companyName) {
            const confirmMsg = currentLang === 'ua'
                ? `‚ö†Ô∏è –í–∏–¥–∞–ª–∏—Ç–∏ –∫–æ–º–ø–∞–Ω—ñ—é "${companyName}"?\n\n–¶–µ –≤–∏–¥–∞–ª–∏—Ç—å –í–°–Ü –¥–∞–Ω—ñ:\n- –ó–∞–≤–¥–∞–Ω–Ω—è\n- –§—É–Ω–∫—Ü—ñ—ó\n- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤\n\n–¶—é –¥—ñ—é –ù–ï –ú–û–ñ–ù–ê —Å–∫–∞—Å—É–≤–∞—Ç–∏!`
                : `‚ö†Ô∏è –£–¥–∞–ª–∏—Ç—å –∫–æ–º–ø–∞–Ω–∏—é "${companyName}"?\n\n–≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ:\n- –ó–∞–¥–∞—á–∏\n- –§—É–Ω–∫—Ü–∏–∏\n- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –ù–ï–õ–¨–ó–Ø –æ—Ç–º–µ–Ω–∏—Ç—å!`;
            
            if (!confirm(confirmMsg)) return;
            if (!confirm(currentLang === 'ua' ? '–í–∏ –¢–û–ß–ù–û –≤–ø–µ–≤–Ω–µ–Ω—ñ?' : '–í—ã –¢–û–ß–ù–û —É–≤–µ—Ä–µ–Ω—ã?')) return;
            
            try {
                const subcollections = ['users', 'tasks', 'functions', 'regularTasks'];
                for (const sub of subcollections) {
                    const snap = await db.collection('companies').doc(companyId).collection(sub).get();
                    const batch = db.batch();
                    snap.docs.forEach(doc => batch.delete(doc.ref));
                    await batch.commit();
                }
                
                await db.collection('companies').doc(companyId).delete();
                
                const invitesSnap = await db.collection('invites').where('companyId', '==', companyId).get();
                const invitesBatch = db.batch();
                invitesSnap.docs.forEach(doc => invitesBatch.delete(doc.ref));
                await invitesBatch.commit();
                
                alert(currentLang === 'ua' ? '‚úÖ –ö–æ–º–ø–∞–Ω—ñ—é –≤–∏–¥–∞–ª–µ–Ω–æ' : '‚úÖ –ö–æ–º–ø–∞–Ω–∏—è —É–¥–∞–ª–µ–Ω–∞');
                renderAdminPanel();
            } catch (e) {
                alert(t('error') + ': ' + e.message);
            }
        }

        // =====================
        // HELPERS
        // =====================
        function updateSelects() {
            const tf = document.getElementById('taskFunction');
            const ta = document.getElementById('taskAssignee');
            const ff = document.getElementById('functionFilter');
            const af = document.getElementById('assigneeFilter');
            const raf = document.getElementById('regularAssigneeFilter');
            const rff = document.getElementById('regularFunctionFilter');
            
            if (tf) tf.innerHTML = `<option value="">${t('noFunction')}</option>` + functions.map(f => `<option value="${f.name}">${f.name}</option>`).join('');
            if (ta) ta.innerHTML = `<option value="">${t('select')}</option>` + users.map(u => `<option value="${u.id}">${u.name || u.email}</option>`).join('');
            if (ff) ff.innerHTML = `<option value="">${t('allFunctions')}</option>` + functions.map(f => `<option value="${f.name}">${f.name}</option>`).join('');
            if (af) af.innerHTML = `<option value="">${t('allAssignees')}</option>` + users.map(u => `<option value="${u.id}">${u.name || u.email}</option>`).join('');
            if (raf) raf.innerHTML = `<option value="">${t('allAssignees')}</option>` + users.map(u => `<option value="${u.id}">${u.name || u.email}</option>`).join('');
            if (rff) rff.innerHTML = `<option value="">${t('allFunctions')}</option>` + functions.map(f => `<option value="${f.name}">${f.name}</option>`).join('');
        }

        function formatDate(s) {
            const d = new Date(s);
            return d.toLocaleDateString(currentLang === 'ua' ? 'uk-UA' : 'ru-RU', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' });
        }

        function switchTab(t) {
            document.querySelectorAll('.tab-content').forEach(x => x.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(x => x.classList.remove('active'));
            document.getElementById(t + 'Tab').classList.add('active');
            document.querySelector(`[onclick="switchTab('${t}')"]`).classList.add('active');
            
            switch (t) {
                case 'tasks': renderTasks(); break;
                case 'control': renderControl(); break;
                case 'regular': renderRegularTasks(); break;
                case 'functions': renderFunctions(); break;
                case 'users': renderUsers(); break;
                case 'analytics': renderAnalytics(); break;
                case 'admin': renderAdminPanel(); break;
            }
        }
        
        function renderAnalytics() {
            const totalTasks = tasks.length;
            const completedTasks = tasks.filter(t => t.status === 'done').length;
            const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            document.getElementById('analyticsTotalTasks').textContent = totalTasks;
            document.getElementById('analyticsCompletedTasks').textContent = completedTasks;
            document.getElementById('analyticsCompletionRate').textContent = completionRate + '%';
            
            // –°–µ—Ä–µ–¥–Ω—ñ–π —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
            let totalTime = 0;
            let countWithTime = 0;
            tasks.forEach(task => {
                if (task.estimatedTime) {
                    totalTime += parseInt(task.estimatedTime);
                    countWithTime++;
                }
            });
            const avgTime = countWithTime > 0 ? Math.round(totalTime / countWithTime) : 0;
            const avgHours = Math.floor(avgTime / 60);
            const avgMins = avgTime % 60;
            document.getElementById('analyticsAvgTime').textContent = avgTime > 0 ? `${avgHours > 0 ? avgHours + '–≥ ' : ''}${avgMins}—Ö–≤` : '-';
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å–∞—Ö
            const byStatus = {
                new: tasks.filter(task => task.status === 'new').length,
                progress: tasks.filter(task => task.status === 'progress').length,
                review: tasks.filter(task => task.status === 'review').length,
                done: tasks.filter(task => task.status === 'done').length
            };
            
            // –¢–æ–ø –≤–∏–∫–æ–Ω–∞–≤—Ü—ñ–≤
            const byAssignee = {};
            tasks.filter(task => task.status === 'done').forEach(task => {
                const name = task.assigneeName || '–ù–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–æ';
                byAssignee[name] = (byAssignee[name] || 0) + 1;
            });
            const topAssignees = Object.entries(byAssignee).sort((a, b) => b[1] - a[1]).slice(0, 5);
            
            // –ü—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω—ñ
            const today = new Date().toISOString().split('T')[0];
            const overdue = tasks.filter(task => {
                const taskDate = task.deadlineDate || (task.deadline ? task.deadline.split('T')[0] : '');
                return taskDate && taskDate < today && task.status !== 'done';
            }).length;
            
            document.getElementById('analyticsContent').innerHTML = `
                <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(280px, 1fr));gap:1rem;">
                    <div style="background:#f8f9fa;border-radius:12px;padding:1rem;">
                        <h4 style="margin-bottom:0.75rem;">${t('byStatus')}</h4>
                        <div style="display:flex;flex-direction:column;gap:0.4rem;">
                            <div style="display:flex;justify-content:space-between;"><span>üÜï ${t('statusNew')}</span><strong>${byStatus.new}</strong></div>
                            <div style="display:flex;justify-content:space-between;"><span>üîÑ ${t('statusProgress')}</span><strong>${byStatus.progress}</strong></div>
                            <div style="display:flex;justify-content:space-between;"><span>üëÄ ${t('statusReview')}</span><strong>${byStatus.review}</strong></div>
                            <div style="display:flex;justify-content:space-between;"><span>‚úÖ ${t('statusDone')}</span><strong style="color:#27ae60;">${byStatus.done}</strong></div>
                            <div style="display:flex;justify-content:space-between;border-top:1px solid #ddd;padding-top:0.4rem;margin-top:0.25rem;"><span>üö® ${t('overdue')}</span><strong style="color:#e74c3c;">${overdue}</strong></div>
                        </div>
                    </div>
                    
                    <div style="background:#f8f9fa;border-radius:12px;padding:1rem;">
                        <h4 style="margin-bottom:0.75rem;">üèÜ ${t('topPerformers')}</h4>
                        ${topAssignees.length > 0 ? topAssignees.map(([name, count], i) => `
                            <div style="display:flex;justify-content:space-between;padding:0.3rem 0;">
                                <span>${i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : 'üë§'} ${name}</span>
                                <strong style="color:#27ae60;">${count} ‚úì</strong>
                            </div>
                        `).join('') : `<p style="color:#7f8c8d;">${t('noCompletedTasks')}</p>`}
                    </div>
                </div>
            `;
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
            editingId = null;
            editingUserId = null;
        }

        window.onclick = function(e) {
            ['taskModal', 'functionModal', 'regularTaskModal', 'inviteModal', 'userModal'].forEach(id => {
                if (e.target === document.getElementById(id)) closeModal(id);
            });
        }

        // Init language on load
        document.addEventListener('DOMContentLoaded', function() {
            setLanguage(currentLang);
        });
    </script>
</body>
</html>

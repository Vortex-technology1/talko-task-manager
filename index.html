<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TALKO System - –¢–∞—Å–∫ –ú–µ–Ω–µ–¥–∂–µ—Ä Pro</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #667eea;
            --primary-dark: #764ba2;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --info: #3498db;
            --dark: #2c3e50;
            --gray: #7f8c8d;
            --light: #f5f7fa;
            --white: #ffffff;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 40px rgba(0,0,0,0.15);
            --radius: 12px;
            --radius-sm: 8px;
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: var(--light); 
            color: var(--dark);
            min-height: 100vh;
        }
        
        /* HEADER */
        .header { 
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); 
            color: white; 
            padding: 0.75rem 1rem; 
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content { 
            max-width: 1400px; 
            margin: 0 auto; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .logo { font-size: 1.1rem; font-weight: 700; }
        
        .header-actions { display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap; }
        
        .header-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .header-btn:hover { background: rgba(255,255,255,0.3); }
        
        .user-info {
            display: none;
            background: rgba(255,255,255,0.2);
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
        }
        
        .lang-switch { display: flex; gap: 0.25rem; }
        
        .lang-btn { 
            background: rgba(255,255,255,0.2); 
            border: none; 
            color: white; 
            padding: 0.4rem 0.5rem; 
            border-radius: 5px; 
            cursor: pointer;
            font-size: 0.75rem;
        }
        
        .lang-btn.active { background: rgba(255,255,255,0.4); font-weight: 600; }
        
        /* CONTAINER */
        .container { max-width: 1400px; margin: 0 auto; padding: 1rem; }
        
        /* TAB NAVIGATION */
        .tab-navigation { 
            display: flex; 
            background: var(--white); 
            border-radius: var(--radius) var(--radius) 0 0; 
            box-shadow: var(--shadow);
            overflow-x: auto;
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
        }
        
        .tab-navigation::-webkit-scrollbar { display: none; }
        
        .tab-btn { 
            background: transparent; 
            border: none; 
            padding: 0.9rem 1rem; 
            cursor: pointer; 
            font-size: 0.8rem; 
            font-weight: 500; 
            color: var(--gray); 
            border-bottom: 3px solid transparent; 
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .tab-btn:hover { color: var(--dark); background: rgba(52, 73, 94, 0.05); }
        .tab-btn.active { color: var(--info); border-bottom-color: var(--info); font-weight: 600; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        /* CONTROLS */
        .controls { 
            background: var(--white); 
            padding: 1rem; 
            border-radius: 0 0 var(--radius) var(--radius); 
            box-shadow: var(--shadow); 
            margin-bottom: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .controls-row { display: flex; flex-wrap: wrap; gap: 0.5rem; }
        
        /* BUTTONS */
        .btn { 
            background: var(--info); 
            color: white; 
            border: none; 
            padding: 0.7rem 1rem; 
            border-radius: var(--radius-sm); 
            cursor: pointer; 
            font-size: 0.85rem; 
            font-weight: 500;
            min-height: 44px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
            transition: all 0.2s;
        }
        
        .btn:hover { transform: translateY(-1px); box-shadow: var(--shadow); }
        .btn:active { transform: translateY(0); }
        .btn-success { background: var(--success); }
        .btn-danger { background: var(--danger); }
        .btn-warning { background: var(--warning); }
        .btn-clear { background: var(--gray); }
        .btn-small { padding: 0.4rem 0.6rem; font-size: 0.8rem; min-height: 36px; }
        
        /* FILTERS */
        .filters { display: flex; flex-wrap: wrap; gap: 0.5rem; width: 100%; }
        
        .filter-select { 
            padding: 0.6rem; 
            border: 2px solid #ecf0f1; 
            border-radius: var(--radius-sm); 
            background: var(--white); 
            font-size: 0.85rem;
            min-height: 44px;
            flex: 1;
            min-width: 100px;
        }
        
        .filter-select:focus { outline: none; border-color: var(--info); }
        
        /* TASK CARDS */
        .tasks-container {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        
        .task-card {
            padding: 1rem;
            border-bottom: 1px solid #ecf0f1;
            transition: all 0.2s;
        }
        
        .task-card:last-child { border-bottom: none; }
        .task-card:hover { background: #f8f9fa; }
        
        .task-card.pinned {
            background: linear-gradient(90deg, rgba(52, 152, 219, 0.08) 0%, var(--white) 100%);
            border-left: 4px solid var(--info);
        }
        
        .task-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .task-title {
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95rem;
            flex: 1;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        
        .pin-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            color: #bdc3c7;
            padding: 0.2rem;
        }
        
        .pin-btn:hover, .pin-btn.pinned { color: var(--warning); }
        
        .task-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .task-meta-item { display: flex; align-items: center; gap: 0.2rem; }
        
        .task-badges { display: flex; flex-wrap: wrap; gap: 0.4rem; margin-bottom: 0.5rem; }
        
        .badge {
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 500;
        }
        
        .badge-new { background: #e3f2fd; color: #1976d2; }
        .badge-progress { background: #fff3e0; color: #f57c00; }
        .badge-review { background: #fce4ec; color: #c2185b; }
        .badge-done { background: #e8f5e8; color: #388e3c; }
        .badge-single { background: #e3f2fd; color: #1976d2; }
        .badge-regular { background: #f3e5f5; color: #7b1fa2; }
        .badge-bottleneck { background: #ffebee; color: #d32f2f; }
        .badge-high { background: #ffebee; color: #d32f2f; }
        .badge-medium { background: #fff3e0; color: #f57c00; }
        .badge-low { background: #e8f5e8; color: #388e3c; }
        
        .task-actions { display: flex; gap: 0.4rem; justify-content: flex-end; }
        
        .task-info {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 0.5rem;
            padding: 0.5rem;
            background: #f8f9fa;
            border-radius: var(--radius-sm);
        }
        
        /* EMPTY STATE */
        .empty-state { text-align: center; padding: 2.5rem 1.5rem; color: var(--gray); }
        .empty-state h3 { margin-bottom: 0.5rem; color: var(--dark); font-size: 1.1rem; }
        .empty-state p { font-size: 0.85rem; }
        
        /* MODAL */
        .modal { 
            display: none; 
            position: fixed; 
            z-index: 1000; 
            left: 0; top: 0; 
            width: 100%; height: 100%; 
            background: rgba(0,0,0,0.5); 
            backdrop-filter: blur(3px);
            overflow-y: auto;
            padding: 0.5rem;
        }
        
        .modal-content { 
            background: var(--white); 
            margin: 0 auto;
            border-radius: var(--radius); 
            width: 100%;
            max-width: 550px;
            max-height: calc(100vh - 1rem);
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }
        
        .modal-header { 
            background: var(--dark); 
            color: white; 
            padding: 1rem; 
            border-radius: var(--radius) var(--radius) 0 0;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .modal-header h2 { font-size: 1.1rem; padding-right: 2rem; }
        
        .modal-body { padding: 1rem; }
        
        .close { 
            color: rgba(255,255,255,0.7);
            position: absolute;
            right: 1rem; top: 0.8rem;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .close:hover { color: white; }
        
        /* FORMS */
        .form-grid { display: grid; grid-template-columns: 1fr; gap: 0.9rem; }
        .form-group { display: flex; flex-direction: column; }
        .form-group.full-width { grid-column: span 1; }
        .form-label { margin-bottom: 0.4rem; font-weight: 600; color: var(--dark); font-size: 0.85rem; }
        
        .form-input, .form-select, .form-textarea { 
            padding: 0.7rem; 
            border: 2px solid #ecf0f1; 
            border-radius: var(--radius-sm); 
            font-size: 1rem;
            min-height: 44px;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus { outline: none; border-color: var(--info); }
        .form-textarea { resize: vertical; min-height: 70px; }
        .form-actions { display: flex; gap: 0.5rem; justify-content: flex-end; margin-top: 1rem; flex-wrap: wrap; }
        
        /* CARDS GRID */
        .cards-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
            padding: 1rem;
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }
        
        .function-card, .user-card, .regular-task-card {
            background: #f8f9fa;
            border: 2px solid #ecf0f1;
            border-radius: var(--radius);
            padding: 1rem;
            transition: all 0.2s;
        }
        
        .function-card:hover, .user-card:hover { border-color: var(--info); box-shadow: var(--shadow); }
        
        .function-header, .user-header, .regular-task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }
        
        .function-title, .user-name, .regular-task-title { font-size: 1rem; font-weight: 600; }
        
        .function-head {
            background: var(--warning);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        .function-description, .user-details {
            color: var(--gray);
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }
        
        .user-details div { margin-bottom: 0.2rem; }
        
        .function-assignees { display: flex; flex-wrap: wrap; gap: 0.3rem; margin-bottom: 0.5rem; }
        
        .assignee-badge {
            background: var(--success);
            color: white;
            padding: 0.15rem 0.5rem;
            border-radius: 10px;
            font-size: 0.7rem;
        }
        
        .assignee-badge.head { background: var(--warning); }
        
        .function-stats, .user-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 0.5rem;
            border-top: 1px solid #ecf0f1;
            margin-bottom: 0.5rem;
            font-size: 0.8rem;
        }
        
        .function-stat { color: var(--info); font-weight: 600; }
        
        .role-badge {
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
            color: white;
        }
        
        .role-badge.owner { background: var(--danger); }
        .role-badge.manager { background: var(--warning); }
        .role-badge.employee { background: var(--info); }
        
        /* DASHBOARD */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.6rem;
            margin-bottom: 1rem;
        }
        
        .dashboard-card {
            border-radius: var(--radius);
            padding: 0.8rem;
            text-align: center;
            color: white;
        }
        
        .dashboard-card.urgent { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%); }
        .dashboard-card.warning { background: linear-gradient(135deg, #feca57 0%, #f39c12 100%); }
        .dashboard-card.active { background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); }
        .dashboard-card.completed { background: linear-gradient(135deg, #55efc4 0%, #00b894 100%); }
        
        .dashboard-card h3 { font-size: 0.75rem; margin-bottom: 0.2rem; opacity: 0.9; }
        .dashboard-number { font-size: 1.75rem; font-weight: 700; }
        .dashboard-card p { font-size: 0.65rem; opacity: 0.8; }
        
        /* ANALYTICS */
        .analytics-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.6rem;
            margin-bottom: 1rem;
        }
        
        .analytics-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-radius: var(--radius);
            padding: 0.8rem;
            text-align: center;
        }
        
        .analytics-card h3 { font-size: 0.75rem; margin-bottom: 0.2rem; opacity: 0.9; }
        .analytics-number { font-size: 1.5rem; font-weight: 700; }
        
        .chart-container {
            background: #f8f9fa;
            border-radius: var(--radius-sm);
            padding: 0.8rem;
            margin-bottom: 0.8rem;
        }
        
        .chart-container h3 { color: var(--dark); font-size: 0.9rem; margin-bottom: 0.6rem; }
        
        /* REGULAR TASKS */
        .regular-task-info {
            background: #f0f0f0;
            border-radius: var(--radius-sm);
            padding: 0.6rem;
            font-size: 0.8rem;
            line-height: 1.4;
            margin-bottom: 0.5rem;
        }
        
        .regular-task-info div { margin-bottom: 0.2rem; }
        .regular-task-info strong { color: var(--dark); }
        
        .regular-task-assignees-title { font-size: 0.8rem; font-weight: 600; color: var(--dark); margin-bottom: 0.4rem; }
        
        .assignee-checkboxes { display: flex; flex-wrap: wrap; gap: 0.4rem; }
        
        .assignee-checkbox {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            background: #e8f5e8;
            color: var(--success);
            padding: 0.3rem 0.5rem;
            border-radius: 15px;
            font-size: 0.8rem;
        }
        
        .assignee-checkbox input[type="checkbox"] { width: 14px; height: 14px; cursor: pointer; }
        
        /* AUTH PAGE */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: calc(100vh - 80px);
            padding: 1rem;
        }
        
        .auth-card {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 380px;
            overflow: hidden;
        }
        
        .auth-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 1.25rem;
            text-align: center;
        }
        
        .auth-header h2 { font-size: 1.4rem; margin-bottom: 0.3rem; }
        .auth-header p { opacity: 0.9; font-size: 0.85rem; }
        .auth-body { padding: 1.25rem; }
        .auth-form h3 { margin-bottom: 1rem; color: var(--dark); text-align: center; font-size: 1rem; }
        .main-interface { display: none; }
        
        /* FOOTER */
        .footer {
            text-align: center;
            padding: 1.25rem;
            background: #f8f9fa;
            border-top: 1px solid #ecf0f1;
            margin-top: 1.5rem;
        }
        
        .footer p { color: var(--gray); font-size: 0.8rem; margin-bottom: 0.5rem; }
        .footer-links { display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap; }
        .footer-links a { color: var(--info); text-decoration: none; font-size: 0.8rem; }
        
        /* SUPPORT BUTTON */
        .support-btn {
            position: fixed;
            bottom: 16px;
            right: 16px;
            z-index: 999;
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 10px 16px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: #ffffff !important;
            border-radius: 50px;
            font-weight: 600;
            font-size: 13px;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
            cursor: pointer;
            text-decoration: none;
            border: none;
        }
        
        .support-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(16, 185, 129, 0.5); }
        .support-btn svg { width: 18px; height: 18px; stroke: #ffffff; }
        
        /* DESKTOP */
        @media (min-width: 768px) {
            .header { padding: 1rem 2rem; }
            .logo { font-size: 1.4rem; }
            .user-info { display: flex; }
            .container { padding: 1.5rem; }
            .controls { flex-direction: row; align-items: center; justify-content: space-between; }
            .filters { width: auto; flex-wrap: nowrap; }
            .filter-select { flex: none; min-width: auto; }
            .form-grid { grid-template-columns: 1fr 1fr; }
            .form-group.full-width { grid-column: span 2; }
            .cards-grid { grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); }
            .dashboard-cards, .analytics-cards { grid-template-columns: repeat(4, 1fr); }
            .dashboard-number { font-size: 2rem; }
            .analytics-number { font-size: 1.75rem; }
        }
        
        @media (max-width: 400px) {
            .support-btn span { display: none; }
            .support-btn { padding: 12px; border-radius: 50%; }
        }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.25s ease-out; }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">üöÄ TALKO System</div>
            <div class="header-actions">
                <div class="user-info" id="currentUserInfo">
                    <span>üë§ <span id="currentUserName">...</span></span>
                    <span id="currentUserRole" style="opacity: 0.8; font-size: 0.8rem;"></span>
                </div>
                <button class="header-btn" onclick="logout()" id="logoutBtn" style="display: none;">üö™ –í–∏–π—Ç–∏</button>
                <div class="lang-switch">
                    <button class="lang-btn active" onclick="setLanguage('ua')">UA</button>
                    <button class="lang-btn" onclick="setLanguage('ru')">RU</button>
                    <button class="lang-btn" onclick="setLanguage('en')">EN</button>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- AUTH PAGE -->
        <div id="authPage" class="auth-container">
            <div class="auth-card">
                <div class="auth-header">
                    <h2>üöÄ TALKO System</h2>
                    <p>–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è–º–∏ –¥–ª—è –±—ñ–∑–Ω–µ—Å—É</p>
                </div>
                <div class="auth-body">
                    <div id="loginForm" class="auth-form">
                        <h3>–í—Ö—ñ–¥ –¥–æ —Å–∏—Å—Ç–µ–º–∏</h3>
                        <div class="form-group">
                            <label class="form-label">Email:</label>
                            <input type="email" id="loginEmail" class="form-input" placeholder="your@email.com">
                        </div>
                        <button onclick="sendLoginCode()" class="btn btn-success" style="width: 100%; margin-top: 1rem;">üìß –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –∫–æ–¥</button>
                        <div style="text-align: center; margin-top: 1rem; padding: 0.8rem; background: #f8f9fa; border-radius: 8px;">
                            <p style="color: #7f8c8d; font-size: 0.8rem;"><strong>–ù–µ–º–∞—î –¥–æ—Å—Ç—É–ø—É?</strong><br>–ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</p>
                        </div>
                    </div>
                    <div id="codeForm" class="auth-form" style="display: none;">
                        <h3>–í–≤–µ–¥—ñ—Ç—å –∫–æ–¥</h3>
                        <div class="form-group">
                            <label class="form-label">–ö–æ–¥ –∑ email:</label>
                            <input type="text" id="loginCode" class="form-input" placeholder="123456" maxlength="6">
                        </div>
                        <button onclick="verifyLoginCode()" class="btn btn-success" style="width: 100%; margin-top: 1rem;">‚úÖ –£–≤—ñ–π—Ç–∏</button>
                        <button onclick="backToLogin()" class="btn" style="width: 100%; margin-top: 0.5rem;">‚Üê –ù–∞–∑–∞–¥</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- MAIN INTERFACE -->
        <div id="mainInterface" class="main-interface">
            <div class="tab-navigation">
                <button class="tab-btn active" onclick="switchTab('tasks')">üìã –ó–∞–≤–¥–∞–Ω–Ω—è</button>
                <button class="tab-btn" onclick="switchTab('control')">üìä –ö–æ–Ω—Ç—Ä–æ–ª—å</button>
                <button class="tab-btn" onclick="switchTab('regular')">üîÑ –†–µ–≥—É–ª—è—Ä–Ω—ñ</button>
                <button class="tab-btn" onclick="switchTab('functions')">‚öôÔ∏è –§—É–Ω–∫—Ü—ñ—ó</button>
                <button class="tab-btn" onclick="switchTab('users')">üë• –ö–æ–º–∞–Ω–¥–∞</button>
                <button class="tab-btn" onclick="switchTab('analytics')">üìà –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞</button>
            </div>

            <!-- TASKS -->
            <div id="tasksTab" class="tab-content active">
                <div class="controls">
                    <div class="controls-row">
                        <button class="btn btn-success" onclick="openTaskModal()">+ –ó–∞–≤–¥–∞–Ω–Ω—è</button>
                        <button class="btn" onclick="exportToCSV()">üìä –ï–∫—Å–ø–æ—Ä—Ç</button>
                    </div>
                    <div class="filters">
                        <select class="filter-select" id="statusFilter" onchange="renderTasks()">
                            <option value="">–í—Å—ñ —Å—Ç–∞—Ç—É—Å–∏</option>
                            <option value="new">–ù–æ–≤—ñ</option>
                            <option value="progress">–í —Ä–æ–±–æ—Ç—ñ</option>
                            <option value="review">–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞</option>
                            <option value="done">–ì–æ—Ç–æ–≤–æ</option>
                        </select>
                        <select class="filter-select" id="functionFilter" onchange="renderTasks()"><option value="">–í—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó</option></select>
                        <select class="filter-select" id="assigneeFilter" onchange="renderTasks()"><option value="">–í—Å—ñ –≤–∏–∫–æ–Ω–∞–≤—Ü—ñ</option></select>
                        <button class="btn btn-clear btn-small" onclick="clearFilters()">üóëÔ∏è</button>
                    </div>
                </div>
                <div class="tasks-container" id="tasksContainer"></div>
            </div>

            <!-- CONTROL -->
            <div id="controlTab" class="tab-content">
                <div class="controls"><h2 style="font-size: 1.1rem;">üìä –ü–∞–Ω–µ–ª—å –∫–æ–Ω—Ç—Ä–æ–ª—é</h2></div>
                <div style="background: white; border-radius: 12px; padding: 1rem; box-shadow: var(--shadow);">
                    <div class="dashboard-cards">
                        <div class="dashboard-card urgent"><h3>üö® –ö—Ä–∏—Ç–∏—á–Ω—ñ</h3><div class="dashboard-number" id="urgentCount">0</div><p>–ü—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω—ñ</p></div>
                        <div class="dashboard-card warning"><h3>‚ö†Ô∏è –£–≤–∞–≥–∞</h3><div class="dashboard-number" id="warningCount">0</div><p>–°—å–æ–≥–æ–¥–Ω—ñ-–∑–∞–≤—Ç—Ä–∞</p></div>
                        <div class="dashboard-card active"><h3>üîÑ –ê–∫—Ç–∏–≤–Ω—ñ</h3><div class="dashboard-number" id="activeCount">0</div><p>–í —Ä–æ–±–æ—Ç—ñ</p></div>
                        <div class="dashboard-card completed"><h3>‚úÖ –ì–æ—Ç–æ–≤–æ</h3><div class="dashboard-number" id="completedCount">0</div><p>–ó–∞–≤–µ—Ä—à–µ–Ω—ñ</p></div>
                    </div>
                    <div id="controlContent"></div>
                </div>
            </div>

            <!-- REGULAR -->
            <div id="regularTab" class="tab-content">
                <div class="controls">
                    <div class="controls-row"><button class="btn btn-success" onclick="openRegularTaskModal()">+ –†–µ–≥—É–ª—è—Ä–Ω–µ</button></div>
                    <div class="filters"><select class="filter-select" id="regularFunctionFilter" onchange="renderRegularTasks()"><option value="">–í—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó</option></select></div>
                </div>
                <div id="regularTasksContainer" class="cards-grid"></div>
            </div>

            <!-- FUNCTIONS -->
            <div id="functionsTab" class="tab-content">
                <div class="controls"><button class="btn btn-success" onclick="openFunctionModal()">+ –§—É–Ω–∫—Ü—ñ—è</button></div>
                <div id="functionsContainer" class="cards-grid"></div>
            </div>

            <!-- USERS -->
            <div id="usersTab" class="tab-content">
                <div class="controls">
                    <div class="controls-row">
                        <button class="btn btn-success" onclick="openUserModal()">+ –î–æ–¥–∞—Ç–∏</button>
                        <button class="btn btn-warning" onclick="openInviteModal()">üì§ –ó–∞–ø—Ä–æ—Å–∏—Ç–∏</button>
                    </div>
                    <div class="filters"><select class="filter-select" id="userRoleFilter" onchange="renderUsers()"><option value="">–í—Å—ñ —Ä–æ–ª—ñ</option><option value="owner">–í–ª–∞—Å–Ω–∏–∫</option><option value="manager">–ú–µ–Ω–µ–¥–∂–µ—Ä</option><option value="employee">–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫</option></select></div>
                </div>
                <div id="usersContainer" class="cards-grid"></div>
            </div>

            <!-- ANALYTICS -->
            <div id="analyticsTab" class="tab-content">
                <div style="background: white; border-radius: 12px; padding: 1rem; box-shadow: var(--shadow);">
                    <div class="analytics-cards">
                        <div class="analytics-card"><h3>–í—Å—å–æ–≥–æ</h3><div class="analytics-number" id="totalTasksCount">0</div></div>
                        <div class="analytics-card"><h3>–í–∏–∫–æ–Ω–∞–Ω–æ</h3><div class="analytics-number" id="completedTasksCount">0</div></div>
                        <div class="analytics-card"><h3>–ü—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–æ</h3><div class="analytics-number" id="overdueTasksCount">0</div></div>
                        <div class="analytics-card"><h3>–ï—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å</h3><div class="analytics-number" id="efficiencyPercent">0%</div></div>
                    </div>
                    <div class="chart-container"><h3>üìä –°—Ç–∞—Ç—É—Å–∏</h3><div id="statusChart"></div></div>
                    <div class="chart-container"><h3>üë• –ù–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</h3><div id="workloadChart"></div></div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><span class="close" onclick="closeTaskModal()">&times;</span><h2 id="taskModalTitle">–ù–æ–≤–µ –∑–∞–≤–¥–∞–Ω–Ω—è</h2></div>
            <div class="modal-body">
                <form id="taskForm">
                    <div class="form-grid">
                        <div class="form-group full-width"><label class="form-label">–ù–∞–∑–≤–∞ *</label><input type="text" id="taskTitle" class="form-input" required></div>
                        <div class="form-group"><label class="form-label">–§—É–Ω–∫—Ü—ñ—è</label><select id="taskFunction" class="form-select"><option value="">–ë–µ–∑ —Ñ—É–Ω–∫—Ü—ñ—ó</option></select></div>
                        <div class="form-group"><label class="form-label">–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å *</label><select id="taskAssignee" class="form-select" required><option value="">–û–±–µ—Ä—ñ—Ç—å</option></select></div>
                        <div class="form-group"><label class="form-label">–î–µ–¥–ª–∞–π–Ω *</label><input type="datetime-local" id="taskDeadline" class="form-input" required></div>
                        <div class="form-group"><label class="form-label">–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç</label><select id="taskPriority" class="form-select"><option value="low">–ù–∏–∑—å–∫–∏–π</option><option value="medium" selected>–°–µ—Ä–µ–¥–Ω—ñ–π</option><option value="high">–í–∏—Å–æ–∫–∏–π</option></select></div>
                        <div class="form-group"><label class="form-label">–¢–∏–ø</label><select id="taskType" class="form-select"><option value="single">–†–∞–∑–æ–≤–µ</option><option value="regular">–†–µ–≥—É–ª—è—Ä–Ω–µ</option><option value="bottleneck">–í—É–∑—å–∫–µ –º—ñ—Å—Ü–µ</option></select></div>
                        <div class="form-group"><label class="form-label">–°—Ç–∞—Ç—É—Å</label><select id="taskStatus" class="form-select"><option value="new">–ù–æ–≤–µ</option><option value="progress">–í —Ä–æ–±–æ—Ç—ñ</option><option value="review">–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞</option><option value="done">–ì–æ—Ç–æ–≤–æ</option></select></div>
                        <div class="form-group full-width"><label class="form-label">–û–ø–∏—Å</label><textarea id="taskDescription" class="form-textarea"></textarea></div>
                    </div>
                    <div class="form-actions"><button type="button" class="btn" onclick="closeTaskModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button><button type="submit" class="btn btn-success">–ó–±–µ—Ä–µ–≥—Ç–∏</button></div>
                </form>
            </div>
        </div>
    </div>

    <div id="functionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><span class="close" onclick="closeFunctionModal()">&times;</span><h2 id="functionModalTitle">–ù–æ–≤–∞ —Ñ—É–Ω–∫—Ü—ñ—è</h2></div>
            <div class="modal-body">
                <form id="functionForm">
                    <div class="form-grid">
                        <div class="form-group"><label class="form-label">–ù–∞–∑–≤–∞ *</label><input type="text" id="functionName" class="form-input" required></div>
                        <div class="form-group"><label class="form-label">–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç</label><input type="text" id="functionDepartment" class="form-input"></div>
                        <div class="form-group"><label class="form-label">–ö–æ–ª—ñ—Ä</label><input type="color" id="functionColor" class="form-input" value="#3498db" style="height:44px;"></div>
                        <div class="form-group"><label class="form-label">üëë –ì–æ–ª–æ–≤–Ω–∏–π *</label><select id="functionHead" class="form-select" required><option value="">–û–±–µ—Ä—ñ—Ç—å</option></select></div>
                        <div class="form-group full-width"><label class="form-label">–û–ø–∏—Å</label><textarea id="functionDescription" class="form-textarea"></textarea></div>
                        <div class="form-group full-width"><label class="form-label">üë• –£—á–∞—Å–Ω–∏–∫–∏</label><div id="functionAssignees" style="display:flex;flex-wrap:wrap;gap:0.4rem;margin-top:0.4rem;"></div></div>
                    </div>
                    <div class="form-actions"><button type="button" class="btn" onclick="closeFunctionModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button><button type="submit" class="btn btn-success">–ó–±–µ—Ä–µ–≥—Ç–∏</button></div>
                </form>
            </div>
        </div>
    </div>

    <div id="regularTaskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><span class="close" onclick="closeRegularTaskModal()">&times;</span><h2>–†–µ–≥—É–ª—è—Ä–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è</h2></div>
            <div class="modal-body">
                <form id="regularTaskForm">
                    <div class="form-grid">
                        <div class="form-group full-width"><label class="form-label">–ù–∞–∑–≤–∞ *</label><input type="text" id="regularTaskTitle" class="form-input" required></div>
                        <div class="form-group"><label class="form-label">–§—É–Ω–∫—Ü—ñ—è *</label><select id="regularTaskFunction" class="form-select" required onchange="updateRegularTaskAssignees()"><option value="">–û–±–µ—Ä—ñ—Ç—å</option></select></div>
                        <div class="form-group"><label class="form-label">–ü–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ—Å—Ç—å</label><select id="regularTaskPeriod" class="form-select"><option value="daily">–©–æ–¥–Ω—è</option><option value="weekly">–©–æ—Ç–∏–∂–Ω—è</option><option value="monthly">–©–æ–º—ñ—Å—è—Ü—è</option><option value="workdays">–†–æ–±–æ—á—ñ –¥–Ω—ñ</option></select></div>
                        <div class="form-group"><label class="form-label">–î–Ω—ñ–≤ –Ω–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è</label><input type="number" id="regularTaskDuration" class="form-input" value="1" min="1" max="30"></div>
                        <div class="form-group full-width"><label class="form-label">–û–ø–∏—Å</label><textarea id="regularTaskDescription" class="form-textarea"></textarea></div>
                        <div class="form-group full-width"><label class="form-label">üë• –ö–æ–º—É –ø—Ä–∏–∑–Ω–∞—á–∞—Ç–∏</label><div id="regularTaskAssignees" style="display:flex;flex-wrap:wrap;gap:0.4rem;margin-top:0.4rem;padding:0.8rem;background:#f8f9fa;border-radius:8px;"><p style="color:#7f8c8d;font-size:0.85rem;">–°–ø–æ—á–∞—Ç–∫—É –æ–±–µ—Ä—ñ—Ç—å —Ñ—É–Ω–∫—Ü—ñ—é</p></div></div>
                    </div>
                    <div class="form-actions"><button type="button" class="btn" onclick="closeRegularTaskModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button><button type="submit" class="btn btn-success">–ó–±–µ—Ä–µ–≥—Ç–∏</button></div>
                </form>
            </div>
        </div>
    </div>

    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><span class="close" onclick="closeUserModal()">&times;</span><h2 id="userModalTitle">–ù–æ–≤–∏–π —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫</h2></div>
            <div class="modal-body">
                <form id="userForm">
                    <div class="form-grid">
                        <div class="form-group"><label class="form-label">–Ü–º'—è *</label><input type="text" id="userName" class="form-input" required></div>
                        <div class="form-group"><label class="form-label">Email *</label><input type="email" id="userEmail" class="form-input" required></div>
                        <div class="form-group"><label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label><input type="tel" id="userPhone" class="form-input"></div>
                        <div class="form-group"><label class="form-label">–†–æ–ª—å *</label><select id="userRole" class="form-select" required><option value="employee">–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫</option><option value="manager">–ú–µ–Ω–µ–¥–∂–µ—Ä</option><option value="owner">–í–ª–∞—Å–Ω–∏–∫</option></select></div>
                        <div class="form-group"><label class="form-label">–ü–æ—Å–∞–¥–∞</label><input type="text" id="userPosition" class="form-input"></div>
                        <div class="form-group"><label class="form-label">–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç</label><input type="text" id="userDepartment" class="form-input"></div>
                    </div>
                    <div class="form-actions"><button type="button" class="btn" onclick="closeUserModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button><button type="submit" class="btn btn-success">–ó–±–µ—Ä–µ–≥—Ç–∏</button></div>
                </form>
            </div>
        </div>
    </div>

    <div id="inviteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><span class="close" onclick="closeInviteModal()">&times;</span><h2>üì§ –ó–∞–ø—Ä–æ—à–µ–Ω–Ω—è</h2></div>
            <div class="modal-body">
                <form id="inviteForm">
                    <div class="form-grid">
                        <div class="form-group"><label class="form-label">Email *</label><input type="email" id="inviteEmail" class="form-input" required></div>
                        <div class="form-group"><label class="form-label">–†–æ–ª—å</label><select id="inviteRole" class="form-select"><option value="employee">–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫</option><option value="manager">–ú–µ–Ω–µ–¥–∂–µ—Ä</option></select></div>
                    </div>
                    <div class="form-actions"><button type="button" class="btn" onclick="closeInviteModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button><button type="submit" class="btn btn-success">üì§ –°—Ç–≤–æ—Ä–∏—Ç–∏</button></div>
                </form>
            </div>
        </div>
    </div>

    <a href="https://alextalko.com" target="_blank" class="support-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
        <span>–ü—ñ–¥—Ç—Ä–∏–º–∫–∞</span>
    </a>

    <footer class="footer">
        <p>Powered by <strong style="color: #3498db;">TALKO System</strong></p>
        <div class="footer-links"><a href="https://alextalko.com" target="_blank">üõü –ü—ñ–¥—Ç—Ä–∏–º–∫–∞</a><a href="https://alextalko.com" target="_blank">üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è</a></div>
        <p style="font-size: 0.7rem; margin-top: 0.5rem;">¬© 2024 TALKO System</p>
    </footer>

    <script>
        // FIREBASE
        const firebaseConfig={apiKey:"AIzaSyCIHYGKw2pZXBXrR7lYFXOB1_F616rufGc",authDomain:"talko-task-system-prod.firebaseapp.com",projectId:"talko-task-system-prod",storageBucket:"talko-task-system-prod.firebasestorage.app",messagingSenderId:"840530352572",appId:"1:840530352572:web:27200f053aa2c9671773b9"};
        let db=null,auth=null;
        try{firebase.initializeApp(firebaseConfig);db=firebase.firestore();auth=firebase.auth();console.log('üî• Firebase OK');}catch(e){console.log('üì± Demo mode');}

        // STATE
        let currentUser=null,currentCompany=null,tasks=[],users=[],functions=[],regularTasks=[];
        let editingTaskId=null,editingFunctionId=null,editingUserId=null,editingRegularTaskId=null;
        let currentLanguage=localStorage.getItem('talko_lang')||'ua',authCodes={};

        // AUTH
        function checkAuth(){const s=localStorage.getItem('talko_session');if(s){const d=JSON.parse(s);currentUser=d.user;currentCompany=d.company;showMainInterface();loadData();}else{showAuthPage();}}
        function showAuthPage(){document.getElementById('authPage').style.display='flex';document.getElementById('mainInterface').style.display='none';document.getElementById('logoutBtn').style.display='none';}
        function showMainInterface(){document.getElementById('authPage').style.display='none';document.getElementById('mainInterface').style.display='block';document.getElementById('logoutBtn').style.display='block';document.getElementById('currentUserInfo').style.display='flex';if(currentUser){document.getElementById('currentUserName').textContent=currentUser.name;const r={owner:'–í–ª–∞—Å–Ω–∏–∫',manager:'–ú–µ–Ω–µ–¥–∂–µ—Ä',employee:'–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫'}[currentUser.role]||'';document.getElementById('currentUserRole').textContent=r?`(${r})`:'';}renderTasks();}
        function sendLoginCode(){const email=document.getElementById('loginEmail').value.trim();if(!email){alert('–í–≤–µ–¥—ñ—Ç—å email');return;}const code=Math.floor(100000+Math.random()*900000).toString();authCodes[email]={code,expiry:Date.now()+10*60*1000};alert(`üìß –ö–æ–¥: ${code}`);document.getElementById('loginForm').style.display='none';document.getElementById('codeForm').style.display='block';window.currentAuthEmail=email;}
        function verifyLoginCode(){const code=document.getElementById('loginCode').value.trim();const d=authCodes[window.currentAuthEmail];if(!d||Date.now()>d.expiry){alert('‚ùå –ö–æ–¥ –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–∏–π');backToLogin();return;}if(code!==d.code){alert('‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –∫–æ–¥');return;}let user=users.find(u=>u.email===window.currentAuthEmail);if(!user){user={id:Date.now(),name:window.currentAuthEmail.split('@')[0],email:window.currentAuthEmail,role:'owner',createdAt:new Date().toISOString()};users.push(user);}currentUser=user;currentCompany={id:'demo',name:'Demo Company'};localStorage.setItem('talko_session',JSON.stringify({user:currentUser,company:currentCompany}));delete authCodes[window.currentAuthEmail];showMainInterface();loadData();alert(`üéâ –í—ñ—Ç–∞—î–º–æ, ${currentUser.name}!`);}
        function backToLogin(){document.getElementById('loginForm').style.display='block';document.getElementById('codeForm').style.display='none';document.getElementById('loginCode').value='';}
        function logout(){localStorage.removeItem('talko_session');currentUser=null;showAuthPage();}

        // DATA
        function loadData(){tasks=JSON.parse(localStorage.getItem('talko_tasks')||'[]');users=JSON.parse(localStorage.getItem('talko_users')||'[]');functions=JSON.parse(localStorage.getItem('talko_functions')||'[]');regularTasks=JSON.parse(localStorage.getItem('talko_regular')||'[]');if(currentUser&&!users.find(u=>u.email===currentUser.email)){users.push(currentUser);saveData();}updateSelects();renderTasks();}
        function saveData(){localStorage.setItem('talko_tasks',JSON.stringify(tasks));localStorage.setItem('talko_users',JSON.stringify(users));localStorage.setItem('talko_functions',JSON.stringify(functions));localStorage.setItem('talko_regular',JSON.stringify(regularTasks));}

        // TASKS
        function openTaskModal(id=null){document.getElementById('taskModal').style.display='block';updateSelects();if(id){editingTaskId=id;const t=tasks.find(x=>x.id===id);if(t){document.getElementById('taskModalTitle').textContent='–†–µ–¥–∞–≥—É–≤–∞—Ç–∏';document.getElementById('taskTitle').value=t.title;document.getElementById('taskFunction').value=t.function||'';document.getElementById('taskAssignee').value=t.assignee;document.getElementById('taskDeadline').value=t.deadline;document.getElementById('taskPriority').value=t.priority||'medium';document.getElementById('taskType').value=t.type||'single';document.getElementById('taskStatus').value=t.status||'new';document.getElementById('taskDescription').value=t.description||'';}}else{editingTaskId=null;document.getElementById('taskModalTitle').textContent='–ù–æ–≤–µ –∑–∞–≤–¥–∞–Ω–Ω—è';document.getElementById('taskForm').reset();document.getElementById('taskPriority').value='medium';}}
        function closeTaskModal(){document.getElementById('taskModal').style.display='none';editingTaskId=null;}
        function saveTask(e){e.preventDefault();const data={title:document.getElementById('taskTitle').value.trim(),function:document.getElementById('taskFunction').value,assignee:document.getElementById('taskAssignee').value,deadline:document.getElementById('taskDeadline').value,priority:document.getElementById('taskPriority').value,type:document.getElementById('taskType').value,status:document.getElementById('taskStatus').value,description:document.getElementById('taskDescription').value.trim(),creator:currentUser?.name||'System',updatedAt:new Date().toISOString()};if(!data.title||!data.assignee||!data.deadline){alert('–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –æ–±–æ–≤\'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è');return;}if(editingTaskId){const i=tasks.findIndex(t=>t.id===editingTaskId);if(i!==-1)tasks[i]={...tasks[i],...data};}else{tasks.push({id:Date.now(),...data,pinned:false,createdAt:new Date().toISOString()});}saveData();renderTasks();closeTaskModal();}
        function deleteTask(id){if(confirm('–í–∏–¥–∞–ª–∏—Ç–∏?')){tasks=tasks.filter(t=>t.id!==id);saveData();renderTasks();}}
        function togglePin(id){const t=tasks.find(x=>x.id===id);if(t){t.pinned=!t.pinned;saveData();renderTasks();}}
        function renderTasks(){const c=document.getElementById('tasksContainer');const sf=document.getElementById('statusFilter')?.value;const ff=document.getElementById('functionFilter')?.value;const af=document.getElementById('assigneeFilter')?.value;let f=tasks.filter(t=>{if(sf&&t.status!==sf)return false;if(ff&&t.function!==ff)return false;if(af&&t.assignee!==af)return false;return true;});f.sort((a,b)=>{if(a.pinned&&!b.pinned)return -1;if(!a.pinned&&b.pinned)return 1;return new Date(a.deadline)-new Date(b.deadline);});if(f.length===0){c.innerHTML='<div class="empty-state"><h3>üìã –ó–∞–≤–¥–∞–Ω—å –Ω–µ–º–∞—î</h3><p>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "+ –ó–∞–≤–¥–∞–Ω–Ω—è"</p></div>';return;}const st={new:'–ù–æ–≤–µ',progress:'–í —Ä–æ–±–æ—Ç—ñ',review:'–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞',done:'–ì–æ—Ç–æ–≤–æ'};const tt={single:'–†–∞–∑–æ–≤–µ',regular:'–†–µ–≥—É–ª—è—Ä–Ω–µ',bottleneck:'–í—É–∑—å–∫–µ –º—ñ—Å—Ü–µ'};const pt={low:'–ù–∏–∑—å–∫–∏–π',medium:'–°–µ—Ä–µ–¥–Ω—ñ–π',high:'–í–∏—Å–æ–∫–∏–π'};c.innerHTML=f.map(t=>{const od=new Date(t.deadline)<new Date()&&t.status!=='done';return`<div class="task-card ${t.pinned?'pinned':''} animate-fade-in"><div class="task-card-header"><div class="task-title"><button class="pin-btn ${t.pinned?'pinned':''}" onclick="togglePin(${t.id})">üìå</button>${t.title}</div></div><div class="task-meta"><span class="task-meta-item">üë§ ${t.assignee}</span><span class="task-meta-item" style="${od?'color:#e74c3c;font-weight:600;':''}">üìÖ ${formatDate(t.deadline)}</span>${t.function?`<span class="task-meta-item">‚öôÔ∏è ${t.function}</span>`:''}</div><div class="task-badges"><span class="badge badge-${t.status}">${st[t.status]||t.status}</span><span class="badge badge-${t.type}">${tt[t.type]||t.type}</span><span class="badge badge-${t.priority}">${pt[t.priority]||t.priority}</span></div>${t.description?`<div class="task-info">${t.description}</div>`:''}<div class="task-actions"><button class="btn btn-small" onclick="openTaskModal(${t.id})">‚úèÔ∏è</button><button class="btn btn-small btn-danger" onclick="deleteTask(${t.id})">üóëÔ∏è</button></div></div>`;}).join('');}
        function clearFilters(){document.getElementById('statusFilter').value='';document.getElementById('functionFilter').value='';document.getElementById('assigneeFilter').value='';renderTasks();}

        // FUNCTIONS
        function openFunctionModal(id=null){document.getElementById('functionModal').style.display='block';updateFunctionAssignees();if(id){editingFunctionId=id;const f=functions.find(x=>x.id===id);if(f){document.getElementById('functionModalTitle').textContent='–†–µ–¥–∞–≥—É–≤–∞—Ç–∏';document.getElementById('functionName').value=f.name;document.getElementById('functionDepartment').value=f.department||'';document.getElementById('functionColor').value=f.color||'#3498db';document.getElementById('functionDescription').value=f.description||'';document.getElementById('functionHead').value=f.head||'';setTimeout(()=>{document.querySelectorAll('#functionAssignees input[type="checkbox"]').forEach(cb=>{cb.checked=f.assignees?.includes(cb.value);});},50);}}else{editingFunctionId=null;document.getElementById('functionModalTitle').textContent='–ù–æ–≤–∞ —Ñ—É–Ω–∫—Ü—ñ—è';document.getElementById('functionForm').reset();document.getElementById('functionColor').value='#3498db';}}
        function closeFunctionModal(){document.getElementById('functionModal').style.display='none';editingFunctionId=null;}
        function updateFunctionAssignees(){const c=document.getElementById('functionAssignees');const h=document.getElementById('functionHead');c.innerHTML=users.map(u=>`<label class="assignee-checkbox"><input type="checkbox" value="${u.name}">${u.name}</label>`).join('');h.innerHTML='<option value="">–û–±–µ—Ä—ñ—Ç—å</option>'+users.map(u=>`<option value="${u.name}">${u.name}</option>`).join('');}
        function saveFunction(e){e.preventDefault();const data={name:document.getElementById('functionName').value.trim(),department:document.getElementById('functionDepartment').value.trim(),color:document.getElementById('functionColor').value,description:document.getElementById('functionDescription').value.trim(),head:document.getElementById('functionHead').value,assignees:Array.from(document.querySelectorAll('#functionAssignees input:checked')).map(cb=>cb.value)};if(!data.name||!data.head){alert('–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –Ω–∞–∑–≤—É —Ç–∞ –æ–±–µ—Ä—ñ—Ç—å –≥–æ–ª–æ–≤–Ω–æ–≥–æ');return;}if(!data.assignees.includes(data.head))data.assignees.push(data.head);if(editingFunctionId){const i=functions.findIndex(f=>f.id===editingFunctionId);if(i!==-1)functions[i]={...functions[i],...data};}else{functions.push({id:Date.now(),...data});}saveData();updateSelects();renderFunctions();closeFunctionModal();}
        function deleteFunction(id){if(confirm('–í–∏–¥–∞–ª–∏—Ç–∏?')){functions=functions.filter(f=>f.id!==id);saveData();updateSelects();renderFunctions();}}
        function renderFunctions(){const c=document.getElementById('functionsContainer');if(functions.length===0){c.innerHTML='<div class="empty-state" style="grid-column:1/-1;"><h3>‚öôÔ∏è –§—É–Ω–∫—Ü—ñ–π –Ω–µ–º–∞—î</h3><p>–°—Ç–≤–æ—Ä—ñ—Ç—å –ø–µ—Ä—à—É —Ñ—É–Ω–∫—Ü—ñ—é</p></div>';return;}c.innerHTML=functions.map(f=>{const tc=tasks.filter(t=>t.function===f.name).length;const rc=regularTasks.filter(rt=>rt.function===f.name).length;return`<div class="function-card animate-fade-in"><div class="function-header"><div class="function-title" style="color:${f.color};">‚öôÔ∏è ${f.name}</div>${f.department?`<span style="font-size:0.75rem;color:#7f8c8d;">üè¢ ${f.department}</span>`:''}</div>${f.description?`<div class="function-description">${f.description}</div>`:''}<div class="function-assignees">${f.head?`<span class="assignee-badge head">üëë ${f.head}</span>`:''}${f.assignees?.filter(a=>a!==f.head).map(a=>`<span class="assignee-badge">${a}</span>`).join('')||''}</div><div class="function-stats"><span class="function-stat">üìã ${tc}</span><span class="function-stat">üîÑ ${rc}</span></div><div style="display:flex;gap:0.4rem;justify-content:flex-end;margin-top:0.5rem;"><button class="btn btn-small" onclick="openFunctionModal(${f.id})">‚úèÔ∏è</button><button class="btn btn-small btn-danger" onclick="deleteFunction(${f.id})">üóëÔ∏è</button></div></div>`;}).join('');}

        // REGULAR TASKS
        function openRegularTaskModal(id=null){document.getElementById('regularTaskModal').style.display='block';updateRegularTaskFunctions();if(id){editingRegularTaskId=id;const rt=regularTasks.find(r=>r.id===id);if(rt){document.getElementById('regularTaskTitle').value=rt.title;document.getElementById('regularTaskFunction').value=rt.function;document.getElementById('regularTaskPeriod').value=rt.period;document.getElementById('regularTaskDuration').value=rt.duration;document.getElementById('regularTaskDescription').value=rt.description||'';updateRegularTaskAssignees();setTimeout(()=>{document.querySelectorAll('#regularTaskAssignees input[type="checkbox"]').forEach(cb=>{cb.checked=rt.assignees?.includes(cb.value);});},50);}}else{editingRegularTaskId=null;document.getElementById('regularTaskForm').reset();document.getElementById('regularTaskDuration').value='1';document.getElementById('regularTaskAssignees').innerHTML='<p style="color:#7f8c8d;font-size:0.85rem;">–°–ø–æ—á–∞—Ç–∫—É –æ–±–µ—Ä—ñ—Ç—å —Ñ—É–Ω–∫—Ü—ñ—é</p>';}}
        function closeRegularTaskModal(){document.getElementById('regularTaskModal').style.display='none';editingRegularTaskId=null;}
        function updateRegularTaskFunctions(){const s=document.getElementById('regularTaskFunction');s.innerHTML='<option value="">–û–±–µ—Ä—ñ—Ç—å</option>'+functions.map(f=>`<option value="${f.name}">${f.name}</option>`).join('');document.getElementById('regularFunctionFilter').innerHTML='<option value="">–í—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó</option>'+functions.map(f=>`<option value="${f.name}">${f.name}</option>`).join('');}
        function updateRegularTaskAssignees(){const fn=document.getElementById('regularTaskFunction').value;const c=document.getElementById('regularTaskAssignees');if(!fn){c.innerHTML='<p style="color:#7f8c8d;font-size:0.85rem;">–°–ø–æ—á–∞—Ç–∫—É –æ–±–µ—Ä—ñ—Ç—å —Ñ—É–Ω–∫—Ü—ñ—é</p>';return;}const f=functions.find(x=>x.name===fn);if(!f||!f.assignees?.length){c.innerHTML='<p style="color:#7f8c8d;font-size:0.85rem;">–ù–µ–º–∞—î —É—á–∞—Å–Ω–∏–∫—ñ–≤</p>';return;}c.innerHTML=f.assignees.map(n=>`<label class="assignee-checkbox"><input type="checkbox" value="${n}">${n===f.head?'üëë ':''}${n}</label>`).join('');}
        function saveRegularTask(e){e.preventDefault();const data={title:document.getElementById('regularTaskTitle').value.trim(),function:document.getElementById('regularTaskFunction').value,period:document.getElementById('regularTaskPeriod').value,duration:parseInt(document.getElementById('regularTaskDuration').value),description:document.getElementById('regularTaskDescription').value.trim(),assignees:Array.from(document.querySelectorAll('#regularTaskAssignees input:checked')).map(cb=>cb.value)};if(!data.title||!data.function){alert('–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –Ω–∞–∑–≤—É —Ç–∞ —Ñ—É–Ω–∫—Ü—ñ—é');return;}if(data.assignees.length===0){alert('–û–±–µ—Ä—ñ—Ç—å –≤–∏–∫–æ–Ω–∞–≤—Ü—ñ–≤');return;}if(editingRegularTaskId){const i=regularTasks.findIndex(r=>r.id===editingRegularTaskId);if(i!==-1)regularTasks[i]={...regularTasks[i],...data};}else{regularTasks.push({id:Date.now(),...data,active:true,lastGenerated:null,createdAt:new Date().toISOString()});}saveData();renderRegularTasks();closeRegularTaskModal();}
        function deleteRegularTask(id){if(confirm('–í–∏–¥–∞–ª–∏—Ç–∏?')){regularTasks=regularTasks.filter(rt=>rt.id!==id);saveData();renderRegularTasks();}}
        function generateFromRegular(id){const rt=regularTasks.find(r=>r.id===id);if(!rt)return;const dl=new Date();dl.setDate(dl.getDate()+rt.duration);rt.assignees.forEach(a=>{tasks.push({id:Date.now()+Math.random(),title:rt.title,function:rt.function,assignee:a,creator:'System',deadline:dl.toISOString().slice(0,16),status:'new',type:'regular',priority:'medium',pinned:false,description:rt.description,createdAt:new Date().toISOString()});});const i=regularTasks.findIndex(r=>r.id===id);if(i!==-1)regularTasks[i].lastGenerated=new Date().toISOString();saveData();renderRegularTasks();renderTasks();alert(`‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ ${rt.assignees.length} –∑–∞–≤–¥–∞–Ω—å`);}
        function renderRegularTasks(){const c=document.getElementById('regularTasksContainer');const ff=document.getElementById('regularFunctionFilter')?.value;let f=regularTasks;if(ff)f=regularTasks.filter(rt=>rt.function===ff);if(f.length===0){c.innerHTML='<div class="empty-state" style="grid-column:1/-1;"><h3>üîÑ –†–µ–≥—É–ª—è—Ä–Ω–∏—Ö –Ω–µ–º–∞—î</h3><p>–°—Ç–≤–æ—Ä—ñ—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è</p></div>';return;}const pt={daily:'–©–æ–¥–Ω—è',weekly:'–©–æ—Ç–∏–∂–Ω—è',monthly:'–©–æ–º—ñ—Å—è—Ü—è',workdays:'–†–æ–±–æ—á—ñ –¥–Ω—ñ'};c.innerHTML=f.map(rt=>{const fn=functions.find(x=>x.name===rt.function);return`<div class="function-card animate-fade-in"><div class="function-header"><div class="function-title">${rt.title}</div><span class="badge badge-regular">${pt[rt.period]||rt.period}</span></div><div class="regular-task-info"><div><strong>–§—É–Ω–∫—Ü—ñ—è:</strong> ${rt.function}</div><div><strong>–î–Ω—ñ–≤:</strong> ${rt.duration}</div><div><strong>–û—Å—Ç–∞–Ω–Ω—î:</strong> ${rt.lastGenerated?formatDate(rt.lastGenerated):'–ù—ñ–∫–æ–ª–∏'}</div>${rt.description?`<div><strong>–û–ø–∏—Å:</strong> ${rt.description}</div>`:''}</div><div style="margin-bottom:0.5rem;"><div class="regular-task-assignees-title">üë• –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–æ:</div><div class="assignee-checkboxes">${rt.assignees.map(n=>`<span class="assignee-checkbox">‚úì ${n===fn?.head?'üëë ':''}${n}</span>`).join('')}</div></div><div style="display:flex;gap:0.4rem;justify-content:flex-end;"><button class="btn btn-small btn-success" onclick="generateFromRegular(${rt.id})">‚ö°</button><button class="btn btn-small" onclick="openRegularTaskModal(${rt.id})">‚úèÔ∏è</button><button class="btn btn-small btn-danger" onclick="deleteRegularTask(${rt.id})">üóëÔ∏è</button></div></div>`;}).join('');}

        // USERS
        function openUserModal(id=null){document.getElementById('userModal').style.display='block';if(id){editingUserId=id;const u=users.find(x=>x.id===id);if(u){document.getElementById('userModalTitle').textContent='–†–µ–¥–∞–≥—É–≤–∞—Ç–∏';document.getElementById('userName').value=u.name;document.getElementById('userEmail').value=u.email;document.getElementById('userPhone').value=u.phone||'';document.getElementById('userRole').value=u.role;document.getElementById('userPosition').value=u.position||'';document.getElementById('userDepartment').value=u.department||'';}}else{editingUserId=null;document.getElementById('userModalTitle').textContent='–ù–æ–≤–∏–π';document.getElementById('userForm').reset();}}
        function closeUserModal(){document.getElementById('userModal').style.display='none';editingUserId=null;}
        function saveUser(e){e.preventDefault();const data={name:document.getElementById('userName').value.trim(),email:document.getElementById('userEmail').value.trim(),phone:document.getElementById('userPhone').value.trim(),role:document.getElementById('userRole').value,position:document.getElementById('userPosition').value.trim(),department:document.getElementById('userDepartment').value.trim()};if(!data.name||!data.email){alert('–ó–∞–ø–æ–≤–Ω—ñ—Ç—å —ñ–º\'—è —Ç–∞ email');return;}if(editingUserId){const i=users.findIndex(u=>u.id===editingUserId);if(i!==-1){const old=users[i].name;users[i]={...users[i],...data};if(old!==data.name){tasks.forEach(t=>{if(t.assignee===old)t.assignee=data.name;if(t.creator===old)t.creator=data.name;});functions.forEach(f=>{if(f.head===old)f.head=data.name;f.assignees=f.assignees?.map(a=>a===old?data.name:a);});regularTasks.forEach(rt=>{rt.assignees=rt.assignees?.map(a=>a===old?data.name:a);});}}}else{if(users.find(u=>u.email===data.email)){alert('Email –≤–∂–µ —ñ—Å–Ω—É—î');return;}users.push({id:Date.now(),...data,createdAt:new Date().toISOString()});}saveData();updateSelects();renderUsers();closeUserModal();}
        function deleteUser(id){const u=users.find(x=>x.id===id);if(!u)return;if(u.role==='owner'){alert('–ù–µ –º–æ–∂–Ω–∞ –≤–∏–¥–∞–ª–∏—Ç–∏ –≤–ª–∞—Å–Ω–∏–∫–∞');return;}if(confirm(`–í–∏–¥–∞–ª–∏—Ç–∏ ${u.name}?`)){users=users.filter(x=>x.id!==id);functions.forEach(f=>{f.assignees=f.assignees?.filter(a=>a!==u.name);if(f.head===u.name&&f.assignees?.length>0)f.head=f.assignees[0];});regularTasks.forEach(rt=>{rt.assignees=rt.assignees?.filter(a=>a!==u.name);});saveData();updateSelects();renderUsers();}}
        function renderUsers(){const c=document.getElementById('usersContainer');const rf=document.getElementById('userRoleFilter')?.value;let f=users;if(rf)f=users.filter(u=>u.role===rf);if(f.length===0){c.innerHTML='<div class="empty-state" style="grid-column:1/-1;"><h3>üë• –ù–µ–º–∞—î</h3><p>–î–æ–¥–∞–π—Ç–µ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞</p></div>';return;}const rt={owner:'–í–ª–∞—Å–Ω–∏–∫',manager:'–ú–µ–Ω–µ–¥–∂–µ—Ä',employee:'–°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫'};c.innerHTML=f.map(u=>{const ut=tasks.filter(t=>t.assignee===u.name);const at=ut.filter(t=>t.status!=='done');const uf=functions.filter(fn=>fn.assignees?.includes(u.name));return`<div class="user-card animate-fade-in"><div class="user-header"><div class="user-name">${u.name}</div><span class="role-badge ${u.role}">${rt[u.role]||u.role}</span></div><div class="user-details"><div>üìß ${u.email}</div>${u.phone?`<div>üì± ${u.phone}</div>`:''}${u.position?`<div>üíº ${u.position}</div>`:''}${u.department?`<div>üè¢ ${u.department}</div>`:''}<div>‚öôÔ∏è ${uf.map(fn=>fn.name).join(', ')||'–ù–µ–º–∞—î'}</div></div><div class="user-stats"><span>üìã ${ut.length}</span><span style="color:${at.length>0?'#f39c12':'#27ae60'};">üîÑ ${at.length}</span></div><div style="display:flex;gap:0.4rem;justify-content:flex-end;"><button class="btn btn-small" onclick="openUserModal(${u.id})">‚úèÔ∏è</button>${u.role!=='owner'?`<button class="btn btn-small btn-danger" onclick="deleteUser(${u.id})">üóëÔ∏è</button>`:''}</div></div>`;}).join('');}

        // INVITE
        function openInviteModal(){document.getElementById('inviteModal').style.display='block';}
        function closeInviteModal(){document.getElementById('inviteModal').style.display='none';}
        function createInvite(e){e.preventDefault();const email=document.getElementById('inviteEmail').value.trim();if(users.find(u=>u.email===email)){alert('–í–∂–µ —ñ—Å–Ω—É—î');return;}const code='INV-'+Math.random().toString(36).substr(2,8).toUpperCase();const link=`${window.location.origin}${window.location.pathname}?invite=${code}`;alert(`üì§ –ü–æ—Å–∏–ª–∞–Ω–Ω—è:\n${link}`);closeInviteModal();}

        // CONTROL & ANALYTICS
        function renderControl(){const now=new Date();const tm=new Date(now);tm.setDate(tm.getDate()+1);const urg=tasks.filter(t=>new Date(t.deadline)<now&&t.status!=='done').length;const wrn=tasks.filter(t=>{const d=new Date(t.deadline);return d>=now&&d<=tm&&t.status!=='done';}).length;const act=tasks.filter(t=>t.status==='progress').length;const cmp=tasks.filter(t=>t.status==='done').length;document.getElementById('urgentCount').textContent=urg;document.getElementById('warningCount').textContent=wrn;document.getElementById('activeCount').textContent=act;document.getElementById('completedCount').textContent=cmp;const wl={};tasks.filter(t=>t.status!=='done').forEach(t=>{wl[t.assignee]=(wl[t.assignee]||0)+1;});document.getElementById('controlContent').innerHTML=`<h3 style="margin-bottom:0.8rem;">üë• –ù–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</h3>${Object.entries(wl).map(([n,c])=>`<div style="display:flex;justify-content:space-between;padding:0.4rem;background:#f8f9fa;border-radius:8px;margin-bottom:0.4rem;"><span>${n}</span><span style="font-weight:600;color:${c>5?'#e74c3c':'#27ae60'};">${c}</span></div>`).join('')||'<p style="color:#7f8c8d;">–ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–∏—Ö</p>'}`;}
        function renderAnalytics(){const tot=tasks.length;const cmp=tasks.filter(t=>t.status==='done').length;const ovr=tasks.filter(t=>new Date(t.deadline)<new Date()&&t.status!=='done').length;const eff=tot>0?Math.round((cmp/tot)*100):0;document.getElementById('totalTasksCount').textContent=tot;document.getElementById('completedTasksCount').textContent=cmp;document.getElementById('overdueTasksCount').textContent=ovr;document.getElementById('efficiencyPercent').textContent=eff+'%';const sc={new:tasks.filter(t=>t.status==='new').length,progress:tasks.filter(t=>t.status==='progress').length,review:tasks.filter(t=>t.status==='review').length,done:tasks.filter(t=>t.status==='done').length};const sn={new:'–ù–æ–≤—ñ',progress:'–í —Ä–æ–±–æ—Ç—ñ',review:'–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞',done:'–ì–æ—Ç–æ–≤–æ'};const scl={new:'#3498db',progress:'#f39c12',review:'#e91e63',done:'#27ae60'};document.getElementById('statusChart').innerHTML=Object.entries(sc).map(([s,c])=>{const p=tot>0?Math.round((c/tot)*100):0;return`<div style="display:flex;align-items:center;gap:0.6rem;margin-bottom:0.6rem;"><div style="width:10px;height:10px;background:${scl[s]};border-radius:2px;"></div><span style="width:70px;font-size:0.8rem;">${sn[s]}</span><div style="flex:1;height:6px;background:#ecf0f1;border-radius:3px;overflow:hidden;"><div style="width:${p}%;height:100%;background:${scl[s]};"></div></div><span style="font-weight:600;font-size:0.8rem;width:45px;">${c} (${p}%)</span></div>`;}).join('');const asg=[...new Set(tasks.map(t=>t.assignee))].filter(Boolean);const mx=Math.max(...asg.map(a=>tasks.filter(t=>t.assignee===a).length),1);document.getElementById('workloadChart').innerHTML=asg.map(n=>{const c=tasks.filter(t=>t.assignee===n).length;const p=Math.round((c/mx)*100);return`<div style="margin-bottom:0.6rem;"><div style="display:flex;justify-content:space-between;margin-bottom:0.2rem;"><span style="font-size:0.8rem;font-weight:600;">${n}</span><span style="font-size:0.8rem;">${c}</span></div><div style="height:6px;background:#ecf0f1;border-radius:3px;overflow:hidden;"><div style="width:${p}%;height:100%;background:#3498db;"></div></div></div>`;}).join('')||'<p style="color:#7f8c8d;">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö</p>';}

        // HELPERS
        function updateSelects(){const tf=document.getElementById('taskFunction');const ta=document.getElementById('taskAssignee');const ff=document.getElementById('functionFilter');const af=document.getElementById('assigneeFilter');if(tf){const v=tf.value;tf.innerHTML='<option value="">–ë–µ–∑ —Ñ—É–Ω–∫—Ü—ñ—ó</option>'+functions.map(f=>`<option value="${f.name}">${f.name}</option>`).join('');tf.value=v;}if(ta){const v=ta.value;ta.innerHTML='<option value="">–û–±–µ—Ä—ñ—Ç—å</option>'+users.map(u=>`<option value="${u.name}">${u.name}</option>`).join('');ta.value=v;}if(ff)ff.innerHTML='<option value="">–í—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó</option>'+functions.map(f=>`<option value="${f.name}">${f.name}</option>`).join('');if(af)af.innerHTML='<option value="">–í—Å—ñ –≤–∏–∫–æ–Ω–∞–≤—Ü—ñ</option>'+users.map(u=>`<option value="${u.name}">${u.name}</option>`).join('');}
        function formatDate(s){const d=new Date(s);return d.toLocaleDateString('uk-UA',{day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit'});}
        function switchTab(t){document.querySelectorAll('.tab-content').forEach(x=>x.classList.remove('active'));document.querySelectorAll('.tab-btn').forEach(x=>x.classList.remove('active'));document.getElementById(t+'Tab').classList.add('active');document.querySelector(`[onclick="switchTab('${t}')"]`).classList.add('active');switch(t){case'tasks':renderTasks();break;case'control':renderControl();break;case'regular':updateRegularTaskFunctions();renderRegularTasks();break;case'functions':renderFunctions();break;case'users':renderUsers();break;case'analytics':renderAnalytics();break;}}
        function setLanguage(l){currentLanguage=l;localStorage.setItem('talko_lang',l);document.querySelectorAll('.lang-btn').forEach(b=>b.classList.remove('active'));document.querySelector(`[onclick="setLanguage('${l}')"]`).classList.add('active');}
        function exportToCSV(){const d=tasks.map(t=>({'–ó–∞–≤–¥–∞–Ω–Ω—è':t.title,'–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å':t.assignee,'–î–µ–¥–ª–∞–π–Ω':formatDate(t.deadline),'–°—Ç–∞—Ç—É—Å':t.status,'–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç':t.priority,'–§—É–Ω–∫—Ü—ñ—è':t.function||''}));const csv=[Object.keys(d[0]||{}).join(','),...d.map(r=>Object.values(r).map(v=>`"${v}"`).join(','))].join('\n');const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});const link=document.createElement('a');link.href=URL.createObjectURL(blob);link.download=`tasks_${new Date().toISOString().slice(0,10)}.csv`;link.click();}
        window.onclick=function(e){['taskModal','functionModal','regularTaskModal','userModal','inviteModal'].forEach(id=>{if(e.target===document.getElementById(id))document.getElementById(id).style.display='none';});}
        document.addEventListener('DOMContentLoaded',function(){document.getElementById('taskForm').addEventListener('submit',saveTask);document.getElementById('functionForm').addEventListener('submit',saveFunction);document.getElementById('regularTaskForm').addEventListener('submit',saveRegularTask);document.getElementById('userForm').addEventListener('submit',saveUser);document.getElementById('inviteForm').addEventListener('submit',createInvite);checkAuth();});
    </script>
</body>
</html>
